<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B·∫£ng Ch·∫•m C√¥ng ƒêa D·ª± √Ån</title>
<style>
/* CSS C∆† B·∫¢N V√Ä CHUNG */
html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#f6f8f9}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;padding-bottom:10px}
.month-nav{display:flex;align-items:center;gap:8px;font-weight:bold;color:#27ae60}
.arrow{cursor:pointer;user-select:none;font-size:1.3em}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;text-align:center;padding:5px;font-size:.85em}
th{background:#eaf2f8}
.day{position:relative;height:80px;vertical-align:top;cursor:pointer}
.day span{position:absolute;top:3px;left:5px;font-weight:bold;color:#2980b9}
.day div{position:absolute;bottom:3px;left:0;width:100%;font-size:.8em;color:#27ae60}
.summary{margin-top:20px;background:#ecf9ff;padding:10px;border-radius:5px}

/* CSS CHO MODAL CHUNG */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px}
.modal-content input[type="text"], .modal-content input[type="date"], .modal-content input[type="time"]{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}
.modal-content button{margin-top:10px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer}
.save{background:#3498db;color:#fff}
.cancel{background:#ccc}

/* CSS CHO QU·∫¢N L√ù N∆†I L√ÄM VI·ªÜC */
#workplace-management {
    margin-bottom: 20px;
    border-bottom: 1px dashed #ccc;
    padding-bottom: 15px;
}
#workplace-actions {
    text-align: center;
    margin: 10px 0;
}
#workplace-actions button {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin: 0 5px;
}
#addWorkplaceBtn {
    background: #2ecc71;
    color: #fff;
}
#selectWorkplaceBtn {
    background: #3498db;
    color: #fff;
}

/* HI·ªÜU ·ª®NG CU·ªòN NGANG */
#workplace-list-container {
    overflow-x: auto; /* Cho ph√©p cu·ªôn ngang */
    white-space: nowrap; /* NgƒÉn c√°c th·∫ª con xu·ªëng d√≤ng */
    padding: 10px 0;
    -webkit-overflow-scrolling: touch; /* C·∫£i thi·ªán tr·∫£i nghi·ªám cu·ªôn tr√™n thi·∫øt b·ªã di ƒë·ªông */
    scrollbar-width: none; /* ·∫®n thanh cu·ªôn Firefox */
    -ms-overflow-style: none;  /* ·∫®n thanh cu·ªôn IE/Edge */
}
#workplace-list-container::-webkit-scrollbar {
    display: none; /* ·∫®n thanh cu·ªôn Chrome/Safari/Opera */
}
#workplace-list {
    display: inline-block; /* Quan tr·ªçng ƒë·ªÉ cu·ªôn ho·∫°t ƒë·ªông */
    width: max-content;
}
.workplace-card {
    display: inline-block;
    padding: 10px 15px;
    margin: 0 5px;
    border: 2px solid #ccc;
    border-radius: 8px;
    background: #fcfcfc;
    cursor: pointer;
    font-size: 0.9em;
    min-width: 150px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    vertical-align: top;
}
.workplace-card.selected {
    border-color: #e74c3c; /* M√†u ƒë·ªè cho th·∫ª ƒëang ƒë∆∞·ª£c ch·ªçn */
    background: #ffebeb;
    font-weight: bold;
}
.workplace-card .store-name {
    display: block;
    font-weight: bold;
    color: #2c3e50;
    white-space: normal; /* Cho ph√©p t√™n c·ª≠a h√†ng xu·ªëng d√≤ng */
}
.workplace-card .date-range {
    display: block;
    font-size: 0.8em;
    color: #7f8c8d;
    margin-top: 3px;
}

#current-workplace-display-block {
    text-align: center;
    margin: 10px 0 0 0;
    font-size: 1.1em;
    color: #2c3e50;
    padding: 5px 0;
}
#current-workplace-name {
    font-weight: bold;
    color: #3498db;
}

/* CƒÉn ch·ªânh cho Input gi·ªù (trong timeModal) */
#timeModal .modal-content input[type="time"] {
    width: 48%;
    display: inline-block;
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="month-nav">
            <span class="arrow" id="prevMonth">‚óÄ</span>
            <span id="monthYear"></span>
            <span class="arrow" id="nextMonth">‚ñ∂</span>
        </div>
        <div>
            üí∞ L∆∞∆°ng/gi·ªù: <input type="number" id="rate" value="100000" style="width:90px"> VND
        </div>
    </div>
    
    <div id="workplace-management">
        <div id="workplace-list-container">
            <div id="workplace-list"></div>
        </div>
        <div id="workplace-actions">
            <button id="addWorkplaceBtn">‚ûï Th√™m M·ªõi</button>
            <button id="selectWorkplaceBtn">‚úÖ Ch·ªçn N∆°i L√†m Vi·ªác</button>
        </div>
        <div id="current-workplace-display-block">
            üìç **ƒêang l√†m vi·ªác t·∫°i:** <span id="current-workplace-name">Ch∆∞a ch·ªçn</span>
        </div>
    </div>
    <table>
        <thead>
            <tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr>
        </thead>
        <tbody id="calendar"></tbody>
    </table>

    <div class="summary">
        ‚úÖ T·ªïng gi·ªù: <span id="totalHours">0</span> gi·ªù<br>
        üíµ Thu nh·∫≠p: <span id="totalPay">0</span> VND
    </div>
</div>

<div class="modal" id="timeModal">
    <div class="modal-content">
        <h3>Nh·∫≠p gi·ªù c√¥ng - <span id="modalDate"></span></h3>
        <label>V√†o:</label>
        <input type="time" id="timeIn" value="09:00">
        <label>Ra:</label>
        <input type="time" id="timeOut" value="18:00">
        <button class="save" id="saveTime">L∆∞u</button>
        <button class="cancel" id="cancelTime">H·ªßy</button>
    </div>
</div>

<div class="modal" id="workplaceModal">
    <div class="modal-content">
        <h3>Qu·∫£n L√Ω N∆°i L√†m Vi·ªác</h3>
        <label>T√™n c·ª≠a h√†ng:</label>
        <input type="text" id="storeNameInput" placeholder="VD: D·ª± √°n A">
        <label>ƒê·ªãa ch·ªâ:</label>
        <input type="text" id="addressInput" placeholder="ƒê·ªãa ch·ªâ/Ghi ch√∫">
        <label>Ng√†y b·∫Øt ƒë·∫ßu:</label>
        <input type="date" id="startDateInput">
        <label>Ng√†y k·∫øt th√∫c:</label>
        <input type="date" id="endDateInput">
        <label style="display: block; margin-top: 10px;">
            <input type="checkbox" id="isCurrentWork"> ƒêang l√†m
        </label>
        <button class="save" id="createWorkplaceBtn">T·∫°o/L∆∞u</button>
        <button class="cancel" id="cancelWorkplaceBtn" style="background:#f39c12">H·ªßy</button>
        <button class="cancel" id="deleteWorkplaceBtn" style="background:#e74c3c;">X√≥a</button>
    </div>
</div>

<script>
// --- KHAI B√ÅO BI·∫æN ---
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
// workData ch·ª©a gi·ªù c√¥ng theo ng√†y
let workData = JSON.parse(localStorage.getItem('workData') || '{}'); 
const rateInput = document.getElementById('rate');

// BI·∫æN CHO QU·∫¢N L√ù DANH S√ÅCH N∆†I L√ÄM VI·ªÜC
let workplaces = JSON.parse(localStorage.getItem('workplaces') || '[]');
let currentWorkplaceIndex = localStorage.getItem('currentWorkplaceIndex') !== null ? parseInt(localStorage.getItem('currentWorkplaceIndex')) : -1;

const workplaceList = document.getElementById('workplace-list');
const selectWorkplaceBtn = document.getElementById('selectWorkplaceBtn');
const currentWorkplaceName = document.getElementById('current-workplace-name');

// BI·∫æN CHO MODAL N∆†I L√ÄM VI·ªÜC
const workplaceModal = document.getElementById('workplaceModal');
const addWorkplaceBtn = document.getElementById('addWorkplaceBtn');
const createWorkplaceBtn = document.getElementById('createWorkplaceBtn');
const deleteWorkplaceBtn = document.getElementById('deleteWorkplaceBtn');
const isCurrentWork = document.getElementById('isCurrentWork');
const endDateInput = document.getElementById('endDateInput');

let editingIndex = -1; // Bi·∫øn ƒë·ªÉ theo d√µi th·∫ª ƒëang s·ª≠a

// --- H√ÄM CHUNG ---
function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}

function updateSummary(){
    const rate=parseFloat(rateInput.value)||0;
    let totalH=0; 
    for(const k in workData) totalH+=workData[k].hours||0;
    
    document.getElementById('totalHours').textContent=totalH.toFixed(2);
    document.getElementById('totalPay').textContent=(totalH*rate).toLocaleString('vi-VN');
    localStorage.setItem('workData',JSON.stringify(workData));
}

function renderCalendar(){
    const tbl=document.getElementById('calendar');
    tbl.innerHTML='';
    const firstDay=new Date(currentYear,currentMonth,1).getDay();
    const totalDays=daysInMonth(currentYear,currentMonth);
    document.getElementById('monthYear').textContent=`${currentMonth+1}/${currentYear}`;
    let day=1; 
    for(let r=0;r<6;r++){
        const tr=document.createElement('tr');
        for(let c=0;c<7;c++){
            const td=document.createElement('td');
            if(r===0&&c<firstDay||day>totalDays){
                td.innerHTML='';
            } else {
                const dkey=`${currentYear}-${currentMonth+1}-${day}`;
                const info=workData[dkey]||{};
                td.className='day'; 
                td.innerHTML=`<span>${day}</span>${info.hours?`<div>${info.hours.toFixed(2)}h</div>`:''}`;
                td.onclick=()=>openModal(dkey);
                day++;
            }
            tr.appendChild(td);
        } 
        tbl.appendChild(tr);
        if(day>totalDays)break;
    }
    updateSummary();
}

function openModal(key){
    const m=document.getElementById('timeModal');m.style.display='flex';
    const dateParts=key.split('-');document.getElementById('modalDate').textContent=`${dateParts[2]}/${dateParts[1]}`;
    m.dataset.key=key;
    const info=workData[key]||{};
    document.getElementById('timeIn').value=info.in||'09:00';
    document.getElementById('timeOut').value=info.out||'18:00';
}

// --- LOGIC N∆†I L√ÄM VI·ªÜC (M·ªöI) ---

// L∆∞u danh s√°ch n∆°i l√†m vi·ªác v√†o localStorage
function saveWorkplaces() {
    localStorage.setItem('workplaces', JSON.stringify(workplaces));
    localStorage.setItem('currentWorkplaceIndex', currentWorkplaceIndex);
    renderWorkplaceList();
    updateCurrentWorkplaceDisplay();
}

// C·∫≠p nh·∫≠t hi·ªÉn th·ªã n∆°i l√†m vi·ªác hi·ªán t·∫°i
function updateCurrentWorkplaceDisplay() {
    if (currentWorkplaceIndex !== -1 && workplaces[currentWorkplaceIndex]) {
        currentWorkplaceName.textContent = workplaces[currentWorkplaceIndex].storeName + (workplaces[currentWorkplaceIndex].endDate === 'ƒêang l√†m' ? ' (Hi·ªán t·∫°i)' : '');
    } else {
        currentWorkplaceName.textContent = 'Ch∆∞a ch·ªçn';
    }
}

// Render (V·∫Ω) danh s√°ch n∆°i l√†m vi·ªác ra giao di·ªán (s·ª≠ d·ª•ng cu·ªôn ngang)
function renderWorkplaceList() {
    workplaceList.innerHTML = '';
    workplaces.forEach((wp, index) => {
        const card = document.createElement('div');
        card.className = `workplace-card ${index === currentWorkplaceIndex ? 'selected' : ''}`;
        card.dataset.index = index;
        const dateDisplay = wp.endDate === 'ƒêang l√†m' ? 'ƒêang l√†m' : `${wp.startDate} - ${wp.endDate}`;
        card.innerHTML = `<span class="store-name">${wp.storeName}</span><span class="date-range">${dateDisplay}</span>`;
        
        // S·ª± ki·ªán click (Ch·∫°m 1 l·∫ßn: Ch·ªçn, Ch·∫°m 2 l·∫ßn: S·ª≠a)
        let clickTimer = null;
        card.onclick = () => {
            if (clickTimer === null) {
                clickTimer = setTimeout(() => {
                    // X·ª≠ l√Ω ch·∫°m 1 l·∫ßn (Ch·ªçn)
                    currentWorkplaceIndex = index;
                    saveWorkplaces();
                    clickTimer = null;
                }, 300); // ƒê·ª£i 300ms
            } else {
                // X·ª≠ l√Ω ch·∫°m 2 l·∫ßn (S·ª≠a)
                clearTimeout(clickTimer);
                clickTimer = null;
                openWorkplaceModal(index);
            }
        };

        workplaceList.appendChild(card);
    });
}

// M·ªü Modal N∆°i L√†m Vi·ªác (S·ª¨A ho·∫∑c T·∫†O M·ªöI)
function openWorkplaceModal(index = -1) {
    workplaceModal.style.display = 'flex';
    editingIndex = index;
    
    if (index !== -1) { // Ch·∫ø ƒë·ªô S·ª¨A
        const wp = workplaces[index];
        document.getElementById('storeNameInput').value = wp.storeName;
        document.getElementById('addressInput').value = wp.address;
        document.getElementById('startDateInput').value = wp.startDate;
        document.getElementById('endDateInput').value = wp.endDate === 'ƒêang l√†m' ? '' : wp.endDate;
        document.getElementById('isCurrentWork').checked = wp.endDate === 'ƒêang l√†m';
        document.getElementById('endDateInput').disabled = wp.endDate === 'ƒêang l√†m';
        createWorkplaceBtn.textContent = 'L∆∞u Thay ƒê·ªïi';
        deleteWorkplaceBtn.style.display = 'inline-block';
    } else { // Ch·∫ø ƒë·ªô T·∫†O M·ªöI
        // Reset form
        document.getElementById('storeNameInput').value = '';
        document.getElementById('addressInput').value = '';
        document.getElementById('startDateInput').value = '';
        document.getElementById('endDateInput').value = '';
        document.getElementById('isCurrentWork').checked = false;
        document.getElementById('endDateInput').disabled = false;
        createWorkplaceBtn.textContent = 'T·∫°o';
        deleteWorkplaceBtn.style.display = 'none';
    }
}

// --- S·ª∞ KI·ªÜN N∆†I L√ÄM VI·ªÜC ---

// X·ª≠ l√Ω Checkbox "ƒêang l√†m"
isCurrentWork.onchange = function() {
    if (this.checked) {
        endDateInput.value = '';
        endDateInput.disabled = true;
    } else {
        endDateInput.disabled = false;
    }
};

// M·ªü Modal (n√∫t Th√™m M·ªõi)
addWorkplaceBtn.onclick = () => openWorkplaceModal(-1);

// N√∫t Ch·ªçn N∆°i L√†m Vi·ªác (h∆∞·ªõng d·∫´n)
selectWorkplaceBtn.onclick = () => {
    alert("Vui l√≤ng ch·∫°m m·ªôt l·∫ßn v√†o th·∫ª n∆°i l√†m vi·ªác b·∫°n mu·ªën ch·ªçn, ho·∫∑c ch·∫°m hai l·∫ßn ƒë·ªÉ s·ª≠a/x√≥a.");
};

// N√∫t H·ªßy Modal N∆°i L√†m Vi·ªác
cancelWorkplaceBtn.onclick = () => {
    workplaceModal.style.display = 'none';
};

// N√∫t X√≥a N∆°i L√†m Vi·ªác
deleteWorkplaceBtn.onclick = () => {
    if (editingIndex !== -1 && confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a "${workplaces[editingIndex].storeName}"?`)) {
        workplaces.splice(editingIndex, 1);
        
        // C·∫≠p nh·∫≠t l·∫°i index hi·ªán t·∫°i n·∫øu n∆°i l√†m vi·ªác b·ªã x√≥a
        if (currentWorkplaceIndex === editingIndex) {
            currentWorkplaceIndex = -1;
        } else if (currentWorkplaceIndex > editingIndex) {
            currentWorkplaceIndex--;
        }

        saveWorkplaces();
        workplaceModal.style.display = 'none';
    }
};

// X·ª≠ l√Ω n√∫t T·∫°o/L∆∞u (Modal)
createWorkplaceBtn.onclick = () => {
    const storeName = document.getElementById('storeNameInput').value;
    const address = document.getElementById('addressInput').value;
    const startDate = document.getElementById('startDateInput').value;
    let endDate = endDateInput.value;

    if (document.getElementById('isCurrentWork').checked) {
        endDate = 'ƒêang l√†m';
    }

    if (!storeName || !startDate) {
        alert('Vui l√≤ng nh·∫≠p T√™n c·ª≠a h√†ng v√† Ng√†y b·∫Øt ƒë·∫ßu.');
        return;
    }

    const newWorkplace = { storeName, address, startDate, endDate };

    if (editingIndex !== -1) {
        // Ch·∫ø ƒë·ªô S·ª¨A
        workplaces[editingIndex] = newWorkplace;
        alert(`ƒê√£ l∆∞u thay ƒë·ªïi cho: ${storeName}`);
    } else {
        // Ch·∫ø ƒë·ªô T·∫†O M·ªöI
        workplaces.push(newWorkplace);
        currentWorkplaceIndex = workplaces.length - 1; // Ch·ªçn th·∫ª m·ªõi t·∫°o l√†m th·∫ª hi·ªán t·∫°i
        alert(`ƒê√£ t·∫°o n∆°i l√†m vi·ªác m·ªõi: ${storeName}`);
    }
    
    saveWorkplaces();
    workplaceModal.style.display = 'none';
};

// --- C√ÅC S·ª∞ KI·ªÜN CH·∫§M C√îNG V√Ä ƒêI·ªÄU H∆Ø·ªöNG ---
document.getElementById('saveTime').onclick=()=>{
    const key=document.getElementById('timeModal').dataset.key;
    const tin=document.getElementById('timeIn').value;
    const tout=document.getElementById('timeOut').value;
    const [hi,mi]=tin.split(':').map(Number);const [ho,mo]=tout.split(':').map(Number);
    let hrs=(ho+mo/60)-(hi+mi/60);if(hrs<0)hrs+=24;
    workData[key]={in:tin,out:tout,hours:hrs};
    document.getElementById('timeModal').style.display='none';
    renderCalendar();
};
document.getElementById('cancelTime').onclick=()=>document.getElementById('timeModal').style.display='none';
document.getElementById('prevMonth').onclick=()=>{currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();};
document.getElementById('nextMonth').onclick=()=>{currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();};
rateInput.onchange=updateSummary;

// --- KH·ªûI T·∫†O ·ª®NG D·ª§NG ---
renderWorkplaceList();
updateCurrentWorkplaceDisplay();
renderCalendar();
</script>
</body>
</html>
