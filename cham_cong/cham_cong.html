<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B·∫£ng Ch·∫•m C√¥ng C√° Nh√¢n</title>
<style>
/* CSS C∆† B·∫¢N V√Ä CHUNG */
html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#f6f8f9}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;padding-bottom:10px}
.month-nav{display:flex;align-items:center;gap:8px;font-weight:bold;color:#27ae60}
.arrow{cursor:pointer;user-select:none;font-size:1.3em}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;text-align:center;padding:5px;font-size:.85em}
/* C·ªôt ti√™u ƒë·ªÅ m·∫∑c ƒë·ªãnh */
th{background:#eaf2f8}
.day{position:relative;height:80px;vertical-align:top;cursor:pointer}
.day span{position:absolute;top:3px;left:5px;font-weight:bold;color:#2980b9}
.day div{position:absolute;bottom:3px;left:0;width:100%;font-size:.8em;color:#27ae60}
.summary{margin-top:20px;background:#ecf9ff;padding:10px;border-radius:5px}

/* CSS CHO MODAL CHUNG */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px}
.modal-content input[type="text"], .modal-content input[type="date"], .modal-content input[type="time"], .modal-content select{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}
.modal-content button{margin-top:10px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer}
.save{background:#3498db;color:#fff}
.cancel{background:#ccc}

/* CƒÉn ch·ªânh cho Input gi·ªù (trong timeModal) */
#timeModal .modal-content input[type="time"] {
    width: 48%;
    display: inline-block;
}

/* --- ƒêI·ªÄU CH·ªàNH GIAO DI·ªÜN & L·ªñI MOBILE --- */

/* 1. B√¥i ƒë·ªè c·ªôt Ch·ªß Nh·∫≠t */
table th:first-child { background: #e74c3c; color: #fff; }
table tr td:first-child { background-color: #fcecec; }
table tr td:first-child span { color: #c0392b !important; }

/* 2. L√†m t·ªëi m√†u √¥ tr·ªëng */
table tr td:empty { background-color: #dddddd; cursor: default; }

/* 3. T·ªêI ∆ØU H√ìA HI·ªÇN TH·ªä RATE SECTION (M·ªöI) */
#rateSection {
    display: flex;
    align-items: center;
    gap: 4px; 
}

/* Container ch·ª©a Input v√† ƒë∆°n v·ªã ti·ªÅn t·ªá */
#rateInputGroup {
    display: flex;
    align-items: center;
    border: 1px solid #ccc; /* √Åp d·ª•ng border cho to√†n b·ªô nh√≥m */
    border-radius: 5px;
    padding-right: 4px; /* Kho·∫£ng c√°ch cho text ƒë∆°n v·ªã */
}

/* √î input L∆∞∆°ng/gi·ªù */
#rate {
    border: none; /* B·ªè border v√¨ ƒë√£ c√≥ cho c·∫£ nh√≥m */
    width: 65px; 
    padding: 8px;
    box-sizing: border-box;
    text-align: right;
}

/* √î ch·ªçn ti·ªÅn t·ªá (Gi·∫•u ƒëi) */
#currency {
    display: none; 
}

/* Hi·ªÉn th·ªã ƒë∆°n v·ªã ti·ªÅn t·ªá */
#currencyDisplay {
    font-size: 0.9em;
    font-weight: bold;
    color: #555;
    margin-left: -5px; /* K√©o s√°t v√†o input */
}

/* Label */
#rateLabel {
    white-space: nowrap; 
    margin-right: 4px; 
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="month-nav">
            <span class="arrow" id="prevMonth">‚óÄ</span>
            <span id="monthYear"></span>
            <span class="arrow" id="nextMonth">‚ñ∂</span>
        </div>
        <div id="rateSection"></div>
    </div>
    
    <table>
        <thead>
            <tr id="tableHeaders"></tr>
        </thead>
        <tbody id="calendar"></tbody>
    </table>

    <div class="summary">
        <span id="labelTotalHours"></span>: <span id="totalHours">0</span> <span id="unitHours"></span><br>
        <span id="labelTotalPay"></span>: <span id="totalPay">0 VND</span>
    </div>
</div>

<div class="modal" id="timeModal">
    <div class="modal-content">
        <h3 id="modalTitle"></h3>
        <span id="modalDate"></span>
        <label id="labelTimeIn"></label>
        <input type="time" id="timeIn" value="09:00">
        <label id="labelTimeOut"></label>
        <input type="time" id="timeOut" value="18:00">
        <button class="save" id="saveTime"></button>
        <button class="cancel" id="cancelTime"></button>
    </div>
</div>

<script>
// --- KHAI B√ÅO NG√îN NG·ªÆ ---
const LANG = {
    'vi': {
        currency: 'VND',
        rateLabel: 'üí∞ L∆∞∆°ng/gi·ªù:',
        dayNames: ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'], 
        totalHoursLabel: '‚úÖ T·ªïng gi·ªù',
        totalPayLabel: 'üíµ Thu nh·∫≠p',
        hourUnit: 'gi·ªù',
        modalTitle: 'Nh·∫≠p gi·ªù c√¥ng -',
        timeInLabel: 'V√†o:',
        timeOutLabel: 'Ra:',
        saveBtn: 'L∆∞u',
        cancelBtn: 'H·ªßy',
        locale: 'vi-VN'
    },
    'kr': {
        currency: 'KRW',
        rateLabel: 'üí∞ ÏãúÍ∏â:',
        dayNames: ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'], 
        totalHoursLabel: '‚úÖ Ï¥ù Í∑ºÎ¨¥ ÏãúÍ∞Ñ',
        totalPayLabel: 'üíµ Ï¥ù ÏàòÏùµ',
        hourUnit: 'ÏãúÍ∞Ñ',
        modalTitle: 'Í∑ºÎ¨¥ ÏãúÍ∞Ñ ÏûÖÎ†• -',
        timeInLabel: 'Ï∂úÍ∑º:',
        timeOutLabel: 'Ìá¥Í∑º:',
        saveBtn: 'Ï†ÄÏû•',
        cancelBtn: 'Ï∑®ÏÜå',
        locale: 'ko-KR'
    }
};

// --- KHAI B√ÅO BI·∫æN & KH·ªûI T·∫†O DOM CHO RATE SECTION (ƒê√É THAY ƒê·ªîI C·∫§U TR√öC) ---
let currentLang = 'vi'; 
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let workData = JSON.parse(localStorage.getItem('workData') || '{}'); 

// 1. T·∫°o c√°c ph·∫ßn t·ª≠
const rateInput = document.createElement('input');
rateInput.type = 'text'; 
rateInput.id = 'rate';
rateInput.value = '100.000'; 

const currencySelect = document.createElement('select'); // V·∫´n c·∫ßn ƒë·ªÉ chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ/locale
currencySelect.id = 'currency';
currencySelect.innerHTML = '<option value="VND">VND</option><option value="KRW">KRW</option>';

const currencyDisplay = document.createElement('span'); // Th·∫ª hi·ªÉn th·ªã ƒë∆°n v·ªã ti·ªÅn t·ªá
currencyDisplay.id = 'currencyDisplay';

const rateLabelSpan = document.createElement('span');
rateLabelSpan.id = 'rateLabel';

const inputGroupDiv = document.createElement('div'); // Nh√≥m input v√† display
inputGroupDiv.id = 'rateInputGroup';
inputGroupDiv.appendChild(rateInput);
inputGroupDiv.appendChild(currencyDisplay);

// 2. Ch√®n v√†o rateSection
const rateSection = document.getElementById('rateSection');
rateSection.appendChild(rateLabelSpan);
rateSection.appendChild(inputGroupDiv);
rateSection.appendChild(currencySelect); // Th·∫ª select ·∫©n

// --- H√ÄM X·ª¨ L√ù ƒê·ªäNH D·∫†NG S·ªê TI·ªÄN ---
function formatCurrencyInput(value) {
    let rawValue = value.replace(/[^0-9]/g, ''); 
    if (rawValue === '') return '';
    const number = parseInt(rawValue, 10);
    return number.toLocaleString('vi-VN'); 
}

function getRateValue(value) {
    return parseFloat(value.replace(/\./g, '')) || 0;
}

// --- H√ÄM C·∫¨P NH·∫¨T NG√îN NG·ªÆ & SUMMARY ---
function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}

function updateLanguage(langCode) {
    currentLang = langCode;
    const lang = LANG[langCode];
    
    // C·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c chu·ªói text tƒ©nh tr√™n trang
    document.getElementById('tableHeaders').innerHTML = lang.dayNames.map(day => `<th>${day}</th>`).join('');
    document.getElementById('rateLabel').textContent = lang.rateLabel + ' ';
    
    // C·∫≠p nh·∫≠t ƒë∆°n v·ªã ti·ªÅn t·ªá hi·ªÉn th·ªã (M·ªöI)
    document.getElementById('currencyDisplay').textContent = lang.currency;

    document.getElementById('labelTotalHours').textContent = lang.totalHoursLabel;
    document.getElementById('unitHours').textContent = lang.hourUnit;
    document.getElementById('labelTotalPay').textContent = lang.totalPayLabel;
    document.getElementById('modalTitle').textContent = lang.modalTitle;
    document.getElementById('labelTimeIn').textContent = lang.timeInLabel;
    document.getElementById('labelTimeOut').textContent = lang.timeOutLabel;
    document.getElementById('saveTime').textContent = lang.saveBtn;
    document.getElementById('cancelTime').textContent = lang.cancelBtn;

    updateSummary();
    renderCalendar(false); 
}

function updateSummary(){
    const rate=getRateValue(rateInput.value); 
    const selectedCurrency=currencySelect.value;
    const lang = selectedCurrency === 'VND' ? LANG['vi'] : LANG['kr']; 
    let totalH=0; 
    
    for(const k in workData) totalH+=workData[k].hours||0;
    
    let finalPay = totalH * rate;
    
    // ƒê·ªãnh d·∫°ng hi·ªÉn th·ªã ti·ªÅn t·ªá
    let displayPay = finalPay.toLocaleString(lang.locale, { maximumFractionDigits: 0 }) + ' ' + selectedCurrency;
    
    document.getElementById('totalHours').textContent=totalH.toFixed(2);
    document.getElementById('unitHours').textContent = lang.hourUnit;
    document.getElementById('totalPay').textContent=displayPay;

    localStorage.setItem('workData',JSON.stringify(workData));
}

function renderCalendar(shouldUpdateLang = true){
    const tbl=document.getElementById('calendar');
    tbl.innerHTML='';
    const firstDay=new Date(currentYear,currentMonth,1).getDay();
    const totalDays=daysInMonth(currentYear,currentMonth);
    
    const selectedCurrency = currencySelect.value;
    const langCodeForDisplay = selectedCurrency === 'VND' ? 'vi' : 'kr';
    const monthYearSeparator = langCodeForDisplay === 'vi' ? '/' : '.';
    
    document.getElementById('monthYear').textContent=`${currentMonth+1}${monthYearSeparator}${currentYear}`;
    
    if (shouldUpdateLang) {
        updateLanguage(selectedCurrency === 'VND' ? 'vi' : 'kr');
    }
    
    let day=1; 
    for(let r=0;r<6;r++){
        const tr=document.createElement('tr');
        for(let c=0;c<7;c++){
            const td=document.createElement('td');
            if(r===0&&c<firstDay||day>totalDays){
                td.innerHTML='';
            } else {
                const dkey=`${currentYear}-${currentMonth+1}-${day}`;
                const info=workData[dkey]||{};
                td.className='day'; 
                td.innerHTML=`<span>${day}</span>${info.hours?`<div>${info.hours.toFixed(2)}h</div>`:''}`;
                td.onclick=()=>openModal(dkey);
                day++;
            }
            tr.appendChild(td);
        } 
        tbl.appendChild(tr);
        if(day>totalDays)break;
    }
    updateSummary();
}

function openModal(key){
    const m=document.getElementById('timeModal');m.style.display='flex';
    const dateParts=key.split('-');
    
    const dateSeparator = currentLang === 'vi' ? '/' : '.';
    document.getElementById('modalDate').textContent=`${dateParts[2]}${dateSeparator}${dateParts[1]}`;
    
    m.dataset.key=key;
    const info=workData[key]||{};
    document.getElementById('timeIn').value=info.in||'09:00';
    document.getElementById('timeOut').value=info.out||'18:00';
}

// --- C√ÅC S·ª∞ KI·ªÜN ---
document.getElementById('saveTime').onclick=()=>{
    const key=document.getElementById('timeModal').dataset.key;
    const [hi,mi]=document.getElementById('timeIn').value.split(':').map(Number);
    const [ho,mo]=document.getElementById('timeOut').value.split(':').map(Number);
    let hrs=(ho+mo/60)-(hi+mi/60);
    
    if(hrs < 0) {
        hrs += 24; 
    }
    
    workData[key]={in:document.getElementById('timeIn').value,out:document.getElementById('timeOut').value,hours:hrs};
    document.getElementById('timeModal').style.display='none';
    renderCalendar();
};

document.getElementById('cancelTime').onclick=()=>document.getElementById('timeModal').style.display='none';
document.getElementById('prevMonth').onclick=()=>{currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();};
document.getElementById('nextMonth').onclick=()=>{currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();};

// S·ª± ki·ªán cho input rate:
rateInput.onchange = updateSummary;
rateInput.onblur = () => {
    if (currencySelect.value === 'VND') {
        rateInput.value = formatCurrencyInput(rateInput.value);
    }
    updateSummary();
};

// S·ª± ki·ªán cho currency select (V·∫´n d√πng n√≥ ƒë·ªÉ k√≠ch ho·∫°t chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ)
currencySelect.onchange=()=>{
    const newCurrency = currencySelect.value;
    const newLang = newCurrency === 'VND' ? 'vi' : 'kr';
    
    // X·ª≠ l√Ω ƒë·ªãnh d·∫°ng input khi chuy·ªÉn ƒë·ªïi
    if (newCurrency === 'KRW') {
        rateInput.value = getRateValue(rateInput.value);
    } else {
        rateInput.value = formatCurrencyInput(String(getRateValue(rateInput.value)));
    }
    updateLanguage(newLang);
    renderCalendar(false);
}; 

// --- KH·ªûI T·∫†O ·ª®NG D·ª§NG ---

// K√≠ch ho·∫°t t√≠nh nƒÉng chuy·ªÉn ƒë·ªïi ng√¥n ng·ªØ b·∫±ng c√°ch click v√†o ƒë∆°n v·ªã hi·ªÉn th·ªã
currencyDisplay.onclick = () => {
    const current = currencySelect.value;
    const next = current === 'VND' ? 'KRW' : 'VND';
    currencySelect.value = next; // Thay ƒë·ªïi gi√° tr·ªã select (ƒëang ·∫©n)
    
    // K√≠ch ho·∫°t s·ª± ki·ªán onchange ƒë·ªÉ ƒë·ªïi ng√¥n ng·ªØ v√† ƒë·ªãnh d·∫°ng
    currencySelect.onchange();
};

updateLanguage('vi'); 
renderCalendar(false);
</script>
</body>
</html>
