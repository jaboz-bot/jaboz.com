<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>B·∫£ng Ch·∫•m C√¥ng C√° Nh√¢n</title>
<style>
/* CSS C∆† B·∫¢N V√Ä CHUNG */
html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#f6f8f9}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;padding-bottom:10px}
.month-nav{display:flex;align-items:center;gap:8px;font-weight:bold;color:#27ae60}
.arrow{cursor:pointer;user-select:none;font-size:1.3em}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;text-align:center;padding:5px;font-size:.85em}
/* C·ªôt ti√™u ƒë·ªÅ m·∫∑c ƒë·ªãnh */
th{background:#eaf2f8}
.day{position:relative;height:80px;vertical-align:top;cursor:pointer}
.day span{position:absolute;top:3px;left:5px;font-weight:bold;color:#2980b9}
.day div{position:absolute;bottom:3px;left:0;width:100%;font-size:.8em;color:#27ae60}
.summary{margin-top:20px;background:#ecf9ff;padding:10px;border-radius:5px}

/* CSS CHO MODAL CHUNG */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px}
.modal-content input[type="text"], .modal-content input[type="date"], .modal-content input[type="time"]{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}
.modal-content button{margin-top:10px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer}
.save{background:#3498db;color:#fff}
.cancel{background:#ccc}

/* CƒÉn ch·ªânh cho Input gi·ªù (trong timeModal) */
#timeModal .modal-content input[type="time"] {
    width: 48%;
    display: inline-block;
}

/* --- CSS ƒê√É TH√äM CHO Y√äU C·∫¶U C≈® V√Ä M·ªöI --- */

/* 1. B√¥i ƒë·ªè c·ªôt Ch·ªß Nh·∫≠t (C·ªôt ƒë·∫ßu ti√™n) */
table th:first-child {
    background: #e74c3c; /* M√†u ƒë·ªè ƒë·∫≠m cho ti√™u ƒë·ªÅ */
    color: #fff;
}
table tr td:first-child {
    background-color: #fcecec; /* M√†u ƒë·ªè nh·∫°t cho √¥ n·ªôi dung */
}
/* ƒê·ªïi m√†u ch·ªØ s·ªë ng√†y c·ªßa CN th√†nh m√†u ƒë·ªè ƒë·∫≠m */
table tr td:first-child span {
    color: #c0392b !important; 
}

/* 2. L√†m t·ªëi m√†u √¥ tr·ªëng (√¥ kh√¥ng c√≥ ng√†y th√°ng) */
/* Th·∫ª td kh√¥ng c√≥ n·ªôi dung text ho·∫∑c span (ng√†y) */
table tr td:empty {
    background-color: #dddddd; /* M√†u x√°m t·ªëi */
    cursor: default;
}

/* 3. T√πy bi·∫øn khung nh·∫≠p L∆∞∆°ng/gi·ªù */
.header input#rate {
    min-width: 70px; /* **ƒêI·ªÄU CH·ªàNH: Chi·ªÅu r·ªông t·ªëi thi·ªÉu ng·∫Øn h∆°n** */
    width: 70px; /* ƒê·∫£m b·∫£o tr·∫°ng th√°i ban ƒë·∫ßu l√† 70px */
    transition: width 0.2s ease-in-out; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† */
    text-align: right; /* CƒÉn s·ªë sang ph·∫£i cho ƒë·∫πp */
}

</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="month-nav">
            <span class="arrow" id="prevMonth">‚óÄ</span>
            <span id="monthYear"></span>
            <span class="arrow" id="nextMonth">‚ñ∂</span>
        </div>
        <div>
            üí∞ L∆∞∆°ng/gi·ªù: <input type="number" id="rate" value="100000"> VND
        </div>
    </div>
    
    <table>
        <thead>
            <tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr>
        </thead>
        <tbody id="calendar"></tbody>
    </table>

    <div class="summary">
        ‚úÖ T·ªïng gi·ªù: <span id="totalHours">0</span> gi·ªù<br>
        üíµ Thu nh·∫≠p: <span id="totalPay">0</span> VND
    </div>
</div>

<div class="modal" id="timeModal">
    <div class="modal-content">
        <h3>Nh·∫≠p gi·ªù c√¥ng - <span id="modalDate"></span></h3>
        <label>V√†o:</label>
        <input type="time" id="timeIn" value="09:00">
        <label>Ra:</label>
        <input type="time" id="timeOut" value="18:00">
        <button class="save" id="saveTime">L∆∞u</button>
        <button class="cancel" id="cancelTime">H·ªßy</button>
    </div>
</div>

<script>
// --- KHAI B√ÅO BI·∫æN ---
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let workData = JSON.parse(localStorage.getItem('workData') || '{}'); 
const rateInput = document.getElementById('rate');

// --- H√ÄM CHUNG ---
function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}

// H√ÄM M·ªöI: T√πy bi·∫øn chi·ªÅu r·ªông khung nh·∫≠p L∆∞∆°ng/gi·ªù
function adjustRateInputWidth() {
    const val = String(rateInput.value).replace(/[^0-9]/g, '');
    const length = val.length;

    let newWidth = 70; // **ƒêI·ªÄU CH·ªàNH: Chi·ªÅu r·ªông t·ªëi thi·ªÉu m·ªõi**
    const pixelPerChar = 10; // Gi·∫£m t·ªëc ƒë·ªô m·ªü r·ªông ƒë·ªÉ kh√¥ng qu√° nhanh

    // T·ª´ 4 ch·ªØ s·ªë tr·ªü l√™n, tƒÉng 10px cho m·ªói ch·ªØ s·ªë
    if (length >= 4) {
        newWidth = 70 + (length - 4) * pixelPerChar; 
    }
    // Gi·ªõi h·∫°n ƒë·ªô d√†i t·ªëi ƒëa
    if (length > 12) { 
        newWidth = 70 + (12 - 4) * pixelPerChar;
    }

    // √Åp d·ª•ng chi·ªÅu r·ªông m·ªõi
    rateInput.style.width = `${newWidth}px`;
}


function updateSummary(){
    const rate=parseFloat(rateInput.value)||0;
    let totalH=0;  
    for(const k in workData) totalH+=workData[k].hours||0;
    
    document.getElementById('totalHours').textContent=totalH.toFixed(2);
    document.getElementById('totalPay').textContent=(totalH*rate).toLocaleString('vi-VN');
    localStorage.setItem('workData',JSON.stringify(workData));
}

function renderCalendar(){
    const tbl=document.getElementById('calendar');
    tbl.innerHTML='';
    const firstDay=new Date(currentYear,currentMonth,1).getDay();
    const totalDays=daysInMonth(currentYear,currentMonth);
    document.getElementById('monthYear').textContent=`${currentMonth+1}/${currentYear}`;
    let day=1; 
    for(let r=0;r<6;r++){
        const tr=document.createElement('tr');
        for(let c=0;c<7;c++){
            const td=document.createElement('td');
            if(r===0&&c<firstDay||day>totalDays){
                // N·∫øu l√† √¥ tr·ªëng, ƒë·ªÉ tr·ªëng innerHTML
                td.innerHTML='';
            } else {
                const dkey=`${currentYear}-${currentMonth+1}-${day}`;
                const info=workData[dkey]||{};
                td.className='day'; 
                // √î c√≥ n·ªôi dung ng√†y th√°ng s·∫Ω c√≥ span, td:empty s·∫Ω kh√¥ng √°p d·ª•ng
                td.innerHTML=`<span>${day}</span>${info.hours?`<div>${info.hours.toFixed(2)}h</div>`:''}`;
                td.onclick=()=>openModal(dkey);
                day++;
            }
            tr.appendChild(td);
        } 
        tbl.appendChild(tr);
        if(day>totalDays)break;
    }
    updateSummary();
}

function openModal(key){
    const m=document.getElementById('timeModal');m.style.display='flex';
    const dateParts=key.split('-');document.getElementById('modalDate').textContent=`${dateParts[2]}/${dateParts[1]}`;
    m.dataset.key=key;
    const info=workData[key]||{};
    document.getElementById('timeIn').value=info.in||'09:00';
    document.getElementById('timeOut').value=info.out||'18:00';
}

// --- C√ÅC S·ª∞ KI·ªÜN KH√ÅC ---
document.getElementById('saveTime').onclick=()=>{
    const key=document.getElementById('timeModal').dataset.key;
    const tin=document.getElementById('timeIn').value;
    const tout=document.getElementById('timeOut').value;
    const [hi,mi]=tin.split(':').map(Number);const [ho,mo]=tout.split(':').map(Number);
    let hrs=(ho+mo/60)-(hi+mi/60);
    
    // Logic t√≠nh gi·ªù l√†m vi·ªác qua ƒë√™m
    if(hrs < 0) {
        hrs += 24;
    }
    
    workData[key]={in:tin,out:tout,hours:hrs};
    document.getElementById('timeModal').style.display='none';
    renderCalendar();
};
document.getElementById('cancelTime').onclick=()=>document.getElementById('timeModal').style.display='none';
document.getElementById('prevMonth').onclick=()=>{currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();};
document.getElementById('nextMonth').onclick=()=>{currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();};

// G√°n s·ª± ki·ªán cho input L∆∞∆°ng/gi·ªù
rateInput.oninput = adjustRateInputWidth; // Thay ƒë·ªïi chi·ªÅu r·ªông khi nh·∫≠p
rateInput.onchange = updateSummary; // C·∫≠p nh·∫≠t t·ªïng thu nh·∫≠p khi gi√° tr·ªã thay ƒë·ªïi

// --- KH·ªûI T·∫†O ·ª®NG D·ª§NG ---
renderCalendar();
adjustRateInputWidth(); // Thi·∫øt l·∫≠p chi·ªÅu r·ªông ban ƒë·∫ßu
</script>
</body>
</html>
