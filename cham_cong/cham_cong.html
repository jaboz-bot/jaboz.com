<!DOCTYPE html>

<html lang="vi">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>B·∫£ng Ch·∫•m C√¥ng C√° Nh√¢n</title>

<style>

/* --- PH·∫¶N CSS HO√ÄN CH·ªàNH --- */

html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#f6f8f9}

.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}

/* ƒê·ªãnh d·∫°ng khu v·ª±c n√∫t v√† danh s√°ch c√¥ng vi·ªác */

.top-controls {

    display: flex;

    justify-content: space-between;

    align-items: center;

    padding-bottom: 10px;

    margin-bottom: 5px; 

    border-bottom: 1px solid #ddd;

}

.control-group { display:flex; gap:10px; }

.add-job-btn, .lang-toggle-btn {

    padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;

    font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,.1); white-space: nowrap;

}

.add-job-btn { background:#2ecc71; color:#fff; }

.lang-toggle-btn { background:#f1c40f; color:#333; font-size:.9em; padding:8px 12px; }

/* CSS CHO CAROUSEL */

#jobCarousel {

    display:flex; overflow-x:auto; scroll-snap-type:x mandatory; scroll-behavior:smooth; -webkit-overflow-scrolling:touch;

    margin-bottom:15px; border:1px solid #e0e0e0; border-radius:8px; padding:10px; background:#f7f7f7; box-shadow:inset 0 0 5px rgba(0,0,0,.05);

    min-height:72px;

}

.job-item {

    min-width:100%; flex-shrink:0; padding:10px 12px; font-size:.95em; color:#333; cursor:pointer; scroll-snap-align:start; box-sizing:border-box;

    transition:background-color .15s ease;

}

.job-item.selected { background-color:#d7e8f5; border:1px solid #2980b9; border-radius:5px; }

.job-item strong { color:#2980b9; display:block; font-size:1.15em; }

.job-item span { color:#7f8c8d; display:block; margin-top:4px; font-size:.9em; }

.job-item:hover { background-color:#eaf2f8; }

.job-item.selected:hover { background-color:#d7e8f5; }

/* CSS CHUNG B·∫¢NG L·ªäCH */

.header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;padding-bottom:10px}

.month-nav{display:flex;align-items:center;gap:8px;font-weight:bold;color:#27ae60}

.arrow{cursor:pointer;user-select:none;font-size:1.3em}

#calendarTable{position:relative;overflow:hidden}
table{width:100%;border-collapse:collapse;margin-top:10px;table-layout:fixed}
#calendarTable table{transition:transform 0.25s ease, opacity 0.25s ease}
#calendarTable.flipping-left table{transform:translateX(-100%);opacity:0}
#calendarTable.flipping-right table{transform:translateX(100%);opacity:0}
#calendarTable table.fade-in{animation:fadeIn 0.25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateX(0)}to{opacity:1;transform:translateX(0)}}

th,td{border:1px solid #ccc;text-align:center;padding:5px;font-size:.85em}

th{background:#eaf2f8}

/* √î ng√†y */

.day{position:relative;height:80px;vertical-align:top;cursor:pointer;padding-top:20px}

.day span{position:absolute;top:3px;left:5px;font-weight:bold;color:#2980b9;z-index:1;}

.day .today-dot{position:absolute;top:3px;left:18px;width:6px;height:6px;background:#f1c40f;border-radius:50%;z-index:2;}

#monthYear{cursor:pointer;user-select:none;}

.day div{width:100%;margin-top:5px;text-align:center;line-height:1.2}

.day .hours-display{font-weight:bold;color:#2ecc71;font-size:.9em}

.day .pay-display{color:#e74c3c;font-size:.8em;font-weight:normal;margin-top:2px}

/* ƒê√°nh d·∫•u ng√†y tr·∫£ l∆∞∆°ng */

.payday-cell{background:#e8f8ec !important;}

.job-date-cell{background:#fff3e0 !important;}

/* Khi c·∫£ ng√†y tr·∫£ l∆∞∆°ng v√† ng√†y b·∫Øt ƒë·∫ßu/k·∫øt th√∫c tr√πng nhau */
.payday-cell.job-date-cell{background:#ffeaa7 !important;}

/* Container cho c√°c ghi ch√∫ */
.notes-container{position:absolute;bottom:2px;left:50%;transform:translateX(-50%);max-width:90%;display:flex;flex-direction:column;align-items:center;gap:1px;pointer-events:none;}

.payday-note{font-size:.6em;color:#e74c3c;font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;text-align:center;}

.job-date-note{font-size:.6em;color:#f57c00;font-style:italic;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;width:100%;text-align:center;}

/* Summary + n√∫t m√°y t√≠nh (n√∫t ·ªü gi·ªØa d√≤ng cu·ªëi) */

.summary{position:sticky;bottom:0;margin-top:20px;background:#ecf9ff;padding:10px;border-radius:5px;z-index:100;box-shadow:0 -2px 10px rgba(0,0,0,0.1)}

.summary .notice{color:#e74c3c;font-style:italic;display:none;margin-bottom:4px}

#totalHours{font-weight:bold;color:#2ecc71;font-size:1.1em}

.summary .green-unit{color:#2ecc71;font-weight:bold}

#totalPay{font-weight:bold;color:#e74c3c;font-size:1.1em}

.summary .red-unit{color:#e74c3c;font-weight:bold}

.calc-open-btn{

    position: static;

    display: block;

    margin: 12px auto 0;

    background:#8e44ad; color:#fff; border:none; border-radius:6px; padding:10px 14px; cursor:pointer;

    font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,.15);

}

/* Modal chung */

.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}

.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:420px}

.modal-content input[type="text"], .modal-content input[type="date"], .modal-content input[type="number"], .modal-content select{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}

.button-group{display:flex;justify-content:space-between;align-items:center}

.modal-content button{margin-top:15px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer}

.save{background:#3498db;color:#fff}

.cancel{background:#ccc}

.delete{background:#e74c3c;color:#fff}

/* T√πy ch·ªânh Calendar v√† Input L∆∞∆°ng/gi·ªù */

table th:first-child{background:#e74c3c;color:#fff}

table tr td:first-child{background-color:#fcecec}

table tr td:first-child span{color:#c0392b !important}

table tr td:empty{background-color:#dddddd;cursor:default}

.header input#rate{min-width:60px;width:60px;transition:width .2s ease-in-out;text-align:right}

.time-input-group{display:flex;align-items:center;margin-bottom:10px}

.time-input-group label{font-weight:bold;width:40px;text-align:left;margin-right:10px}

.time-input-group input[type="time"]{flex-grow:1;padding:8px;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;width:auto}

/* Modal m√°y t√≠nh */

.calc-content{max-width:320px}

.calc-display{

    width:100%; padding:10px; border:1px solid #ccc; border-radius:6px;

    font-size:1.2em; text-align:right; box-sizing:border-box; margin-bottom:10px;

}

.calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}

.calc-grid button{padding:12px;font-size:1em;border:none;border-radius:6px;cursor:pointer;background:#f1f1f1}

.calc-grid button.op{background:#e8f0fe}

.calc-grid button.equals{background:#2ecc71;color:#fff}

.calc-grid button.clear{background:#e74c3c;color:#fff}

.calc-grid button.back{background:#f39c12;color:#fff}

/* Media query cho mobile */
@media (max-width: 768px) {
    .container {
        margin: 10px auto;
        padding: 12px;
    }
    
    .top-controls {
        padding-bottom: 8px;
        margin-bottom: 5px;
    }
    
    #jobCarousel {
        padding: 8px;
        margin-bottom: 12px;
    }
    
    .header {
        padding-bottom: 8px;
    }
    
    .summary {
        padding: 8px;
        margin-top: 15px;
    }
    
    .modal-content {
        padding: 15px;
    }
    
    th, td {
        padding: 3px;
        font-size: 0.8em;
    }
    
    .day {
        height: 70px;
        padding-top: 15px;
    }
}

</style>

</head>

<body>

<div class="container">

    <div class="top-controls">

        <div class="control-group">

            <button class="add-job-btn" id="openJobModal" data-i18n="manage_jobs">‚ûï Qu·∫£n l√Ω N∆°i l√†m vi·ªác</button>

        </div>

        <button class="lang-toggle-btn" id="langToggle">üá∞üá∑ Korean</button>

    </div>

    

    <div id="jobCarousel"></div>

    <div class="header"> 

        <div class="month-nav">

            <span class="arrow" id="prevMonth">‚óÄÔ∏è</span>

            <span id="monthYear"></span>

            <span class="arrow" id="nextMonth">‚ñ∂Ô∏è</span>

        </div>

        <div>

            <span data-i18n="rate_per_hour">üí∞ L∆∞∆°ng/gi·ªù:</span>

            <input type="text" id="rate" value="10.000">

            <span id="currencyUnit">VND</span>

        </div>

    </div>

    

    <div id="calendarTable"> 

        <table>

            <thead>

                <tr id="calendarHeaders">

                    <th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th>

                </tr>

            </thead>

            <tbody id="calendar"></tbody>

        </table>

    </div>

    <div class="summary">

        <div id="paydayNotice" class="notice" data-i18n="payday_notice">Vui l√≤ng nh·∫≠p ng√†y tr·∫£ l∆∞∆°ng ƒë·ªÉ c√≥ thu nh·∫≠p ch√≠nh x√°c</div>

        ‚úÖ <span id="totalHoursLabel">T·ªïng gi·ªù th√°ng 00:</span> <span id="totalHours">0</span> <span class="green-unit" data-i18n="hours_unit">GI·ªú</span><br>

        üíµ <span id="totalPayLabel">Thu nh·∫≠p th√°ng 00:</span> <span id="totalPay">0</span> <span class="red-unit" data-i18n="unit_vnd">VND</span>

        <button class="calc-open-btn" id="openCalc" data-i18n="calculator_button">üßÆ M√°y t√≠nh</button>

    </div>

</div>

<div class="modal" id="timeModal">

    <div class="modal-content">

        <h3 data-i18n="modal_time_title">Nh·∫≠p gi·ªù c√¥ng - <span id="modalDate"></span></h3>

        <div class="time-input-group">

            <label for="timeIn" data-i18n="time_in">V√†o:</label>

            <input type="time" id="timeIn" value="09:00">

        </div>

        <div class="time-input-group">

            <label for="timeOut" data-i18n="time_out">Ra:</label>

            <input type="time" id="timeOut" value="18:00">

        </div>

        <div class="button-group">

            <div style="display:flex;gap:10px;margin-left:auto;">

                <button class="delete" id="deleteTime" data-i18n="delete">X√≥a</button>

                <button class="cancel" id="cancelTime" data-i18n="cancel">H·ªßy</button>

                <button class="save" id="saveTime" data-i18n="save">L∆∞u</button>

            </div>

        </div>

    </div>

</div>

<div class="modal" id="jobModal">

    <div class="modal-content">

        <h3 id="jobModalTitle" data-i18n="modal_job_add_title">Th√™m N∆°i l√†m vi·ªác m·ªõi</h3>

        <div class="input-group">

            <label for="jobName" data-i18n="job_name">T√™n N∆°i l√†m vi·ªác:</label>

            <input type="text" id="jobName" data-i18n-placeholder="job_name_placeholder" placeholder="T√™n c√¥ng ty/D·ª± √°n..." required>

        </div>

        <div class="input-group">

            <label for="jobAddress" data-i18n="job_address">ƒê·ªãa ch·ªâ:</label>

            <input type="text" id="jobAddress" data-i18n-placeholder="job_address_placeholder" placeholder="ƒê·ªãa ch·ªâ n∆°i l√†m vi·ªác (VD: 123 ƒë∆∞·ªùng ABC)">

        </div>

        <div class="input-group">

            <label for="jobStartDate" data-i18n="job_start_date">Ng√†y B·∫Øt ƒë·∫ßu:</label>

            <input type="date" id="jobStartDate" required>

        </div>

        <div class="input-group">

            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:5px;">
                <label for="jobEndDate" data-i18n="job_end_date" style="margin:0;">Ng√†y ngh·ªâ vi·ªác:</label>
                <label style="display:flex;align-items:center;margin:0;cursor:pointer;">
                    <input type="checkbox" id="jobIsCurrent" data-i18n-placeholder="job_is_current" style="margin-right:5px;"> 
                    <span data-i18n="job_is_current">ƒêang l√†m</span>
                </label>
            </div>

            <input type="date" id="jobEndDate">

        </div>

        <div class="input-group">

            <label for="jobPayday" data-i18n="job_payday_label">Ng√†y tr·∫£ l∆∞∆°ng (1-31):</label>

            <input type="number" id="jobPayday" min="1" max="31" data-i18n-placeholder="job_payday_placeholder" placeholder="VD: 10">

        </div>

        <div class="job-button-group" style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">

            <button class="delete" id="deleteJob" data-i18n="delete">X√≥a</button>

            <div class="right-buttons">

                <button class="cancel" id="cancelJob" data-i18n="cancel">H·ªßy</button>

                <button class="save" id="saveJob" data-i18n="save">L∆∞u</button>

            </div>

        </div>

    </div>

</div>

<!-- Modal M√°y t√≠nh -->

<div class="modal" id="calcModal">

    <div class="modal-content calc-content">

        <h3 data-i18n="calculator_title">M√°y t√≠nh</h3>

        <input id="calcDisplay" class="calc-display" type="text" value="" readonly>

        <div class="calc-grid">

            <button data-val="7">7</button>

            <button data-val="8">8</button>

            <button data-val="9">9</button>

            <button class="op" data-val="/">/</button>

            <button data-val="4">4</button>

            <button data-val="5">5</button>

            <button data-val="6">6</button>

            <button class="op" data-val="*">*</button>

            <button data-val="1">1</button>

            <button data-val="2">2</button>

            <button data-val="3">3</button>

            <button class="op" data-val="-">-</button>

            <button data-val="0">0</button>

            <button data-val=".">.</button>

            <button class="equals" data-action="equals">=</button>

            <button class="op" data-val="+">+</button>

            <button class="clear" data-action="clear">C</button>

            <button class="back" data-action="back">‚Üê</button>

            <button class="cancel" id="closeCalc" style="grid-column: span 2;" data-i18n="close">ƒê√≥ng</button>

        </div>

    </div>

</div>

<script>

// Tr·∫°ng th√°i

let currentMonth = new Date().getMonth();

let currentYear = new Date().getFullYear();

let workData = JSON.parse(localStorage.getItem('workData') || '{}');

let appSettings = JSON.parse(localStorage.getItem('appSettings') || '{}');

let jobs = JSON.parse(localStorage.getItem('jobs') || '[]');

let editingJobId = null;

let currentLang = localStorage.getItem('currentLang') || 'vi';

// Elements

const rateInput = document.getElementById('rate');

const jobModal = document.getElementById('jobModal');

const timeModal = document.getElementById('timeModal');

const jobCarouselDiv = document.getElementById('jobCarousel');

const langToggleBtn = document.getElementById('langToggle');

const calendarTable = document.getElementById('calendarTable');

const currencyUnitSpan = document.getElementById('currencyUnit');

const paydayNotice = document.getElementById('paydayNotice');

// D·ªãch

const translations = {

    vi: {

        days: ['CN','T2','T3','T4','T5','T6','T7'],

        currency: 'VND',

        manage_jobs: '‚ûï Qu·∫£n l√Ω N∆°i l√†m vi·ªác',

        rate_per_hour: 'üí∞ L∆∞∆°ng/gi·ªù:',

        modal_time_title: 'Nh·∫≠p gi·ªù c√¥ng -',

        time_in: 'V√†o:',

        time_out: 'Ra:',

        delete: 'X√≥a',

        cancel: 'H·ªßy',

        save: 'L∆∞u',

        modal_job_add_title: 'Th√™m N∆°i l√†m vi·ªác m·ªõi',

        modal_job_edit_title: 'Ch·ªânh s·ª≠a N∆°i l√†m vi·ªác',

        job_name: 'T√™n N∆°i l√†m vi·ªác:',

        job_address: 'ƒê·ªãa ch·ªâ:',

        job_start_date: 'Ng√†y B·∫Øt ƒë·∫ßu:',

        job_end_date: 'Ng√†y ngh·ªâ vi·ªác:',

        job_is_current: 'ƒêang l√†m',

        alert_job_required: 'T√™n v√† Ng√†y B·∫Øt ƒë·∫ßu l√† b·∫Øt bu·ªôc.',

        alert_date_invalid: 'Ng√†y ngh·ªâ vi·ªác ph·∫£i sau ho·∫∑c b·∫±ng Ng√†y B·∫Øt ƒë·∫ßu.',

        alert_delete_confirm: (name) => `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a n∆°i l√†m vi·ªác ${name} kh√¥ng? Vi·ªác n√†y s·∫Ω x√≥a t·∫•t c·∫£ gi·ªù c√¥ng li√™n quan!`,

        alert_time_job_required: 'Vui l√≤ng th√™m N∆°i l√†m vi·ªác tr∆∞·ªõc khi ch·∫•m c√¥ng.',

        alert_delete_time_confirm: (jobName) => `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a gi·ªù c√¥ng c·ªßa ng√†y n√†y cho ${jobName} kh√¥ng?`,

        job_date_current: 'ƒêang l√†m',

        job_date_from: 'T·ª´',

        job_date_to: 'ƒë·∫øn',

        unit_vnd: 'VND',

        payday_note: 'Tr·∫£ l∆∞∆°ng',

        payday_label: 'üí¥ Ng√†y TL:',

        job_start_date_note: 'B·∫Øt ƒë·∫ßu',

        job_end_date_note: 'Ngh·ªâ vi·ªác',

        job_payday_label: 'Ng√†y tr·∫£ l∆∞∆°ng (1-31):',

        job_name_placeholder: 'T√™n c√¥ng ty/D·ª± √°n...',

        job_address_placeholder: 'ƒê·ªãa ch·ªâ n∆°i l√†m vi·ªác (VD: 123 ƒë∆∞·ªùng ABC)',

        job_payday_placeholder: 'VD: 10',

        calculator_title: 'M√°y t√≠nh',

        calculator_button: 'M√°y t√≠nh',

        close: 'ƒê√≥ng',

        payday_notice: 'Vui l√≤ng nh·∫≠p ng√†y tr·∫£ l∆∞∆°ng ƒë·ªÉ c√≥ thu nh·∫≠p ch√≠nh x√°c',

        hours_unit: 'GI·ªú'

    },

    ko: {

        days: ['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'],

        currency: 'KRW',

        manage_jobs: '‚ûï ÏßÅÏû• Í¥ÄÎ¶¨',

        rate_per_hour: 'üí∞ ÏãúÍ∏â:',

        modal_time_title: 'Í∑ºÎ¨¥ ÏãúÍ∞Ñ ÏûÖÎ†• -',

        time_in: 'Ï∂úÍ∑º:',

        time_out: 'Ìá¥Í∑º:',

        delete: 'ÏÇ≠Ï†ú',

        cancel: 'Ï∑®ÏÜå',

        save: 'Ï†ÄÏû•',

        modal_job_add_title: 'ÏÉà ÏßÅÏû• Ï∂îÍ∞Ä',

        modal_job_edit_title: 'ÏßÅÏû• ÏàòÏ†ï',

        job_name: 'ÏßÅÏû• Ïù¥Î¶Ñ:',

        job_address: 'Ï£ºÏÜå:',

        job_start_date: 'ÏãúÏûëÏùº:',

        job_end_date: 'Ìá¥ÏßÅÏùº:',

        job_is_current: 'Ïû¨ÏßÅ Ï§ë',

        alert_job_required: 'Ïù¥Î¶ÑÍ≥º ÏãúÏûëÏùºÏùÄ ÌïÑÏàòÏûÖÎãàÎã§.',

        alert_date_invalid: 'Ìá¥ÏßÅÏùºÏùÄ ÏãúÏûëÏùºÍ≥º Í∞ôÍ±∞ÎÇò Í∑∏ Ïù¥ÌõÑÏó¨Ïïº Ìï©ÎãàÎã§.',

        alert_delete_confirm: (name) => `Ï†ïÎßêÎ°ú ${name} ÏßÅÏû•ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå? Í¥ÄÎ†® Í∑ºÎ¨¥ ÏãúÍ∞ÑÏù¥ Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§!`,

        alert_time_job_required: 'Ï∂úÌá¥Í∑º Í∏∞Î°ù Ï†ÑÏóê ÏßÅÏû•ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.',

        alert_delete_time_confirm: (jobName) => `Ïù¥ ÎÇ†ÏßúÏùò ${jobName} Í∑ºÎ¨¥ ÏãúÍ∞ÑÏùÑ Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,

        job_date_current: 'Ïû¨ÏßÅ Ï§ë',

        job_date_from: '',

        job_date_to: 'ÍπåÏßÄ',

        unit_vnd: 'KRW',

        payday_note: 'Í∏âÏó¨Ïùº',

        payday_label: 'üí¥ Í∏âÏó¨Ïùº:',

        job_start_date_note: 'ÏãúÏûëÏùº',

        job_end_date_note: 'Ìá¥ÏßÅÏùº',

        job_payday_label: 'Í∏âÏó¨Ïùº (1-31):',

        job_name_placeholder: 'ÌöåÏÇ¨Î™Ö/ÌîÑÎ°úÏ†ùÌä∏Î™Ö...',

        job_address_placeholder: 'ÏßÅÏû• Ï£ºÏÜå (Ïòà: 123 ABC Í±∞Î¶¨)',

        job_payday_placeholder: 'Ïòà: 10',

        calculator_title: 'Í≥ÑÏÇ∞Í∏∞',

        calculator_button: 'Í≥ÑÏÇ∞Í∏∞',

        close: 'Îã´Í∏∞',

        payday_notice: 'Ï†ïÌôïÌïú ÏàòÏûÖÏùÑ ÏúÑÌï¥ Í∏âÏó¨ÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî',

        hours_unit: 'ÏãúÍ∞Ñ'

    }

};

// Helpers

const pad = (n) => (n < 10 ? '0' + n : '' + n);

const getDayKey = (y,m,d) => `${y}-${pad(m+1)}-${pad(d)}`;

const daysInMonth = (y,m) => new Date(y,m+1,0).getDate();

function getTranslation(key, ...args){ const t = translations[currentLang][key]; return typeof t === 'function' ? t(...args) : (t ?? key); }

// Rate helpers

function getRateDigits(){

    return String(rateInput.value).replace(/\D/g,'');

}

function getRateValue(){

    return Number(getRateDigits() || 0);

}

function formatRateInputDisplay(){

    const digits = getRateDigits();

    rateInput.value = Number(digits || 0).toLocaleString(currentLang === 'vi' ? 'vi-VN' : 'ko-KR');

}

function adjustRateInputWidth(){

    const length = getRateDigits().length;

    let newWidth = 60 + Math.max(0, Math.min(12, length) - 4) * 8;

    if (length < 4) newWidth = 60;

    rateInput.style.width = `${newWidth}px`;

}

// Ng√¥n ng·ªØ

function setLanguage(lang){

    currentLang = lang;

    localStorage.setItem('currentLang', lang);

    document.querySelectorAll('[data-i18n]').forEach(el => {

        const key = el.getAttribute('data-i18n');

        if (el.querySelector && el.querySelector('#modalDate')) {

            const currentDate = el.querySelector('#modalDate')?.textContent || '';

            el.innerHTML = `${getTranslation(key)} <span id="modalDate">${currentDate}</span>`;

        } else {

            el.textContent = getTranslation(key);

        }

    });

    // X·ª≠ l√Ω placeholder cho input
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {

        const key = el.getAttribute('data-i18n-placeholder');

        if (el.tagName === 'INPUT') {

            el.placeholder = getTranslation(key);

        } else if (el.tagName === 'LABEL') {

            el.title = getTranslation(key);

        }

    });

    const headers = document.getElementById('calendarHeaders').children;

    translations[currentLang].days.forEach((d,i)=>headers[i].textContent=d);

    currencyUnitSpan.textContent = translations[currentLang].currency;

    document.querySelector('.summary .red-unit').textContent = translations[currentLang].unit_vnd;

    langToggleBtn.textContent = lang === 'vi' ? 'üá∞üá∑ Korean' : 'üáªüá≥ Ti·∫øng Vi·ªát';

    renderCalendar();

    renderJobList();

}

langToggleBtn.onclick = () => setLanguage(currentLang === 'vi' ? 'ko' : 'vi');

// Jobs

function ensureJobs(){

    jobs = JSON.parse(localStorage.getItem('jobs') || '[]');

    if (jobs.length === 0){

        jobs.push({

            id: Date.now().toString(),

            name: 'C√¥ng vi·ªác Ch√≠nh',

            address: 'VƒÉn ph√≤ng/Remote',

            startDate: new Date().toISOString().split('T')[0],

            endDate: '',

            isCurrent: true,

            payday: null

        });

        localStorage.setItem('jobs', JSON.stringify(jobs));

    }

}

function saveJobs(){

    localStorage.setItem('jobs', JSON.stringify(jobs));

    ensureJobs();

    renderJobList();

}

function openJobModal(jobId = null){

    editingJobId = jobId;

    jobModal.style.display = 'flex';

    const titleKey = jobId ? 'modal_job_edit_title' : 'modal_job_add_title';

    const titleEl = document.getElementById('jobModalTitle');

    titleEl.setAttribute('data-i18n', titleKey);

    titleEl.textContent = getTranslation(titleKey);

    document.getElementById('deleteJob').style.display = jobId ? 'inline-block' : 'none';

    const set = (id,v)=>document.getElementById(id).value = v ?? '';

    if (jobId){

        const job = jobs.find(j=>j.id===jobId) || {};

        set('jobName', job.name);

        set('jobAddress', job.address);

        set('jobStartDate', job.startDate);

        set('jobEndDate', job.endDate);

        document.getElementById('jobIsCurrent').checked = !!job.isCurrent;

        document.getElementById('jobEndDate').disabled = !!job.isCurrent;

        document.getElementById('jobPayday').value = (job.payday ?? '');

    } else {

        set('jobName',''); set('jobAddress','');

        set('jobStartDate', new Date().toISOString().split('T')[0]);

        set('jobEndDate','');

        document.getElementById('jobIsCurrent').checked = true;

        document.getElementById('jobEndDate').disabled = true;

        document.getElementById('jobPayday').value = '';

    }

}

document.getElementById('saveJob').onclick = () => {

    const name = document.getElementById('jobName').value.trim();

    const address = document.getElementById('jobAddress').value.trim();

    const startDate = document.getElementById('jobStartDate').value;

    const endDate = document.getElementById('jobEndDate').value;

    const isCurrent = document.getElementById('jobIsCurrent').checked;

    const paydayRaw = document.getElementById('jobPayday').value.trim();

    const payday = paydayRaw ? Math.max(1, Math.min(31, parseInt(paydayRaw,10))) : null;

    if (!name || !startDate) return alert(getTranslation('alert_job_required'));

    if (!isCurrent && endDate && new Date(startDate) > new Date(endDate)) return alert(getTranslation('alert_date_invalid'));

    if (editingJobId){

        const i = jobs.findIndex(j=>j.id===editingJobId);

        if (i !== -1) jobs[i] = { id: editingJobId, name, address, startDate, endDate, isCurrent, payday };

    } else {

        jobs.push({ id: Date.now().toString(), name, address, startDate, endDate, isCurrent, payday });

    }

    jobModal.style.display = 'none';

    saveJobs();

    renderCalendar();

};

document.getElementById('deleteJob').onclick = () => {

    if (!editingJobId) return;

    const job = jobs.find(j=>j.id===editingJobId);

    if (!confirm(getTranslation('alert_delete_confirm', job?.name || ''))) return;

    jobs = jobs.filter(j=>j.id!==editingJobId);

    for (const dateKey in workData){

        if (workData[dateKey]?.[editingJobId]){

            delete workData[dateKey][editingJobId];

            if (Object.keys(workData[dateKey]).length === 0) delete workData[dateKey];

        }

    }

    jobModal.style.display = 'none';

    saveJobs();

    renderCalendar();

};

document.getElementById('cancelJob').onclick = () => jobModal.style.display = 'none';

document.getElementById('jobIsCurrent').onchange = (e) => {

    const dis = e.target.checked;

    const endInput = document.getElementById('jobEndDate');

    endInput.disabled = dis;

    if (dis) endInput.value = '';

};

// Carousel select job

function getCurrentJobId(){

    ensureJobs();

    if (jobs.length === 0) return null;

    const scrollPos = jobCarouselDiv.scrollLeft;

    const widthPerItem = jobCarouselDiv.clientWidth || 1;

    let selectedIndex = Math.round(scrollPos / widthPerItem);

    if (selectedIndex >= jobs.length) selectedIndex = jobs.length - 1;

    if (selectedIndex < 0) selectedIndex = 0;

    const items = jobCarouselDiv.querySelectorAll('.job-item');

    items.forEach((item,i)=>item.classList.toggle('selected', i===selectedIndex));

    return jobs[selectedIndex]?.id || null;

}

jobCarouselDiv.addEventListener('scroll', () => {

    clearTimeout(jobCarouselDiv.scrollTimeout);

    jobCarouselDiv.scrollTimeout = setTimeout(renderCalendar, 100);

});

function renderJobList(){

    ensureJobs();

    jobCarouselDiv.innerHTML = '';

    if (jobs.length === 0){

        jobCarouselDiv.innerHTML = `<div style="color:#999;font-size:0.9em; min-width: 100%; text-align: center; padding: 15px;">${getTranslation('job_name')} (${getTranslation('modal_job_add_title').toLowerCase()})</div>`;

        jobCarouselDiv.style.border='1px dashed #ccc';

        jobCarouselDiv.style.boxShadow='none';

        jobCarouselDiv.style.background='none';

        return;

    }

    jobCarouselDiv.style.border='1px solid #e0e0e0';

    jobCarouselDiv.style.boxShadow='inset 0 0 5px rgba(0,0,0,.05)';

    jobCarouselDiv.style.background='#f7f7f7';

    jobs.forEach((job, index)=>{

        const item = document.createElement('div');

        item.className = 'job-item';

        item.dataset.id = job.id;

        const jobNumber = jobs.length > 1 ? `${index + 1}. ` : '';

        const dateStr = job.isCurrent

            ? `${getTranslation('job_date_from')} ${job.startDate.split('-').reverse().join('/')} - ${getTranslation('job_date_current')}`

            : `${getTranslation('job_date_from')} ${job.startDate.split('-').reverse().join('/')} ${getTranslation('job_date_to')} ${(job.endDate||'').split('-').reverse().join('/')}`;

        const paydayStr = job.payday ? ` | ${getTranslation('payday_label')} ${job.payday}` : '';

        const addressHtml = job.address ? `<span>üìç ${job.address}${paydayStr}</span>` : `<span>${paydayStr ? paydayStr.slice(3) : ''}</span>`;

        item.innerHTML = `<strong>${jobNumber}${job.name}</strong><span>${dateStr}</span>${addressHtml}`;

        item.onclick = (e) => { if (e.target.closest('.job-item') === item) openJobModal(job.id); };

        jobCarouselDiv.appendChild(item);

    });

    getCurrentJobId();

}

// T·ªïng theo th√°ng ho·∫∑c theo chu k·ª≥ tr·∫£ l∆∞∆°ng

function computeCycleRange(payday){

    // tr·∫£ v·ªÅ {startDate, endDate} (inclusive) theo chu k·ª≥: (payday+1) c·ªßa th√°ng tr∆∞·ªõc -> payday c·ªßa th√°ng n√†y

    const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;

    const prevYear  = currentMonth === 0 ? currentYear - 1 : currentYear;

    const prevMaxDay = daysInMonth(prevYear, prevMonth);

    const currMaxDay = daysInMonth(currentYear, currentMonth);

    const startDay = Math.min(prevMaxDay, payday) + 1; // ng√†y sau ng√†y TL th√°ng tr∆∞·ªõc

    const endDay   = Math.min(currMaxDay, payday);      // ƒë·∫øn ng√†y TL th√°ng n√†y

    const startDate = new Date(prevYear, prevMonth, startDay);

    const endDate   = new Date(currentYear, currentMonth, endDay);

    return { startDate, endDate, endDay };

}

function updateSummary(){

    const rate = getRateValue();

    const locale = currentLang === 'vi' ? 'vi-VN' : 'ko-KR';

    const currentJobId = getCurrentJobId();

    const monthKey = `${currentYear}-${pad(currentMonth + 1)}`;

    const job = jobs.find(j=>j.id===currentJobId);

    const payday = job?.payday || null;

    let totalHours = 0;

    if (payday){ // T√≠nh theo chu k·ª≥

        const { startDate, endDate } = computeCycleRange(payday);

        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate()+1)){

            const key = getDayKey(d.getFullYear(), d.getMonth(), d.getDate());

            if (workData[key]?.[currentJobId]){

                totalHours += workData[key][currentJobId].hours || 0;

            }

        }

        paydayNotice.style.display = 'none';

    } else { // Kh√¥ng c√≥ payday: t√≠nh trong th√°ng hi·ªán t·∫°i

        for (const k in workData){

            if (k.startsWith(monthKey) && workData[k]?.[currentJobId]){

                totalHours += workData[k][currentJobId].hours || 0;

            }

        }

        paydayNotice.style.display = 'block';

    }

    document.getElementById('totalHours').textContent = totalHours.toFixed(2);

    document.getElementById('totalPay').textContent = (totalHours * rate).toLocaleString(locale);

    const mm = pad(currentMonth + 1);

    if (currentLang === 'vi') {

        document.getElementById('totalHoursLabel').textContent = `T·ªïng gi·ªù th√°ng ${mm}:`;

        document.getElementById('totalPayLabel').textContent = `Thu nh·∫≠p th√°ng ${mm}:`;

    } else {

        document.getElementById('totalHoursLabel').textContent = `${mm}Ïõî Ï¥ù ÏãúÍ∞Ñ:`;

        document.getElementById('totalPayLabel').textContent = `${mm}Ïõî ÏòàÏÉÅ ÏàòÏûÖ:`;

    }

}

// Render l·ªãch

function renderCalendar(){

    const tbl = document.getElementById('calendar');

    tbl.innerHTML = '';

    const firstDay = new Date(currentYear, currentMonth, 1).getDay();

    const totalDays = daysInMonth(currentYear, currentMonth);

    document.getElementById('monthYear').textContent = `${pad(currentMonth + 1)}/${currentYear}`;

    let day = 1;

    const rate = getRateValue();

    const locale = currentLang === 'vi' ? 'vi-VN' : 'ko-KR';

    const currencyCode = translations[currentLang].unit_vnd;

    const currentJobId = getCurrentJobId();

    const job = jobs.find(j=>j.id===currentJobId);

    const payday = job?.payday || null;

    const jobIndex = job ? jobs.findIndex(j=>j.id===currentJobId) : -1;

    const jobNumber = (jobs.length > 1 && jobIndex >= 0) ? `${jobIndex + 1}. ` : '';

    // T√≠nh to√°n ph·∫°m vi job ƒë·ªÉ ki·ªÉm tra ng√†y tr·∫£ l∆∞∆°ng
    let jobStartDate = null;
    let jobEndDate = null;
    if (job) {
        jobStartDate = new Date(job.startDate);
        jobStartDate.setHours(0, 0, 0, 0);
        jobEndDate = job.isCurrent ? new Date() : (job.endDate ? new Date(job.endDate) : null);
        if (jobEndDate) jobEndDate.setHours(23, 59, 59, 999);
    }

    // H√†m ki·ªÉm tra ng√†y c√≥ ph·∫£i ng√†y tr·∫£ l∆∞∆°ng v√† n·∫±m trong ph·∫°m vi job
    function isPaydayInRange(dayNum) {
        if (!payday || !job) return false;
        const actualPayday = Math.min(payday, daysInMonth(currentYear, currentMonth));
        if (dayNum !== actualPayday) return false;
        
        const checkDate = new Date(currentYear, currentMonth, dayNum);
        checkDate.setHours(0, 0, 0, 0);
        
        if (checkDate < jobStartDate) return false;
        if (jobEndDate && checkDate > jobEndDate) return false;
        
        return true;
    }

    // H√†m ki·ªÉm tra ng√†y c√≥ ph·∫£i ng√†y b·∫Øt ƒë·∫ßu ho·∫∑c k·∫øt th√∫c c·ªßa job
    function isJobDateInRange(dayNum) {
        if (!job) return null;
        const checkDate = new Date(currentYear, currentMonth, dayNum);
        checkDate.setHours(0, 0, 0, 0);
        
        const startDate = new Date(job.startDate);
        startDate.setHours(0, 0, 0, 0);
        
        const endDate = job.endDate ? new Date(job.endDate) : null;
        if (endDate) endDate.setHours(0, 0, 0, 0);
        
        // Ki·ªÉm tra ng√†y b·∫Øt ƒë·∫ßu
        if (checkDate.getTime() === startDate.getTime()) {
            return 'start';
        }
        
        // Ki·ªÉm tra ng√†y k·∫øt th√∫c
        if (endDate && checkDate.getTime() === endDate.getTime()) {
            return 'end';
        }
        
        return null;
    }

    for (let r=0;r<6;r++){

        const tr = document.createElement('tr');

        for (let c=0;c<7;c++){

            const td = document.createElement('td');

            if ((r===0 && c<firstDay) || day>totalDays){

                td.innerHTML = '';

            } else {

                const dkey = getDayKey(currentYear, currentMonth, day);

                const dayData = workData[dkey] || {};

                const info = currentJobId ? (dayData[currentJobId] || {}) : {};

                const hours = info.hours || 0;

                // Ki·ªÉm tra xem c√≥ ph·∫£i ng√†y hi·ªán t·∫°i kh√¥ng
                const today = new Date();
                today.setHours(0, 0, 0, 0); // ƒê·∫∑t v·ªÅ 00:00:00 ƒë·ªÉ so s√°nh ch√≠nh x√°c
                const checkDate = new Date(currentYear, currentMonth, day);
                checkDate.setHours(0, 0, 0, 0);
                const isToday = checkDate.getTime() === today.getTime();

                let contentHTML = `<span>${day}</span>`;
                
                if (isToday) {
                    contentHTML += `<div class="today-dot"></div>`;
                }

                if (hours > 0){

                    const pay = hours * rate;

                    contentHTML += `

                        <div class="hours-display">${hours.toFixed(2)}h</div>

                        <div class="pay-display">${pay.toLocaleString(locale)} ${currencyCode}</div>

                    `;

                }

                td.className = 'day';

                // Thu th·∫≠p t·∫•t c·∫£ c√°c ghi ch√∫ c·∫ßn hi·ªÉn th·ªã
                const notes = [];
                
                // Ki·ªÉm tra ng√†y tr·∫£ l∆∞∆°ng cho t·ª´ng ng√†y trong th√°ng
                if (isPaydayInRange(day)){
                    td.classList.add('payday-cell');
                    notes.push(`<div class="payday-note">${jobNumber}${getTranslation('payday_note')}</div>`);
                }

                // Ki·ªÉm tra ng√†y b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c c·ªßa job
                const jobDateType = isJobDateInRange(day);
                if (jobDateType === 'start') {
                    td.classList.add('job-date-cell');
                    notes.push(`<div class="job-date-note">${jobNumber}${getTranslation('job_start_date_note')}</div>`);
                } else if (jobDateType === 'end') {
                    td.classList.add('job-date-cell');
                    notes.push(`<div class="job-date-note">${jobNumber}${getTranslation('job_end_date_note')}</div>`);
                }

                // Hi·ªÉn th·ªã t·∫•t c·∫£ ghi ch√∫ trong container n·∫øu c√≥
                if (notes.length > 0) {
                    contentHTML += `<div class="notes-container">${notes.join('')}</div>`;
                }

                td.innerHTML = contentHTML;

                td.dataset.key = dkey;

                td.onclick = (e)=>{ if (e.currentTarget.innerHTML !== '') openModal(dkey); };

                day++;

            }

            tr.appendChild(td);

        }

        tbl.appendChild(tr);

        if (day > totalDays) break;

    }

    updateSummary();
    
    // Th√™m hi·ªáu ·ª©ng fade-in cho calendar m·ªõi
    const ct = document.getElementById('calendarTable');
    if (ct) {
        const table = ct.querySelector('table');
        if (table) {
            table.classList.add('fade-in');
            setTimeout(() => table.classList.remove('fade-in'), 250);
        }
    }

}

// Modal th·ªùi gian

function openModal(key){

    timeModal.style.display = 'flex';

    timeModal.dataset.key = key;

    const [year, month, day] = key.split('-');

    const dateText = `${day}/${month}`;

    document.getElementById('modalDate').textContent = dateText;

    const currentJobId = getCurrentJobId();

    if (!currentJobId){

        alert(getTranslation('alert_time_job_required'));

        timeModal.style.display = 'none';

        return;

    }

    const info = (workData[key] && workData[key][currentJobId]) || {};

    document.getElementById('timeIn').value = info.in || '09:00';

    document.getElementById('timeOut').value = info.out || '18:00';

    document.getElementById('deleteTime').style.display = info.hours ? 'inline-block' : 'none';

}

document.getElementById('saveTime').onclick = () => {

    const key = timeModal.dataset.key;

    const currentJobId = getCurrentJobId();

    if (!currentJobId) return alert(getTranslation('alert_time_job_required'));

    const tin = document.getElementById('timeIn').value;

    const tout = document.getElementById('timeOut').value;

    const [y,m,d] = key.split('-').map(Number);

    const timeIn = new Date(y, m-1, d, ...tin.split(':').map(Number));

    let timeOut = new Date(y, m-1, d, ...tout.split(':').map(Number));

    if (timeOut <= timeIn) timeOut.setDate(timeOut.getDate() + 1);

    const hrs = (timeOut - timeIn) / 36e5;

    if (hrs <= 0){

        if (workData[key]?.[currentJobId]) delete workData[key][currentJobId];

        if (workData[key] && Object.keys(workData[key]).length === 0) delete workData[key];

    } else {

        workData[key] = workData[key] || {};

        workData[key][currentJobId] = { in: tin, out: tout, hours: hrs };

    }

    localStorage.setItem('workData', JSON.stringify(workData));

    timeModal.style.display = 'none';

    renderCalendar();

};

document.getElementById('deleteTime').onclick = () => {

    const key = timeModal.dataset.key;

    const currentJobId = getCurrentJobId();

    const jobName = jobs.find(j=>j.id===currentJobId)?.name || '';

    if (!confirm(getTranslation('alert_delete_time_confirm', jobName))) return;

    if (workData[key]?.[currentJobId]){

        delete workData[key][currentJobId];

        if (Object.keys(workData[key]).length === 0) delete workData[key];

    }

    localStorage.setItem('workData', JSON.stringify(workData));

    timeModal.style.display = 'none';

    renderCalendar();

};

document.getElementById('cancelTime').onclick = () => (timeModal.style.display = 'none');

// C√†i ƒë·∫∑t

function updateSettings(){

    appSettings.rate = getRateValue();

    localStorage.setItem('appSettings', JSON.stringify(appSettings));

    renderCalendar();

}

// ƒêi·ªÅu h∆∞·ªõng th√°ng

function goToNextMonth(){ 
    const ct = document.getElementById('calendarTable');
    if (ct) {
        ct.classList.add('flipping-left');
        setTimeout(() => {
            currentMonth++; 
            if (currentMonth > 11){ currentMonth = 0; currentYear++; } 
            renderCalendar();
            setTimeout(() => ct.classList.remove('flipping-left'), 10);
        }, 150);
    } else {
        currentMonth++; 
        if (currentMonth > 11){ currentMonth = 0; currentYear++; } 
        renderCalendar();
    }
}

function goToPrevMonth(){ 
    const ct = document.getElementById('calendarTable');
    if (ct) {
        ct.classList.add('flipping-right');
        setTimeout(() => {
            currentMonth--; 
            if (currentMonth < 0){ currentMonth = 11; currentYear--; } 
            renderCalendar();
            setTimeout(() => ct.classList.remove('flipping-right'), 10);
        }, 150);
    } else {
        currentMonth--; 
        if (currentMonth < 0){ currentMonth = 11; currentYear--; } 
        renderCalendar();
    }
}

document.getElementById('prevMonth').onclick = goToPrevMonth;

document.getElementById('nextMonth').onclick = goToNextMonth;

// Rate events

rateInput.oninput = () => { formatRateInputDisplay(); adjustRateInputWidth(); };

rateInput.onchange = () => { formatRateInputDisplay(); updateSettings(); };

// N√∫t m√°y t√≠nh

const calcModal = document.getElementById('calcModal');

const calcDisplay = document.getElementById('calcDisplay');

function openCalc(){ calcDisplay.value = calcDisplay.value || ''; calcModal.style.display = 'flex'; }

function closeCalc(){ calcModal.style.display = 'none'; }

document.getElementById('openCalc').onclick = openCalc;

document.getElementById('closeCalc')?.addEventListener('click', closeCalc);

calcModal.addEventListener('click', (e)=>{ if (e.target === calcModal) closeCalc(); });

document.querySelector('#calcModal .calc-grid').addEventListener('click', (e)=>{

    const btn = e.target.closest('button'); if (!btn || btn.id === 'closeCalc') return;

    const action = btn.getAttribute('data-action'); const val = btn.getAttribute('data-val');

    if (action === 'clear'){ calcDisplay.value = ''; return; }

    if (action === 'back'){ calcDisplay.value = calcDisplay.value.slice(0,-1); return; }

    if (action === 'equals'){

        const expr = (calcDisplay.value || '').replace(/[^0-9+\-*/().]/g,'');

        if (!expr) return;

        try{

            if (/[*+/)]\s*[*+/)]/.test(expr)) throw new Error('Bad');

            const result = Function(`"use strict";return (${expr})`)();

            calcDisplay.value = (result ?? '').toString();

        }catch{

            calcDisplay.value = 'L·ªói'; setTimeout(()=>{ if (calcDisplay.value === 'L·ªói') calcDisplay.value = ''; },800);

        }

        return;

    }

    if (val){

        if (val === '.'){

            const parts = calcDisplay.value.split(/[*+\-/()]/);

            const last = parts[parts.length-1] || '';

            if (last.includes('.')) return;

        }

        calcDisplay.value += val;

    }

});

// Open job modal

document.getElementById('openJobModal').onclick = () => openJobModal();

// Click v√†o th√°ng/nƒÉm ƒë·ªÉ quay v·ªÅ th√°ng hi·ªán t·∫°i
document.getElementById('monthYear').onclick = () => {
    const today = new Date();
    currentMonth = today.getMonth();
    currentYear = today.getFullYear();
    renderCalendar();
};

// Kh·ªüi t·∫°o

function initApp(){

    const storedSettings = JSON.parse(localStorage.getItem('appSettings') || '{}');

    appSettings = storedSettings;

    const initialRate = typeof storedSettings.rate === 'number' ? storedSettings.rate : 10000;

    rateInput.value = initialRate.toLocaleString(currentLang === 'vi' ? 'vi-VN' : 'ko-KR');

    ensureJobs();

    setLanguage(currentLang);

    renderJobList();

    renderCalendar();

    formatRateInputDisplay();

    adjustRateInputWidth();

    // Vu·ªët th√°ng ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω qua document.addEventListener

}

initApp();

// Vu·ªët th√°ng - Gi·ªõi h·∫°n trong khu v·ª±c b·∫£ng l·ªãch
let sx = 0, sy = 0;
let touchInCalendar = false;

document.addEventListener('touchstart', function(e) {
    // Ki·ªÉm tra xem touch c√≥ trong calendarTable kh√¥ng
    const ct = document.getElementById('calendarTable');
    if (ct && ct.contains(e.target)) {
        touchInCalendar = true;
        sx = e.touches[0].clientX;
        sy = e.touches[0].clientY;
    } else {
        touchInCalendar = false;
    }
});

document.addEventListener('touchend', function(e) {
    // Ch·ªâ x·ª≠ l√Ω n·∫øu touch b·∫Øt ƒë·∫ßu trong calendarTable
    if (!touchInCalendar || !sx || !sy || !e.changedTouches || !e.changedTouches[0]) {
        sx = 0; sy = 0;
        touchInCalendar = false;
        return;
    }
    
    const ex = e.changedTouches[0].clientX;
    const ey = e.changedTouches[0].clientY;
    const dx = ex - sx;
    const dy = ey - sy;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50) {
        if (dx > 0) goToPrevMonth();
        else goToNextMonth();
    }
    sx = 0; sy = 0;
    touchInCalendar = false;
});

</script>

</body>

</html>
