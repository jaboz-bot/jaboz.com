<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Báº£ng Cháº¥m CÃ´ng Äa Dá»± Ãn</title>
<style>
/* CSS CÆ  Báº¢N VÃ€ CHUNG */
html,body{height:100%;margin:0;font-family:Arial,sans-serif;background:#f6f8f9}
.container{max-width:900px;margin:20px auto;background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
.header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #3498db;padding-bottom:10px}
.month-nav{display:flex;align-items:center;gap:8px;font-weight:bold;color:#27ae60}
.arrow{cursor:pointer;user-select:none;font-size:1.3em}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;text-align:center;padding:5px;font-size:.85em}
th{background:#eaf2f8}
.day{position:relative;height:80px;vertical-align:top;cursor:pointer}
.day span{position:absolute;top:3px;left:5px;font-weight:bold;color:#2980b9}
.day div{position:absolute;bottom:3px;left:0;width:100%;font-size:.8em;color:#27ae60}
.summary{margin-top:20px;background:#ecf9ff;padding:10px;border-radius:5px}

/* CSS CHO MODAL CHUNG */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px}
.modal-content input[type="text"], .modal-content input[type="date"], .modal-content input[type="time"]{width:100%;padding:8px;margin:5px 0;border:1px solid #ccc;border-radius:5px;box-sizing:border-box;}
.modal-content button{margin-top:10px;padding:8px 12px;border:none;border-radius:5px;cursor:pointer}
.save{background:#3498db;color:#fff}
.cancel{background:#ccc}

/* CSS CHO QUáº¢N LÃ NÆ I LÃ€M VIá»†C ÄÃƒ Gá»ŒN Láº I */
#workplace-management {
    margin-bottom: 20px;
    border-bottom: 1px dashed #ccc;
    padding-bottom: 15px;
    text-align: center;
}
/* ÄÃƒ Cáº¬P NHáº¬T: Loáº¡i bá» #workplace-actions vÃ¬ nÃºt Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn ra ngoÃ i */
#addWorkplaceBtn {
    padding: 8px 15px;
    background: #2ecc71;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    /* Äáº£m báº£o nÃºt náº±m trÃªn má»™t dÃ²ng vÃ  cÄƒn giá»¯a */
    display: block; 
    width: fit-content;
    margin: 10px auto 15px; /* TÄƒng khoáº£ng cÃ¡ch dÆ°á»›i nÃºt má»™t chÃºt */
}

/* HIá»†U á»¨NG CUá»˜N NGANG */
/* HIá»†U á»¨NG CHá»ˆ HIá»‚N THá»Š 1 THáºº VÃ€ CÄ‚N GIá»®A */
#workplace-list-container {
    /* ÄÃ£ thay Ä‘á»•i: Buá»™c chá»©a 1 tháº»/láº§n hiá»ƒn thá»‹ */
    overflow-x: auto; /* Váº«n giá»¯ cuá»™n ngang Ä‘á»ƒ vuá»‘t xem tháº» khÃ¡c */
    white-space: nowrap;
    padding: 10px 0;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    text-align: center;
    
    /* ThÃªm thuá»™c tÃ­nh Ä‘á»ƒ má»—i láº§n cuá»™n chá»‰ hiá»ƒn thá»‹ 1 tháº» */
    scroll-snap-type: x mandatory; 
}
#workplace-list-container::-webkit-scrollbar {
    display: none;
}
#workplace-list {
    /* ÄÃ£ thay Ä‘á»•i: Sá»­ dá»¥ng flexbox Ä‘á»ƒ cÄƒn chá»‰nh */
    display: flex; /* Quan trá»ng */
    justify-content: center; /* CÄƒn giá»¯a cÃ¡c tháº» trong viewport */
    gap: 10px; /* ThÃªm khoáº£ng cÃ¡ch giá»¯a cÃ¡c tháº» */
    width: 100%; /* Äáº£m báº£o chiáº¿m Ä‘á»§ chiá»u rá»™ng */
    padding: 0 50%; /* Padding giáº£ Ä‘á»ƒ cÄƒn tháº» giá»¯a khi nÃ³ lÃ  tháº» Ä‘áº§u tiÃªn/cuá»‘i cÃ¹ng */
    box-sizing: border-box;
}

.workplace-card {
    /* ÄÃ£ thay Ä‘á»•i: Äáº£m báº£o tháº» luÃ´n cÃ³ kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh */
    display: inline-block;
    padding: 10px 15px;
    margin: 0; /* ÄÃ£ loáº¡i bá» margin vÃ¬ dÃ¹ng gap */
    border: 2px solid #ccc;
    border-radius: 8px;
    background: #fcfcfc;
    cursor: pointer;
    font-size: 0.9em;
    
    /* Thiáº¿t láº­p kÃ­ch thÆ°á»›c cá»‘ Ä‘á»‹nh vÃ  buá»™c chÃºng khÃ´ng co láº¡i */
    min-width: 250px; /* Buá»™c chiá»u rá»™ng Ä‘á»ƒ dá»… cÄƒn giá»¯a */
    flex-shrink: 0; /* KhÃ´ng co tháº» */
    
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    vertical-align: top;
    
    /* ThÃªm thuá»™c tÃ­nh scroll-snap */
    scroll-snap-align: center;
}
.workplace-card.selected {
    border-color: #e74c3c;
    background: #ffebeb;
    font-weight: bold;
}
.workplace-card .store-name {
    display: block;
    font-weight: bold;
    color: #2c3e50;
    white-space: normal;
}
.workplace-card .date-range {
    display: block;
    font-size: 0.8em;
    color: #7f8c8d;
    margin-top: 3px;
}

/* CÄƒn chá»‰nh cho Input giá» (trong timeModal) */
#timeModal .modal-content input[type="time"] {
    width: 48%;
    display: inline-block;
}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="month-nav">
            <span class="arrow" id="prevMonth">â—€</span>
            <span id="monthYear"></span>
            <span class="arrow" id="nextMonth">â–¶</span>
        </div>
        <div>
            ğŸ’° LÆ°Æ¡ng/giá»: <input type="number" id="rate" value="100000" style="width:90px"> VND
        </div>
    </div>
    
    <div id="workplace-management">
        <button id="addWorkplaceBtn">â• ThÃªm NÆ¡i LÃ m Viá»‡c</button>
        
        <div id="workplace-list-container">
            <div id="workplace-list"></div>
        </div>
    </div>
    <table>
        <thead>
            <tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr>
        </thead>
        <tbody id="calendar"></tbody>
    </table>

    <div class="summary">
        âœ… Tá»•ng giá»: <span id="totalHours">0</span> giá»<br>
        ğŸ’µ Thu nháº­p: <span id="totalPay">0</span> VND
    </div>
</div>

<div class="modal" id="timeModal">
    <div class="modal-content">
        <h3>Nháº­p giá» cÃ´ng - <span id="modalDate"></span></h3>
        <label>VÃ o:</label>
        <input type="time" id="timeIn" value="09:00">
        <label>Ra:</label>
        <input type="time" id="timeOut" value="18:00">
        <button class="save" id="saveTime">LÆ°u</button>
        <button class="cancel" id="cancelTime">Há»§y</button>
    </div>
</div>

<div class="modal" id="workplaceModal">
    <div class="modal-content">
        <h3>Quáº£n LÃ½ NÆ¡i LÃ m Viá»‡c</h3>
        <label>TÃªn cá»­a hÃ ng:</label>
        <input type="text" id="storeNameInput" placeholder="VD: Dá»± Ã¡n A">
        <label>Äá»‹a chá»‰:</label>
        <input type="text" id="addressInput" placeholder="Äá»‹a chá»‰/Ghi chÃº">
        <label>NgÃ y báº¯t Ä‘áº§u:</label>
        <input type="date" id="startDateInput">
        <label>NgÃ y káº¿t thÃºc:</label>
        <input type="date" id="endDateInput">
        <label style="display: block; margin-top: 10px;">
            <input type="checkbox" id="isCurrentWork"> Äang lÃ m
        </label>
        <button class="save" id="createWorkplaceBtn">Táº¡o/LÆ°u</button>
        <button class="cancel" id="cancelWorkplaceBtn" style="background:#f39c12">Há»§y</button>
        <button class="cancel" id="deleteWorkplaceBtn" style="background:#e74c3c;">XÃ³a</button>
    </div>
</div>

<script>
// --- KHAI BÃO BIáº¾N ---
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let workData = JSON.parse(localStorage.getItem('workData') || '{}');Â 
const rateInput = document.getElementById('rate');

// BIáº¾N CHO QUáº¢N LÃ DANH SÃCH NÆ I LÃ€M VIá»†C
let workplaces = JSON.parse(localStorage.getItem('workplaces') || '[]');
let currentWorkplaceIndex = localStorage.getItem('currentWorkplaceIndex') !== null ? parseInt(localStorage.getItem('currentWorkplaceIndex')) : -1;

const workplaceList = document.getElementById('workplace-list');
// *** ÄÃƒ LOáº I Bá» BIáº¾N currentWorkplaceName vÃ  currentWorkplaceDisplayBlock ***

// BIáº¾N CHO MODAL NÆ I LÃ€M VIá»†C
const workplaceModal = document.getElementById('workplaceModal');
const addWorkplaceBtn = document.getElementById('addWorkplaceBtn');
const createWorkplaceBtn = document.getElementById('createWorkplaceBtn');
const deleteWorkplaceBtn = document.getElementById('deleteWorkplaceBtn');
const isCurrentWork = document.getElementById('isCurrentWork');
const endDateInput = document.getElementById('endDateInput');

let editingIndex = -1;Â 

// --- HÃ€M CHUNG ---
function daysInMonth(y,m){return new Date(y,m+1,0).getDate();}

function updateSummary(){
Â  Â  const rate=parseFloat(rateInput.value)||0;
Â  Â  let totalH=0;Â 
Â  Â  for(const k in workData) totalH+=workData[k].hours||0;
Â  Â Â 
Â  Â  document.getElementById('totalHours').textContent=totalH.toFixed(2);
Â  Â  document.getElementById('totalPay').textContent=(totalH*rate).toLocaleString('vi-VN');
Â  Â  localStorage.setItem('workData',JSON.stringify(workData));
}

function renderCalendar(){
Â  Â  const tbl=document.getElementById('calendar');
Â  Â  tbl.innerHTML='';
Â  Â  const firstDay=new Date(currentYear,currentMonth,1).getDay();
Â  Â  const totalDays=daysInMonth(currentYear,currentMonth);
Â  Â  document.getElementById('monthYear').textContent=`${currentMonth+1}/${currentYear}`;
Â  Â  let day=1;Â 
Â  Â  for(let r=0;r<6;r++){
Â  Â  Â  Â  const tr=document.createElement('tr');
Â  Â  Â  Â  for(let c=0;c<7;c++){
Â  Â  Â  Â  Â  Â  const td=document.createElement('td');
Â  Â  Â  Â  Â  Â  if(r===0&&c<firstDay||day>totalDays){
Â  Â  Â  Â  Â  Â  Â  Â  td.innerHTML='';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  const dkey=`${currentYear}-${currentMonth+1}-${day}`;
Â  Â  Â  Â  Â  Â  Â  Â  const info=workData[dkey]||{};
Â  Â  Â  Â  Â  Â  Â  Â  td.className='day';Â 
Â  Â  Â  Â  Â  Â  Â  Â  td.innerHTML=`<span>${day}</span>${info.hours?`<div>${info.hours.toFixed(2)}h</div>`:''}`;
Â  Â  Â  Â  Â  Â  Â  Â  td.onclick=()=>openModal(dkey);
Â  Â  Â  Â  Â  Â  Â  Â  day++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  tr.appendChild(td);
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  tbl.appendChild(tr);
Â  Â  Â  Â  if(day>totalDays)break;
Â  Â  }
Â  Â  updateSummary();
}

function openModal(key){
Â  Â  const m=document.getElementById('timeModal');m.style.display='flex';
Â  Â  const dateParts=key.split('-');document.getElementById('modalDate').textContent=`${dateParts[2]}/${dateParts[1]}`;
Â  Â  m.dataset.key=key;
Â  Â  const info=workData[key]||{};
Â  Â  document.getElementById('timeIn').value=info.in||'09:00';
Â  Â  document.getElementById('timeOut').value=info.out||'18:00';
}

// --- LOGIC NÆ I LÃ€M VIá»†C (ÄÃƒ Tá»I GIáº¢N Tá»I ÄA) ---

function saveWorkplaces() {
Â  Â  localStorage.setItem('workplaces', JSON.stringify(workplaces));
Â  Â  localStorage.setItem('currentWorkplaceIndex', currentWorkplaceIndex);
Â  Â  renderWorkplaceList();
Â  Â  // Bá» gá»i hÃ m updateCurrentWorkplaceDisplay();
}

// Bá» hÃ m updateCurrentWorkplaceDisplay()

function renderWorkplaceList() {
Â  Â  workplaceList.innerHTML = '';
Â  Â  workplaces.forEach((wp, index) => {
Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  card.className = `workplace-card ${index === currentWorkplaceIndex ? 'selected' : ''}`;
Â  Â  Â  Â  card.dataset.index = index;
Â  Â  Â  Â  const dateDisplay = wp.endDate === 'Äang lÃ m' ? 'Äang lÃ m' : `${wp.startDate} - ${wp.endDate}`;
Â  Â  Â  Â  card.innerHTML = `<span class="store-name">${wp.storeName}</span><span class="date-range">${dateDisplay}</span>`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  let clickTimer = null;
Â  Â  Â  Â  card.onclick = () => {
Â  Â  Â  Â  Â  Â  if (clickTimer === null) {
Â  Â  Â  Â  Â  Â  Â  Â  clickTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Xá»­ lÃ½ cháº¡m 1 láº§n (Chá»n)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentWorkplaceIndex = index;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveWorkplaces();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  clickTimer = null;
Â  Â  Â  Â  Â  Â  Â  Â  }, 300);Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Xá»­ lÃ½ cháº¡m 2 láº§n (Sá»­a)
Â  Â  Â  Â  Â  Â  Â  Â  clearTimeout(clickTimer);
Â  Â  Â  Â  Â  Â  Â  Â  clickTimer = null;
Â  Â  Â  Â  Â  Â  Â  Â  openWorkplaceModal(index);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  workplaceList.appendChild(card);
Â  Â  });
}

function openWorkplaceModal(index = -1) {
Â  Â  workplaceModal.style.display = 'flex';
Â  Â  editingIndex = index;
Â  Â Â 
Â  Â  if (index !== -1) {Â 
Â  Â  Â  Â  const wp = workplaces[index];
Â  Â  Â  Â  document.getElementById('storeNameInput').value = wp.storeName;
Â  Â  Â  Â  document.getElementById('addressInput').value = wp.address;
Â  Â  Â  Â  document.getElementById('startDateInput').value = wp.startDate;
Â  Â  Â  Â  document.getElementById('endDateInput').value = wp.endDate === 'Äang lÃ m' ? '' : wp.endDate;
Â  Â  Â  Â  document.getElementById('isCurrentWork').checked = wp.endDate === 'Äang lÃ m';
Â  Â  Â  Â  document.getElementById('endDateInput').disabled = wp.endDate === 'Äang lÃ m';
Â  Â  Â  Â  createWorkplaceBtn.textContent = 'LÆ°u Thay Äá»•i';
Â  Â  Â  Â  deleteWorkplaceBtn.style.display = 'inline-block';
Â  Â  } else {Â 
Â  Â  Â  Â  document.getElementById('storeNameInput').value = '';
Â  Â  Â  Â  document.getElementById('addressInput').value = '';
Â  Â  Â  Â  document.getElementById('startDateInput').value = '';
Â  Â  Â  Â  document.getElementById('endDateInput').value = '';
Â  Â  Â  Â  document.getElementById('isCurrentWork').checked = false;
Â  Â  Â  Â  document.getElementById('endDateInput').disabled = false;
Â  Â  Â  Â  createWorkplaceBtn.textContent = 'Táº¡o';
Â  Â  Â  Â  deleteWorkplaceBtn.style.display = 'none';
Â  Â  }
}

// --- Sá»° KIá»†N NÆ I LÃ€M VIá»†C ---
isCurrentWork.onchange = function() {
Â  Â  if (this.checked) {
Â  Â  Â  Â  endDateInput.value = '';
Â  Â  Â  Â  endDateInput.disabled = true;
Â  Â  } else {
Â  Â  Â  Â  endDateInput.disabled = false;
Â  Â  }
};

addWorkplaceBtn.onclick = () => openWorkplaceModal(-1);

cancelWorkplaceBtn.onclick = () => {
Â  Â  workplaceModal.style.display = 'none';
};

deleteWorkplaceBtn.onclick = () => {
Â  Â  if (editingIndex !== -1 && confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a "${workplaces[editingIndex].storeName}"?`)) {
Â  Â  Â  Â  workplaces.splice(editingIndex, 1);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (currentWorkplaceIndex === editingIndex) {
Â  Â  Â  Â  Â  Â  currentWorkplaceIndex = -1;
Â  Â  Â  Â  } else if (currentWorkplaceIndex > editingIndex) {
Â  Â  Â  Â  Â  Â  currentWorkplaceIndex--;
Â  Â  Â  Â  }

Â  Â  Â  Â  saveWorkplaces();
Â  Â  Â  Â  workplaceModal.style.display = 'none';
Â  Â  }
};

createWorkplaceBtn.onclick = () => {
Â  Â  const storeName = document.getElementById('storeNameInput').value;
Â  Â  const address = document.getElementById('addressInput').value;
Â  Â  const startDate = document.getElementById('startDateInput').value;
Â  Â  let endDate = endDateInput.value;

Â  Â  if (document.getElementById('isCurrentWork').checked) {
Â  Â  Â  Â  endDate = 'Äang lÃ m';
Â  Â  }

Â  Â  if (!storeName || !startDate) {
Â  Â  Â  Â  alert('Vui lÃ²ng nháº­p TÃªn cá»­a hÃ ng vÃ  NgÃ y báº¯t Ä‘áº§u.');Â 
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  const newWorkplace = { storeName, address, startDate, endDate };

Â  Â  if (editingIndex !== -1) {
Â  Â  Â  Â  workplaces[editingIndex] = newWorkplace;
Â  Â  } else {
Â  Â  Â  Â  workplaces.push(newWorkplace);
Â  Â  Â  Â  currentWorkplaceIndex = workplaces.length - 1;Â 
Â  Â  }
Â  Â Â 
Â  Â  saveWorkplaces();
Â  Â  workplaceModal.style.display = 'none';
};

// --- CÃC Sá»° KIá»†N KHÃC ---
document.getElementById('saveTime').onclick=()=>{
Â  Â  const key=document.getElementById('timeModal').dataset.key;
Â  Â  const tin=document.getElementById('timeIn').value;
Â  Â  const tout=document.getElementById('timeOut').value;
Â  Â  const [hi,mi]=tin.split(':').map(Number);const [ho,mo]=tout.split(':').map(Number);
Â  Â  let hrs=(ho+mo/60)-(hi+mi/60);
Â  Â  
    // Logic tÃ­nh giá» lÃ m viá»‡c qua Ä‘Ãªm
    if(hrs < 0) {
        // Náº¿u giá» ra nhá» hÆ¡n giá» vÃ o, giáº£ Ä‘á»‹nh lÃ  ca qua Ä‘Ãªm (cá»™ng thÃªm 24 giá»)
        hrs += 24;
    }
    
Â  Â  workData[key]={in:tin,out:tout,hours:hrs};
Â  Â  document.getElementById('timeModal').style.display='none';
Â  Â  renderCalendar();
};
document.getElementById('cancelTime').onclick=()=>document.getElementById('timeModal').style.display='none';
document.getElementById('prevMonth').onclick=()=>{currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();};
document.getElementById('nextMonth').onclick=()=>{currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();};
rateInput.onchange=updateSummary;

// --- KHá»I Táº O á»¨NG Dá»¤NG ---
renderWorkplaceList();
// Bá» gá»i hÃ m updateCurrentWorkplaceDisplay();
renderCalendar();
</script>
</body>
</html>
