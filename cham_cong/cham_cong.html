<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="title">B·∫£ng Ch·∫•m C√¥ng Theo Th√°ng</title>
    <style>
        html, body {
            height: 100%; margin: 0; font-family: Arial, sans-serif;
        }
        body {
            background-color: #f4f7f6; min-height: 100vh; display: flex; justify-content: center;
        }
        .container {
            max-width: 900px; width: 95%; margin: 20px auto; padding: 20px; background: #fff;
            display: flex; flex-direction: column; min-height: 600px;
        }
        .header-controls {
            display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; flex-shrink: 0;
        }
        .top-row {
            display: flex; justify-content: space-between; align-items: center; width: 100%;
        }
        .year-display {
            font-size: 1.4em; font-weight: bold; color: #27ae60; padding: 5px;
        }
        .controls {
            display: flex; gap: 15px; justify-content: flex-end; align-items: center;
        }
        .control-group label {
            font-weight: bold; color: #555; font-size: 0.9em;
        }
        .workplace-button {
            padding: 8px 15px; background-color: #3498db; color: white; border: none;
            border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.9em; margin-right: 15px;
        }
        .workplace-button:hover {
            background-color: #2980b9;
        }
        h1 {
            text-align: center; color: #2c3e50; margin: 0; font-size: 1.5em; width: 100%; order: 2;
        }
        h1 .nav-arrow {
            cursor: pointer; padding: 0 5px; user-select: none;
        }
        .calendar-header {
            text-align: center; font-size: 1.2em; margin-bottom: 15px; color: #3498db;
        }
        .rate-input-group {
            display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.9em;
        }
        .calendar-table {
            width: 100%; table-layout: fixed; border-collapse: collapse; flex-grow: 1;
        }
        .calendar-table th, .calendar-table td {
            border: 1px solid #bdc3c7; padding: 0; text-align: center; font-size: 0.7em;
        }
        .calendar-table th {
            background-color: #ecf0f1; color: #2c3e50; padding: 5px 0;
        }
        .calendar-table th:first-child {
            color: #e74c3c;
        }
        .calendar-table tr td:first-child {
            background-color: #fcebeb;
        }
        .calendar-table td:empty {
            background-color: #e0e0e0 !important; cursor: default;
        }
        .day-cell {
            vertical-align: top; width: 14.28%; min-height: 50px; background-color: #fcfcfc;
            position: relative; cursor: pointer; user-select: none;
        }
        .day-number {
            font-weight: bold; font-size: 1.1em; display: block; position: absolute;
            top: 2px; left: 5px; color: #2980b9;
        }
        .work-display {
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-weight: bold; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; padding: 2px 0;
        }
        .work-display span {
            line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            width: 100%; text-align: center;
        }
        .work-hours-in-cell {
            color: #27ae60; font-size: 0.9em;
        }
        .work-amount-in-cell {
            color: #e74c3c; font-size: 1em;
        }
        .summary {
            margin-top: 10px; padding: 10px; border-top: 3px double #3498db; background-color: #eaf6fd;
            border-radius: 5px; flex-shrink: 0;
        }
        .summary p {
            font-size: 1em; margin: 8px 0; font-weight: 500;
        }
        .total-amount {
            font-size: 1.6em; color: #e74c3c; font-weight: bold;
        }
        #totalHours {
            color: green; font-weight: bold;
        }
        .workplace-list {
            margin-top: 10px; padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px;
            max-height: 200px; overflow-y: auto;
        }
        .workplace-item {
            display: flex; justify-content: space-between; align-items: center; padding: 8px 0;
            border-bottom: 1px dotted #ccc; font-size: 0.9em;
        }
        .workplace-item:last-child {
            border-bottom: none;
        }
        .workplace-info span {
            display: block; line-height: 1.2;
        }
        .workplace-info .name {
            font-weight: bold; color: #2c3e50;
        }
        .workplace-info .address {
            color: #555; font-size: 0.9em;
        }
        .workplace-item button {
            padding: 5px 10px; font-size: 0.8em; background-color: #e74c3c; color: white;
            border: none; border-radius: 3px; cursor: pointer;
        }
        .workplace-item button:hover {
            background-color: #c0392b;
        }
        /* --- MODAL STYLES --- */
        .modal {
            position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto;
            background-color: rgba(0,0,0,0.6); display: none; justify-content: center;
            align-items: center; box-sizing: border-box;
        }
        .modal-content {
            background-color: #fefefe; padding: 20px; border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); width: 90%; max-width: 400px;
            display: flex; flex-direction: column; gap: 15px; align-items: stretch; box-sizing: border-box;
        }
        .modal-content h2 {
            margin: 0 0 5px 0; color: #3498db; text-align: center;
        }
        .time-input-group, .text-input-group {
            display: flex; flex-direction: column; gap: 5px;
        }
        .time-input-group label, .text-input-group label {
            font-weight: bold; color: #2c3e50; font-size: 1em;
        }
        .modal-content input[type="time"],
        .modal-content input[type="text"],
        .modal-content input[type="date"] {
            padding: 10px; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 1.2em;
            text-align: center; width: 100%; box-sizing: border-box;
        }
        .modal-actions {
            display: flex; justify-content: space-between; margin-top: 10px;
        }
        .modal-actions button {
            padding: 10px 10px; border: none; border-radius: 5px; font-size: 1em; cursor: pointer;
            flex: 1; margin: 0 5px;
        }
        .modal-actions button:first-child {
            margin-left: 0;
        }
        .modal-actions button:last-child {
            margin-right: 0;
        }
        .modal-actions button.cancel {
            background-color: #ecf0f1; color: #2c3e50;
        }
        .modal-actions button.delete {
            background-color: #f39c12; color: white;
        }
        .modal-actions button.save {
            background-color: #3498db; color: white;
        }
        #workplaceDeleteButton {
            background-color: #e74c3c;
        }
        .date-range-group {
            display: flex; flex-direction: column; gap: 10px;
        }
        .date-input-row {
            display: flex; gap: 10px; align-items: center;
        }
        .date-input-row > div {
            flex: 1;
        }
        #workplaceModal #endDateDiv {
            flex: 1;
        }
        .toggle-switch-group {
            display: flex; align-items: center; gap: 10px;
        }
        @media (max-width: 767px) {
            .container {
                padding: 10px; min-height: auto;
            }
            .day-cell {
                min-height: 50px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="timesheetContainer">

        <div class="header-controls">
            <div class="top-row">
                <div id="yearDisplay" class="year-display"></div>

                <div class="controls">
                    <button class="workplace-button" id="btnAddWorkplace" data-key="btn_add_workplace">Th√™m N∆°i L√†m Vi·ªác</button>

                    <div class="control-group">
                        <label data-key="label_lang" for="languageSelect">Ng√¥n ng·ªØ:</label>
                        <select id="languageSelect">
                            <option value="vi">Ti·∫øng Vi·ªát</option>
                            <option value="en">English</option>
                            <option value="ko">ÌïúÍµ≠Ïñ¥</option>
                        </select>
                    </div>
                </div>
            </div>

            <h1 data-key="h1_month_title">
                <span class="nav-arrow" id="prevMonthArrow">‚óÄÔ∏è</span>
                <span id="currentMonthYear"></span>
                <span class="nav-arrow" id="nextMonthArrow">‚ñ∂Ô∏è</span>
            </h1>
        </div>

        <div class="workplace-header">
            <h3 data-key="h3_workplaces">N∆°i L√†m Vi·ªác Hi·ªán T·∫°i:</h3>
            <div id="workplaceList" class="workplace-list">
                <p data-key="p_no_workplaces">Ch∆∞a c√≥ n∆°i l√†m vi·ªác n√†o ƒë∆∞·ª£c th√™m.</p>
            </div>
        </div>

        <div class="calendar-header">
            <div class="rate-input-group">
                <span data-key="label_rate">üí∞ L∆∞∆°ng/gi·ªù:</span>

                <input type="number" id="hourlyRate" min="1000" style="width:80px;" placeholder="">
                <span id="currencyUnit" class="currency-unit">VND</span>
            </div>
            <p id="note" class="note" data-key="note_calc"></p>
        </div>

        <table class="calendar-table">
            <thead>
                <tr id="tableHeaders">
                    <th data-key="th_sun">CN</th>
                    <th data-key="th_mon">T2</th>
                    <th data-key="th_tue">T3</th>
                    <th data-key="th_wed">T4</th>
                    <th data-key="th_thu">T5</th>
                    <th data-key="th_fri">T6</th>
                    <th data-key="th_sat">T7</th>
                </tr>
            </thead>
            <tbody id="calendarBody">
            </tbody>
        </table>

        <div class="summary">
            <p><span id="summaryHoursPrefix" data-key="summary_total_hours_prefix_month">‚úÖ T·ªïng gi·ªù l√†m vi·ªác trong th√°ng:</span> <span id="totalHours" class="work-hours">0.00</span> <span data-key="summary_hours_suffix">gi·ªù</span></p>

            <p><span id="summaryIncomePrefix" data-key="summary_total_income_month">üíµ T·ªîNG THU NH·∫¨P D·ª∞ KI·∫æN:</span></p>

            <div id="totalAmount" class="total-amount">0 VND</div>
        </div>
    </div>

    <div id="timeModal" class="modal">
        <div class="modal-content">
            <h2 data-key="modal_title_prefix">Nh·∫≠p Gi·ªù C√¥ng <span id="modalDayNumber"></span></h2>

            <div class="time-input-group">
                <label data-key="in" for="modalTimeIn">V√†o:</label>
                <input type="time" id="modalTimeIn" value="09:00">
            </div>

            <div class="time-input-group">
                <label data-key="out" for="modalTimeOut">Ra:</label>
                <input type="time" id="modalTimeOut" value="18:00">
            </div>

            <div class="modal-actions">
                <button class="cancel" id="timeModalCancel" data-key="btn_cancel">H·ªßy</button>
                <button class="delete" id="timeModalDelete" data-key="btn_delete">X√≥a</button>
                <button class="save" id="timeModalSave" data-key="btn_save">Ch·ªçn</button>
            </div>
        </div>
    </div>

    <div id="workplaceModal" class="modal">
        <div class="modal-content">
            <h2 id="workplaceModalTitle" data-key="modal_workplace_title_create">Th√™m N∆°i L√†m Vi·ªác M·ªõi</h2>

            <div class="text-input-group">
                <label data-key="label_shop_name" for="shopName">T√™n C·ª≠a H√†ng/C√¥ng Ty:</label>
                <input type="text" id="shopName" placeholder="V√≠ d·ª•: Coffee A">
            </div>

            <div class="text-input-group">
                <label data-key="label_address" for="address">ƒê·ªãa Ch·ªâ:</label>
                <input type="text" id="address" placeholder="V√≠ d·ª•: 123 ƒê∆∞·ªùng B">
            </div>

            <div class="date-range-group">
                <label data-key="label_work_period">Th·ªùi Gian L√†m Vi·ªác:</label>
                <div class="date-input-row">
                    <div class="text-input-group">
                        <label data-key="label_from_date" for="startDate">T·ª´ Ng√†y:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="text-input-group" id="endDateDiv">
                        <label data-key="label_to_date" for="endDate">ƒê·∫øn Ng√†y:</label>
                        <input type="date" id="endDate">
                    </div>
                    <div class="toggle-switch-group">
                         <label data-key="label_still_working" for="stillWorking">ƒêang l√†m:</label>
                        <input type="checkbox" id="stillWorking" checked>
                    </div>
                </div>
            </div>


            <div class="modal-actions">
                <button class="cancel" id="workplaceModalCancel" data-key="btn_cancel">H·ªßy</button>
                <button class="delete" id="workplaceDeleteButton" data-key="btn_delete_workplace" style="display:none;">X√≥a C·ª≠a H√†ng</button>
                <button class="save" id="workplaceSaveButton" data-key="btn_create_workplace">T·∫°o</button>
            </div>
        </div>
    </div>


    <script>
(() => {
const $ = id => document.getElementById(id),
      qs = sel => document.querySelector(sel),
      qsa = sel => document.querySelectorAll(sel);
let m = new Date().getMonth(), y = new Date().getFullYear(),
    d = {}, w = [], eid = null, cday = null, touchX = 0;

const KEY = { RATE:'rate', LANG:'lang', WORK:'workplaces' },
t = {
vi:{title:'B·∫£ng Ch·∫•m C√¥ng Theo Th√°ng',currencyCode:'VND',currencyLocale:'vi-VN',
month:["Th√°ng 1","Th√°ng 2","Th√°ng 3","Th√°ng 4","Th√°ng 5","Th√°ng 6","Th√°ng 7","Th√°ng 8","Th√°ng 9","Th√°ng 10","Th√°ng 11","Th√°ng 12"],
th:['CN','T2','T3','T4','T5','T6','T7'],in:'V√†o:',out:'Ra:',hour:'gi·ªù',sumh:'‚úÖ T·ªïng gi·ªù l√†m vi·ªác trong ',sumt:'üíµ T·ªîNG THU NH·∫¨P D·ª∞ KI·∫æN ',add:'‚ûï Th√™m N∆°i L√†m Vi·ªác',edit:'S·ª≠a',no:'Ch∆∞a c√≥ n∆°i l√†m vi·ªác n√†o ƒë∆∞·ª£c th√™m.',still:'ƒêang l√†m',sdel:'X√≥a C·ª≠a H√†ng',screate:'T·∫°o',supdate:'L∆∞u',sn:'T√™n C·ª≠a H√†ng/C√¥ng Ty:',sa:'ƒê·ªãa Ch·ªâ:',sf:'T·ª´ Ng√†y:',st:'ƒê·∫øn Ng√†y:'},
en:{title:'Monthly Timesheet',currencyCode:'USD',currencyLocale:'en-US',
month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],
th:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],in:'In:',out:'Out:',hour:'h',sumh:'‚úÖ Total work hours for ',sumt:'üíµ ESTIMATED TOTAL INCOME for ',add:'‚ûï Add Workplace',edit:'Edit',no:'No workplaces added yet.',still:'Still Working',sdel:'Delete Workplace',screate:'Create',supdate:'Save',sn:'Shop/Company:',sa:'Address:',sf:'From:',st:'To:'},
ko:{title:'ÏõîÍ∞Ñ Í∑ºÎ¨¥ ÏãúÍ∞ÑÌëú',currencyCode:'KRW',currencyLocale:'ko-KR',
month:["1Ïõî","2Ïõî","3Ïõî","4Ïõî","5Ïõî","6Ïõî","7Ïõî","8Ïõî","9Ïõî","10Ïõî","11Ïõî","12Ïõî"],
th:['Ïùº','Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†'],in:'Ï∂úÍ∑º:',out:'Ìá¥Í∑º:',hour:'ÏãúÍ∞Ñ',sumh:'‚úÖ Ï¥ù Í∑ºÎ¨¥ ÏãúÍ∞Ñ ',sumt:'üíµ ÏòàÏÉÅ Ï¥ù ÏàòÏûÖ ',add:'‚ûï Í∑ºÎ¨¥ÏßÄ Ï∂îÍ∞Ä',edit:'ÏàòÏ†ï',no:'Ï∂îÍ∞ÄÎêú Í∑ºÎ¨¥ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.',still:'Í∑ºÎ¨¥ Ï§ë',sdel:'Í∑ºÎ¨¥ÏßÄ ÏÇ≠Ï†ú',screate:'ÏÉùÏÑ±',supdate:'Ï†ÄÏû•',sn:'ÏÉÅÏ†ê/ÌöåÏÇ¨ Ïù¥Î¶Ñ:',sa:'Ï£ºÏÜå:',sf:'ÏãúÏûëÏùº:',st:'Ï¢ÖÎ£åÏùº:'}
};

const S=()=>`time-${y}-${m+1}`,G=_=>JSON.parse(localStorage.getItem(_)||'[]'),
set=_=>localStorage.setItem(_,JSON.stringify(_=='work'?w:_=='rate'?$('hourlyRate').value:_=='lang'?$('languageSelect').value:d));

function calc(i,o){if(!i||!o)return 0;let[hi,mi]=i.split(':').map(Number),[ho,mo]=o.split(':').map(Number);
let m1=hi*60+mi,m2=ho*60+mo;if(m2<m1)m2+=1440;return (m2-m1)/60;}

function renderWork(){
const T=t[$('languageSelect').value],L=$('workplaceList');L.innerHTML='';
if(!w.length)return L.innerHTML=`<p>${T.no}</p>`;
w.forEach(v=>{
let e=v.still?`<span style="color:#27ae60;">(${T.still})</span>`:`<span>${v.end||''}</span>`;
let div=document.createElement('div');div.className='workplace-item';
div.innerHTML=`<div class="workplace-info"><span class="name">${v.shop}</span><span class="address">${v.addr}</span><span>${T.sf} ${v.start} - ${T.st} ${e}</span></div><button>${T.edit}</button>`;
div.querySelector('button').onclick=_=>openWork('edit',v.id);L.append(div);
});
}

function openWork(mode,id){
const M=$('workplaceModal'),T=t[$('languageSelect').value];M.style.display='flex';eid=id;
$('workplaceDeleteButton').style.display=mode=='edit'?'inline-block':'none';
if(mode=='edit'){let v=w.find(x=>x.id==id);
$('shopName').value=v.shop;$('address').value=v.addr;$('startDate').value=v.start;$('endDate').value=v.end||'';$('stillWorking').checked=v.still;
toggleEnd(v.still);}else{$('shopName').value=$('address').value=$('startDate').value=$('endDate').value='';$('stillWorking').checked=true;toggleEnd(true);}
$('workplaceSaveButton').textContent=mode=='edit'?T.supdate:T.screate;qs('#workplaceModal h2').textContent=mode=='edit'?T.edit+' n∆°i l√†m vi·ªác':T.add;
}
function closeWork(){eid=null;$('workplaceModal').style.display='none';}
function toggleEnd(b){$('endDateDiv').style.display=b?'none':'block';}
function saveWork(){
let s=$('shopName').value.trim(),a=$('address').value.trim(),st=$('startDate').value,en=$('endDate').value,still=$('stillWorking').checked;
if(!s||!a||!st)return alert('ƒêi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
if(!still&&!en)return alert('Ch·ªçn ng√†y k·∫øt th√∫c ho·∫∑c ƒêang l√†m.');
let obj={shop:s,addr:a,start:st,end:still?null:en,still,id:eid||Date.now()};
if(eid){let i=w.findIndex(x=>x.id==eid);if(i!=-1)w[i]=obj;}else w.push(obj);
set('work');renderWork();closeWork();
}
function delWork(){if(!eid)return;if(confirm('X√≥a n∆°i l√†m vi·ªác n√†y?')){w=w.filter(x=>x.id!=eid);set('work');renderWork();closeWork();}}

function openDay(dy){cday=dy;let T=t[$('languageSelect').value];$('timeModal').style.display='flex';
$('modalTimeIn').value=d[dy]?.in||'09:00';$('modalTimeOut').value=d[dy]?.out||'18:00';qs('#timeModal h2').textContent=T.title+' '+dy;}
function closeDay(){$('timeModal').style.display='none';cday=null;}
function saveDay(){d[cday]={in:$('modalTimeIn').value,out:$('modalTimeOut').value};closeDay();sum();}
function delDay(){delete d[cday];closeDay();sum();}

function sum(){
let T=t[$('languageSelect').value],rate=parseFloat($('hourlyRate').value)||0,total=0;
qsa('.day-cell').forEach(c=>{
let day=c.querySelector('.day-number');if(!day)return;
let {in:i,out:o}=d[day.textContent]||{},h=calc(i,o);
total+=h;c.querySelector('.work-hours-in-cell').textContent=h?`${h.toFixed(1)}${T.hour[0]}`:'';c.querySelector('.work-amount-in-cell').textContent=h&&rate?(h*rate).toLocaleString(T.currencyLocale,{style:'currency',currency:T.currencyCode}):'';});
$('totalHours').textContent=total.toFixed(2);
$('summaryHoursPrefix').textContent=T.sumh+T.month[m]+':';
$('summaryIncomePrefix').textContent=T.sumt+T.month[m]+':';
$('totalAmount').textContent=(total*rate).toLocaleString(T.currencyLocale,{style:'currency',currency:T.currencyCode});
['rate','lang'].forEach(set);set('work');localStorage.setItem(S(),JSON.stringify(d));
}

function cal(){
$('calendarBody').innerHTML='';let T=t[$('languageSelect').value],dt=new Date(y,m,1),r=$('calendarBody').insertRow();
for(let i=0;i<dt.getDay();i++)r.insertCell();
for(let day=1;dt.getMonth()==m;day++,dt.setDate(day)){
if(r.cells.length==7)r=$('calendarBody').insertRow();
let c=r.insertCell();c.className='day-cell';c.innerHTML=`<span class="day-number">${day}</span><div class="work-display"><span class="work-hours-in-cell"></span><span class="work-amount-in-cell"></span></div>`;
c.onclick=_=>openDay(day);}
while(r.cells.length<7)r.insertCell();sum();
}

function lang(){
let v=$('languageSelect').value,T=t[v];
document.title=T.title;qs('#currentMonthYear').textContent=T.month[m];qs('#currencyUnit').textContent=T.currencyCode;
qsa('#tableHeaders th').forEach((th,i)=>th.textContent=T.th[i]);
$('btnAddWorkplace').textContent=T.add;renderWork();cal();
}

function change(n){m+=n;if(m>11){m=0;y++}else if(m<0){m=11;y--;}load();lang();}

function load(){
$('hourlyRate').value=localStorage.getItem(KEY.RATE)||'';$('languageSelect').value=localStorage.getItem(KEY.LANG)||'vi';
d=JSON.parse(localStorage.getItem(S())||'{}');w=G(KEY.WORK);
}

window.onload=()=>{
$('prevMonthArrow').onclick=_=>change(-1);$('nextMonthArrow').onclick=_=>change(1);
$('timeModalCancel').onclick=closeDay;$('timeModalDelete').onclick=delDay;$('timeModalSave').onclick=saveDay;
$('workplaceModalCancel').onclick=closeWork;$('workplaceSaveButton').onclick=saveWork;$('workplaceDeleteButton').onclick=delWork;
$('btnAddWorkplace').onclick=_=>openWork('create');$('stillWorking').onchange=e=>toggleEnd(e.target.checked);
$('hourlyRate').oninput=sum;$('languageSelect').onchange=lang;
$('timesheetContainer').addEventListener('touchstart',e=>touchX=e.touches[0].clientX);
$('timesheetContainer').addEventListener('touchend',e=>{let dx=e.changedTouches[0].clientX-touchX;if(Math.abs(dx)>80)change(dx>0?-1:1);});
load();lang();
};
})();
</script>

</body>
</html>
