<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i C·ªù Caro (Tic-Tac-Toe)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        /* ƒê·ªãnh d·∫°ng √¥ c·ªù */
        .caro-cell {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem; /* K√≠ch th∆∞·ªõc k√Ω hi·ªáu X/O */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.1s ease;
            user-select: none;
        }
        .caro-cell:hover:not(:disabled) {
            background-color: #e5e7eb; /* M√†u x√°m nh·∫°t khi r√™ chu·ªôt */
        }
        /* Th√™m ƒë∆∞·ªùng vi·ªÅn √¥ (s·ª≠ d·ª•ng Tailwind grid/border cho b·ªë c·ª•c) */
        #caro-board {
            border-collapse: collapse;
            border: 3px solid #374151; /* Vi·ªÅn ngo√†i ƒë·∫≠m h∆°n */
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'game-primary': '#4CAF50',
                        'game-tertiary': '#FF5722',
                        'gray-bg': '#f3f4f6'
                    }
                }
            }
        }

        let board = ['', '', '', '', '', '', '', '', '']; // 9 √¥
        let currentPlayer = 'X';
        let gameActive = true;

        const statusDisplay = document.getElementById('gameStatus');

        const winningConditions = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // H√†ng ngang
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // H√†ng d·ªçc
            [0, 4, 8], [2, 4, 6]             // ƒê∆∞·ªùng ch√©o
        ];

        // ------------------------------------
        // LOGIC CH√çNH C·ª¶A TR√í CH∆†I
        // ------------------------------------

        function handleCellClick(clickedCellEvent) {
            const clickedCell = clickedCellEvent.target;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));

            // 1. Ki·ªÉm tra: ƒê√£ c√≥ ng∆∞·ªùi ch∆°i ch∆∞a? Game c√≤n ho·∫°t ƒë·ªông kh√¥ng?
            if (board[clickedCellIndex] !== '' || !gameActive) {
                return;
            }

            // 2. C·∫≠p nh·∫≠t tr·∫°ng th√°i v√† giao di·ªán
            board[clickedCellIndex] = currentPlayer;
            clickedCell.innerHTML = currentPlayer === 'X' ? '<span class="text-game-primary">X</span>' : '<span class="text-game-tertiary">O</span>';

            // 3. Ki·ªÉm tra k·∫øt qu·∫£
            handleResultValidation();
        }

        function handleResultValidation() {
            let roundWon = false;
            for (let i = 0; i < 8; i++) {
                const winCondition = winningConditions[i];
                let a = board[winCondition[0]];
                let b = board[winCondition[1]];
                let c = board[winCondition[2]];

                if (a === '' || b === '' || c === '') {
                    continue; // Ti·∫øp t·ª•c v√≤ng l·∫∑p n·∫øu ch∆∞a ƒë·ªß 3 √¥
                }
                if (a === b && b === c) {
                    roundWon = true;
                    // Highlight 3 √¥ chi·∫øn th·∫Øng
                    document.querySelector(`[data-index="${winCondition[0]}"]`).style.backgroundColor = '#bbf7d0';
                    document.querySelector(`[data-index="${winCondition[1]}"]`).style.backgroundColor = '#bbf7d0';
                    document.querySelector(`[data-index="${winCondition[2]}"]`).style.backgroundColor = '#bbf7d0';
                    break;
                }
            }

            if (roundWon) {
                statusDisplay.innerHTML = `üéâ Ng∆∞·ªùi ch∆°i <span class="font-extrabold">${currentPlayer}</span> Th·∫Øng!`;
                gameActive = false;
                return;
            }

            // Ki·ªÉm tra H√≤a (n·∫øu t·∫•t c·∫£ √¥ ƒë√£ ƒë∆∞·ª£c ƒëi)
            let roundDraw = !board.includes('');
            if (roundDraw) {
                statusDisplay.innerHTML = `ü§ù V√°n ƒë·∫•u H√≤a!`;
                gameActive = false;
                return;
            }

            // Chuy·ªÉn l∆∞·ª£t ch∆°i
            handlePlayerChange();
        }

        function handlePlayerChange() {
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            statusDisplay.innerHTML = `L∆∞·ª£t ch∆°i c·ªßa: <span class="font-extrabold text-${currentPlayer === 'X' ? 'game-primary' : 'game-tertiary'}">${currentPlayer}</span>`;
        }

        function handleRestartGame() {
            gameActive = true;
            currentPlayer = 'X';
            board = ['', '', '', '', '', '', '', '', ''];
            statusDisplay.innerHTML = `L∆∞·ª£t ch∆°i c·ªßa: <span class="font-extrabold text-game-primary">X</span>`;
            
            // X√≥a n·ªôi dung v√† m√†u n·ªÅn c·ªßa c√°c √¥
            document.querySelectorAll('.caro-cell').forEach(cell => {
                cell.innerHTML = '';
                cell.style.backgroundColor = '';
            });
        }

        // ƒê·∫£m b·∫£o game b·∫Øt ƒë·∫ßu khi t·∫£i trang
        window.onload = () => {
            document.querySelectorAll('.caro-cell').forEach(cell => {
                cell.addEventListener('click', handleCellClick);
            });
            handleRestartGame(); // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
        };
    </script>
</head>
<body class="bg-gray-bg flex flex-col items-center pt-8 px-4">

    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 mb-8">
        C·ªù Caro (Tic-Tac-Toe) ‚ùå‚≠ï
    </h1>

    <div class="w-full max-w-sm bg-white p-6 rounded-xl shadow-2xl text-center">
        
        <p id="gameStatus" class="text-xl mb-6 font-medium text-gray-700">
            L∆∞·ª£t ch∆°i c·ªßa: <span class="font-extrabold text-game-primary">X</span>
        </p>

        <div id="caro-board" class="grid grid-cols-3 aspect-square mx-auto">
            
            <div data-index="0" class="caro-cell border-r-4 border-b-4 border-gray-400"></div>
            <div data-index="1" class="caro-cell border-r-4 border-b-4 border-gray-400"></div>
            <div data-index="2" class="caro-cell border-b-4 border-gray-400"></div>
            
            <div data-index="3" class="caro-cell border-r-4 border-b-4 border-gray-400"></div>
            <div data-index="4" class="caro-cell border-r-4 border-b-4 border-gray-400"></div>
            <div data-index="5" class="caro-cell border-b-4 border-gray-400"></div>

            <div data-index="6" class="caro-cell border-r-4 border-gray-400"></div>
            <div data-index="7" class="caro-cell border-r-4 border-gray-400"></div>
            <div data-index="8" class="caro-cell"></div>

        </div>
        
        <button onclick="handleRestartGame()"
                class="mt-8 bg-game-primary hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full 
                       transition duration-150 ease-in-out shadow-md">
            Ch∆°i l·∫°i
        </button>
    </div>

    <div class="mt-8 text-center">
        <a href="menu-game.html" 
           class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-full 
                  text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out">
            ‚Üê Tr·ªü v·ªÅ Menu Tr√≤ Ch∆°i
        </a>
    </div>

</body>
</html>
