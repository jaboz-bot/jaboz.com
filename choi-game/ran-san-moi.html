<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ Ch∆°i R·∫Øn SƒÉn M·ªìi (Snake)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        /* K√≠ch th∆∞·ªõc √¥ vu√¥ng (cell) c·ªßa tr√≤ ch∆°i */
        .game-grid {
            display: grid;
            /* ƒê·∫∑t k√≠ch th∆∞·ªõc l∆∞·ªõi 20x20 */
            grid-template-columns: repeat(20, 1fr); 
            grid-template-rows: repeat(20, 1fr);
            border: 4px solid #374151;
            background-color: #000000; /* N·ªÅn ƒëen cho khu v·ª±c ch∆°i */
        }
        .grid-cell {
            /* C√°c √¥ trong l∆∞·ªõi, kh√¥ng c√≥ m√†u n·ªÅn m·∫∑c ƒë·ªãnh */
            width: 100%;
            height: 100%;
        }
        /* M√†u s·∫Øc cho c√°c th√†nh ph·∫ßn tr√≤ ch∆°i */
        .snake-head {
            background-color: #4CAF50; /* Xanh l√° cho ƒë·∫ßu R·∫Øn */
            border: 1px solid #2e7d32;
            border-radius: 2px;
        }
        .snake-body {
            background-color: #81C784; /* Xanh l√° nh·∫°t cho th√¢n R·∫Øn */
            border-radius: 2px;
        }
        .food {
            background-color: #FF5722; /* M√†u cam/ƒë·ªè cho th·ª©c ƒÉn */
            border-radius: 50%; /* Tr√≤n */
            animation: pulse 1s infinite alternate;
        }
        /* Hi·ªáu ·ª©ng nh·∫•p nh√°y cho th·ª©c ƒÉn */
        @keyframes pulse {
            from { transform: scale(0.9); }
            to { transform: scale(1.1); }
        }
        .game-over-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            z-index: 10;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'game-primary': '#4CAF50',
                        'game-tertiary': '#FF5722',
                        'gray-bg': '#f3f4f6'
                    }
                }
            }
        }
        
        // C·∫•u h√¨nh tr√≤ ch∆°i
        const GRID_SIZE = 20;
        let snake = [];
        let food = {};
        let direction = 'right';
        let score = 0;
        let gameLoopInterval;
        let gameActive = false;

        // C√°c ph·∫ßn t·ª≠ DOM
        const boardElement = document.getElementById('gameBoard');
        const scoreElement = document.getElementById('score');
        const statusElement = document.getElementById('gameStatus');
        const overlayElement = document.getElementById('gameOverOverlay');

        // ------------------------------------
        // LOGIC TR√í CH∆†I
        // ------------------------------------

        function initGame() {
            // Thi·∫øt l·∫≠p tr·∫°ng th√°i ban ƒë·∫ßu
            snake = [{ row: 10, col: 5 }, { row: 10, col: 4 }, { row: 10, col: 3 }]; // R·∫Øn kh·ªüi t·∫°o 3 √¥
            direction = 'right';
            score = 0;
            gameActive = true;
            scoreElement.textContent = score;
            overlayElement.classList.add('hidden');
            statusElement.textContent = "S·ª≠ d·ª•ng ph√≠m m≈©i t√™n ƒë·ªÉ di chuy·ªÉn";
            
            generateFood();
            renderGame();
            
            // Kh·ªüi ƒë·ªông v√≤ng l·∫∑p game (v√≠ d·ª•: 150ms/l·∫ßn)
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 150);
        }

        function generateFood() {
            let newFood;
            do {
                newFood = { 
                    row: Math.floor(Math.random() * GRID_SIZE), 
                    col: Math.floor(Math.random() * GRID_SIZE) 
                };
            } while (isFoodOnSnake(newFood)); // ƒê·∫£m b·∫£o th·ª©c ƒÉn kh√¥ng n·∫±m tr√™n R·∫Øn
            
            food = newFood;
        }

        function isFoodOnSnake(newFood) {
             return snake.some(segment => segment.row === newFood.row && segment.col === newFood.col);
        }

        function gameLoop() {
            if (!gameActive) return;

            // 1. C·∫≠p nh·∫≠t v·ªã tr√≠ R·∫Øn (MOVE)
            const newHead = getNewHeadPosition();
            
            // 2. Ki·ªÉm tra va ch·∫°m (COLLISION)
            if (checkCollision(newHead)) {
                endGame();
                return;
            }
            
            // 3. Th√™m ƒë·∫ßu m·ªõi v√† ki·ªÉm tra ƒÉn th·ª©c ƒÉn
            snake.unshift(newHead); // Th√™m ƒë·∫ßu m·ªõi

            if (newHead.row === food.row && newHead.col === food.col) {
                // ƒÇN TH·ª®C ƒÇN (kh√¥ng c·∫Øt ƒëu√¥i)
                score += 10;
                scoreElement.textContent = score;
                generateFood(); // Sinh th·ª©c ƒÉn m·ªõi
            } else {
                // DI CHUY·ªÇN B√åNH TH∆Ø·ªúNG (c·∫Øt ƒëu√¥i)
                snake.pop(); 
            }
            
            // 4. V·∫Ω l·∫°i tr√≤ ch∆°i
            renderGame();
        }
        
        function getNewHeadPosition() {
            const head = snake[0];
            let newHead = { row: head.row, col: head.col };
            
            switch (direction) {
                case 'up': newHead.row--; break;
                case 'down': newHead.row++; break;
                case 'left': newHead.col--; break;
                case 'right': newHead.col++; break;
            }
            return newHead;
        }

        function checkCollision(head) {
            // Va ch·∫°m v·ªõi t∆∞·ªùng
            if (head.row < 0 || head.row >= GRID_SIZE || head.col < 0 || head.col >= GRID_SIZE) {
                return true; 
            }
            // Va ch·∫°m v·ªõi th√¢n
            if (snake.slice(1).some(segment => segment.row === head.row && segment.col === head.col)) {
                return true; 
            }
            return false;
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameLoopInterval);
            statusElement.textContent = "GAME OVER!";
            overlayElement.classList.remove('hidden');
        }

        // ------------------------------------
        // V·∫º GIAO DI·ªÜN
        // ------------------------------------
        
        function renderGame() {
            boardElement.innerHTML = ''; // X√≥a b√†n c·ªù c≈©
            
            for (let i = 0; i < GRID_SIZE * GRID_SIZE; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                
                const row = Math.floor(i / GRID_SIZE);
                const col = i % GRID_SIZE;
                
                // Ki·ªÉm tra R·∫Øn
                const isSnakeSegment = snake.findIndex(s => s.row === row && s.col === col);

                if (isSnakeSegment === 0) {
                    cell.classList.add('snake-head');
                } else if (isSnakeSegment > 0) {
                    cell.classList.add('snake-body');
                } 
                
                // Ki·ªÉm tra Th·ª©c ƒÉn
                if (row === food.row && col === food.col) {
                    cell.classList.add('food');
                }
                
                boardElement.appendChild(cell);
            }
        }
        
        // ------------------------------------
        // ƒêI·ªÄU KHI·ªÇN
        // ------------------------------------
        
        document.addEventListener('keydown', e => {
            if (!gameActive) return;

            // NgƒÉn R·∫Øn quay ng∆∞·ª£c 180 ƒë·ªô
            if (e.key === 'ArrowUp' && direction !== 'down') direction = 'up';
            else if (e.key === 'ArrowDown' && direction !== 'up') direction = 'down';
            else if (e.key === 'ArrowLeft' && direction !== 'right') direction = 'left';
            else if (e.key === 'ArrowRight' && direction !== 'left') direction = 'right';
        });

        // Kh·ªüi ƒë·ªông tr√≤ ch∆°i khi t·∫£i trang
        window.onload = initGame;
    </script>
</head>
<body class="bg-gray-bg flex flex-col items-center pt-8 px-4">

    <h1 class="text-3xl md:text-4xl font-extrabold text-game-tertiary mb-6">
        R·∫Øn SƒÉn M·ªìi üêç
    </h1>

    <div class="w-full max-w-lg bg-white p-4 rounded-xl shadow-2xl text-center">
        
        <div class="flex justify-between items-center mb-4">
            <p class="text-xl font-bold text-gray-700">ƒêi·ªÉm: <span id="score" class="text-game-primary">0</span></p>
            <p id="gameStatus" class="text-sm font-semibold text-gray-500"></p>
        </div>

        <div class="relative mx-auto" style="width: 500px; height: 500px;">
            <div id="gameBoard" class="game-grid w-full h-full">
                </div>
            
            <div id="gameOverOverlay" class="game-over-overlay absolute inset-0 flex flex-col items-center justify-center hidden">
                <p class="text-4xl font-extrabold mb-4">GAME OVER</p>
                <button onclick="initGame()"
                        class="bg-game-tertiary hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg 
                               transition duration-150 ease-in-out shadow-lg">
                    Ch∆°i L·∫°i
                </button>
            </div>
        </div>
        
        <button onclick="initGame()"
                class="mt-6 bg-game-primary hover:bg-green-600 text-white font-medium py-2 px-6 rounded-full 
                       transition duration-150 ease-in-out shadow-md">
            Kh·ªüi ƒë·ªông l·∫°i
        </button>
    </div>

    <div class="mt-8 text-center">
        <a href="menu-game.html" 
           class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-full 
                  text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out">
            ‚Üê Tr·ªü v·ªÅ Menu Tr√≤ Ch∆°i
        </a>
    </div>

</body>
</html>
