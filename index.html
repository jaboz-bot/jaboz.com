<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Máy hỗ trợ giao tiếp</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    background: linear-gradient(135deg, #f0f9ff, #cbebff);
    height: 100vh;
    margin: 0;
    padding: 20px;
  }
  .button-box {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    margin-top: 30px;
  }
  .btn {
    background: white;
    border: 2px solid #0078d4;
    color: #0078d4;
    border-radius: 10px;
    padding: 15px 20px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    transition: 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .btn:hover { background: #0078d4; color: white; }

  input {
    font-size: 16px;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 220px;
  }
  .popup {
    position: absolute;
    background: #fff;
    border: 1px solid #0078d4;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    padding: 10px;
    font-size: 14px;
    color: #333;
    z-index: 1000;
  }
  .popup button {
    background: #0078d4;
    color: white;
    border: none;
    border-radius: 4px;
    margin-left: 6px;
    cursor: pointer;
    padding: 3px 8px;
  }
</style>
</head>
<body>
<h2>Máy hỗ trợ giao tiếp</h2>
<div class="button-box" id="buttons"></div>
<button id="addBtn" class="btn">➕ Thêm nút</button>

<script>
const DEFAULT_BUTTONS = [
  "Tôi muốn ăn cơm",
  "Tôi muốn uống nước",
  "Tôi muốn đi vệ sinh",
  "Tôi muốn đi ngủ"
];

const container = document.getElementById("buttons");
const addBtn = document.getElementById("addBtn");

let buttons = JSON.parse(localStorage.getItem("buttons") || "[]");
if (buttons.length === 0) buttons = DEFAULT_BUTTONS;
renderButtons();

addBtn.onclick = () => {
  buttons.push("Câu mới");
  saveAndRender();
};

function renderButtons() {
  container.innerHTML = "";
  buttons.forEach((text, i) => {
    const div = document.createElement("div");
    const input = document.createElement("input");
    input.value = text;
    const play = document.createElement("button");
    play.textContent = "▶️";
    play.className = "btn";
    const del = document.createElement("button");
    del.textContent = "❌";
    del.className = "btn";
    del.onclick = () => {
      if (buttons.length > 1) {
        buttons.splice(i, 1);
        saveAndRender();
      }
    };
    input.oninput = debounce(() => checkSentence(input, i), 800);
    div.append(input, play, del);
    container.appendChild(div);
  });
}

function saveAndRender() {
  localStorage.setItem("buttons", JSON.stringify(buttons));
  renderButtons();
}

function debounce(fn, delay) {
  let timeout;
  return (...args) => {
    clearTimeout(timeout);
    timeout = setTimeout(() => fn(...args), delay);
  };
}

// === Bộ sửa lỗi đơn giản ===
function correctVietnamese(text) {
  const corrections = {
    "toi muon an com": "Tôi muốn ăn cơm",
    "toi muon uong nuoc": "Tôi muốn uống nước",
    "toi muon di ve sinh": "Tôi muốn đi vệ sinh",
    "toi muon di ngu": "Tôi muốn đi ngủ"
  };
  const key = text.toLowerCase().trim();
  return corrections[key] || null;
}

function checkSentence(input, index) {
  const val = input.value.trim();
  const suggestion = correctVietnamese(val);
  if (!suggestion || suggestion === val) return; // đúng rồi, bỏ qua

  showPopup(input, suggestion, () => {
    input.value = suggestion;
    buttons[index] = suggestion;
    saveAndRender();
  });
}

function showPopup(target, suggestion, onAccept) {
  const rect = target.getBoundingClientRect();
  const popup = document.createElement("div");
  popup.className = "popup";
  popup.style.top = rect.bottom + window.scrollY + "px";
  popup.style.left = rect.left + "px";
  popup.innerHTML = `
    Gợi ý: <b>${suggestion}</b>
    <button id="okBtn">Chấp nhận</button>
    <button id="noBtn">Bỏ qua</button>
  `;
  document.body.appendChild(popup);
  popup.querySelector("#okBtn").onclick = () => {
    onAccept();
    popup.remove();
  };
  popup.querySelector("#noBtn").onclick = () => popup.remove();
}
</script>
</body>
</html>
