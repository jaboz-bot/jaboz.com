<div id="settingsArea">
<button class="btn settings-btn" onclick="toggleLock(true)">KhÃ³a giao diá»‡n</button>
<button class="btn install-btn large-control-btn" id="installButton">ğŸ“² CÃ i Ä‘áº·t app</button>
<button class="btn reset-btn" onclick="resetDefaults()">â™»ï¸ Reset máº·c Ä‘á»‹nh</button>
</div>

<script>
let deferredPrompt,currentIndex=0,defaults=["TÃ´i muá»‘n Äƒn cÆ¡m","TÃ´i muá»‘n uá»‘ng nÆ°á»›c","TÃ´i muá»‘n Ä‘i vá»‡ sinh","TÃ´i muá»‘n Ä‘i ngá»§"],installState = 'before_install';
const controlArea=document.getElementById('controlArea'),
Â  Â  Â  installButton=document.getElementById('installButton'),
Â  Â  Â  addBtnMove=document.getElementById('add-btn-move');

// ... (Giá»¯ nguyÃªn cÃ¡c hÃ m speak, showPopup, addButton, saveAll, loadButtons, resetDefaults, getCards, cleanupEmptyCards, moveSpeak, toggleLock) ...

function toggleLock(lock){const s=document.getElementById('settingsArea'),c=document.getElementById('buttonContainer'),u=document.getElementById('unlock-btn');if(lock){s.style.display='none';c.style.display='none';addBtnMove.style.display='none';controlArea.classList.add('locked');document.getElementById('mainTitle').classList.add('locked-h1');u.style.display='flex'}else{s.style.display='block';c.style.display='grid';addBtnMove.style.display='block';controlArea.classList.remove('locked');document.getElementById('mainTitle').classList.remove('locked-h1');u.style.display='none'}}


// --- Logic PWA Ä‘Ã£ sá»­a Ä‘á»•i nháº¹ ---

window.addEventListener('beforeinstallprompt',e=>{
    e.preventDefault();
    deferredPrompt=e;
    // Chá»‰ hiá»‡n nÃºt náº¿u chÆ°a cÃ i Ä‘áº·t vÃ  trÃ¬nh duyá»‡t kÃ­ch hoáº¡t sá»± kiá»‡n
    if (installState === 'before_install') {
        installButton.style.display='flex'; // Hiá»‡n nÃºt cÃ i Ä‘áº·t
        installButton.onclick=installApp;
    }
});

function installApp(){
    if(deferredPrompt){
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult)=>{
            if (choiceResult.outcome === 'accepted') {
                installState = 'installed';
            } else {
                installState = 'rejected';
            }
            deferredPrompt=null;
            installButton.style.display='none'; // áº¨n nÃºt sau khi ngÆ°á»i dÃ¹ng tÆ°Æ¡ng tÃ¡c
        });
    }
}

window.addEventListener('appinstalled',()=>{
    installState = 'installed';
    installButton.style.display='none'; // áº¨n nÃºt sau khi á»©ng dá»¥ng Ä‘Æ°á»£c cÃ i Ä‘áº·t
});

// ThÃªm hÃ m nÃ y Ä‘á»ƒ áº©n nÃºt náº¿u khÃ´ng cÃ³ sá»± kiá»‡n PWA
if (installState === 'before_install') {
    // áº¨n nÃºt khi táº£i trang, nÃ³ sáº½ Ä‘Æ°á»£c beforeinstallprompt hiá»‡n lÃªn sau (náº¿u cÃ³)
    installButton.style.display='none'; 
}

// --- Káº¿t thÃºc Logic PWA Ä‘Ã£ sá»­a Ä‘á»•i nháº¹ ---

function warmUpTTS(){if(!('speechSynthesis'in window))return;let u=new SpeechSynthesisUtterance(" ");u.lang='vi-VN';u.volume=0;u.rate=10;speechSynthesis.speak(u);setTimeout(()=>speechSynthesis.cancel(),500)}
window.onload=()=>{loadButtons();warmUpTTS();}
</script>
</body>
</html>
