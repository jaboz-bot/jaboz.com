<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr·ª£ l√Ω gi·ªçng n√≥i</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f5fa;
      margin: 0;
      padding: 30px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .box {
      position: relative;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .controls {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }
    input[type="text"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
    }
    .play-btn { background: #4CAF50; color: white; }
    .ai-btn { background: #007bff; color: white; }
    .del-btn { background: #ff4d4d; color: white; flex: 0.3; }
    .add-btn, .reset-btn {
      background: #333;
      color: white;
      width: 100%;
      margin-top: 10px;
    }
    button:hover { opacity: 0.85; }

    /* Popup s·ª≠a l·ªói */
    .popup {
      position: absolute;
      top: -45px;
      left: 10px;
      background: #fff;
      border: 1px solid #aaa;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 10px;
      font-size: 14px;
      z-index: 10;
      display: none;
    }
    .popup button {
      padding: 5px 8px;
      margin-left: 8px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h2>Tr·ª£ l√Ω gi·ªçng n√≥i cho ng∆∞·ªùi tai bi·∫øn</h2>
  <div class="container" id="container"></div>
  <button class="add-btn" onclick="addBox()">‚ûï Th√™m n√∫t</button>
  <button class="reset-btn" onclick="resetDefault()">üîÑ Reset v·ªÅ m·∫∑c ƒë·ªãnh</button>

  <script>
    const container = document.getElementById("container");

    const defaultTexts = [
      "T√¥i mu·ªën ƒÉn c∆°m",
      "T√¥i mu·ªën u·ªëng n∆∞·ªõc",
      "T√¥i mu·ªën ƒëi v·ªá sinh",
      "T√¥i mu·ªën ƒëi ng·ªß"
    ];

    // Kh·ªüi t·∫°o ban ƒë·∫ßu
    window.onload = () => {
      const saved = JSON.parse(localStorage.getItem("buttons"));
      if (saved && saved.length) {
        saved.forEach(text => createBox(text));
      } else {
        defaultTexts.forEach(text => createBox(text));
        saveAll();
      }
    };

    // T·∫°o khung n√∫t
    function createBox(text = "") {
      const box = document.createElement("div");
      box.className = "box";

      const input = document.createElement("input");
      input.type = "text";
      input.value = text;

      const popup = document.createElement("div");
      popup.className = "popup";
      popup.innerHTML = `
        <span id="popupText"></span>
        <button onclick="confirmFix(this)">ƒê·ªìng √Ω</button>
        <button onclick="closePopup(this)">H·ªßy</button>
      `;
      box.appendChild(popup);

      const controls = document.createElement("div");
      controls.className = "controls";

      const aiBtn = document.createElement("button");
      aiBtn.textContent = "ü™Ñ S·ª≠a l·ªói";
      aiBtn.className = "ai-btn";
      aiBtn.onclick = () => suggestFix(input, popup);

      const playBtn = document.createElement("button");
      playBtn.textContent = "‚ñ∂Ô∏è Ph√°t";
      playBtn.className = "play-btn";
      playBtn.onclick = () => playText(input.value);

      const delBtn = document.createElement("button");
      delBtn.textContent = "‚ùå";
      delBtn.className = "del-btn";
      delBtn.onclick = () => { box.remove(); saveAll(); };

      controls.append(aiBtn, playBtn, delBtn);
      box.append(input, controls);
      container.appendChild(box);
    }

    // Ph√°t gi·ªçng n√≥i
    function playText(text) {
      if (!text.trim()) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "vi-VN";
      speechSynthesis.speak(utter);
    }

    // G·ª£i √Ω s·ª≠a l·ªói (offline)
    function suggestFix(input, popup) {
      const text = input.value.trim();
      if (!text) return;

      const fixed = autoFixSentence(text);
      if (fixed === text) return; // ƒê√∫ng r·ªìi -> im l·∫∑ng

      popup.style.display = "block";
      popup.querySelector("#popupText").textContent = `C√≥ ph·∫£i b·∫°n mu·ªën vi·∫øt: "${fixed}"?`;
      popup.dataset.fixed = fixed;
    }

    function confirmFix(btn) {
      const popup = btn.closest(".popup");
      const fixed = popup.dataset.fixed;
      const input = popup.parentElement.querySelector("input");
      input.value = fixed;
      popup.style.display = "none";
      saveAll();
    }

    function closePopup(btn) {
      btn.closest(".popup").style.display = "none";
    }

    // L∆∞u to√†n b·ªô v√†o localStorage
    function saveAll() {
      const all = Array.from(document.querySelectorAll(".box input")).map(i => i.value);
      localStorage.setItem("buttons", JSON.stringify(all));
    }

    // Th√™m n√∫t m·ªõi
    function addBox() {
      createBox("");
      saveAll();
    }

    // Reset m·∫∑c ƒë·ªãnh
    function resetDefault() {
      if (!confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ v√† kh√¥i ph·ª•c m·∫∑c ƒë·ªãnh?")) return;
      localStorage.removeItem("buttons");
      container.innerHTML = "";
      defaultTexts.forEach(text => createBox(text));
      saveAll();
    }

    // H√†m s·ª≠a l·ªói c∆° b·∫£n
    function autoFixSentence(text) {
      // Chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
      let t = text.toLowerCase();
      // S·ª≠a l·ªói ph·ªï bi·∫øn
      t = t.replace(/\bmuon\b/g, "mu·ªën")
           .replace(/\ban\b/g, "ƒÉn")
           .replace(/\buong\b/g, "u·ªëng")
           .replace(/\bnuc\b/g, "n∆∞·ªõc")
           .replace(/\bvesinh\b/g, "v·ªá sinh")
           .replace(/\bngu\b/g, "ng·ªß");
      // Th√™m d·∫•u c√¢u
      if (!/[.!?]$/.test(t)) t += ".";
      // Vi·∫øt hoa ƒë·∫ßu c√¢u
      t = t.charAt(0).toUpperCase() + t.slice(1);
      return t;
    }
  </script>
</body>
</html>
