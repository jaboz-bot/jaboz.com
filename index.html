<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√°y h·ªó tr·ª£ gi·ªçng n√≥i</title>
<style>
/* --- BODY --- */
body {
    font-family:'Segoe UI',sans-serif;
    background:#e3f2fd;
    margin:0;
    padding:0 0 55px;
    text-align:center;
}

/* --- MAIN WRAPPER --- */
.main-wrapper {
    max-width:700px;
    margin:0 auto;
    padding:20px 10px;
}

/* --- TITLE --- */
h1 { margin-bottom:20px; }

/* Khi kh√≥a: ti√™u ƒë·ªÅ c·ªë ƒë·ªãnh */
.locked-h1 {
    position:fixed;
    top:100px;
    left:50%;
    transform:translateX(-50%);
    width:100%;
    max-width:700px;
    margin:0;
    padding:0 10px;
    z-index:1000;
    color:#333;
    background:#e3f2fd;
}

/* --- CONTAINER BUTTON --- */
.container {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
    gap:20px;
    margin-bottom:20px;
}

/* --- CARD --- */
.card {
    background:#fff;
    padding:18px;
    border-radius:12px;
    box-shadow:0 3px 8px rgba(0,0,0,.15);
    display:flex;
    flex-direction:column;
    gap:10px;
    position:relative;
}

/* --- INPUT --- */
input {
    padding:10px;
    font-size:16px;
    border-radius:8px;
    border:1px solid #ccc;
    width:100%;
}

/* --- BUTTON CHUNG --- */
.btn {
    padding:12px;
    border:none;
    border-radius:8px;
    color:white;
    font-size:16px;
    cursor:pointer;
    transition:.3s;
    display:flex;
    justify-content:center;
    align-items:center;
}

/* --- BUTTON PH√ÅT √ÇM --- */
.play-btn {
    background:linear-gradient(45deg,#4CAF50,#43A047);
}

/* --- N√öT TH√äM / RESET / C√ÄI ƒê·∫∂T --- */
.add-btn,.reset-btn,.settings-btn,.install-btn{
    margin:8px auto;
    display:block;
}
.add-btn,.install-btn{ width:200px; }
.reset-btn,.settings-btn{ width:220px; height:50px; font-size:18px; }
.install-btn{ background:linear-gradient(45deg,#00BCD4,#0097A7); }
.add-btn,.reset-btn{ background:linear-gradient(45deg,#2196F3,#1976D2); }
.settings-btn{ background:linear-gradient(45deg,#f44336,#d32f2f); }

/* --- N√öT X√ìA ‚ùå --- */
.delete-btn {
    position:absolute;
    top:6px;
    right:8px;
    background:transparent; /* b·ªè khung n·ªÅn */
    border:none;            /* b·ªè vi·ªÅn */
    color:#e53935;
    font-size:18px;
    cursor:pointer;
    padding:0;
}

/* --- N√öT M·ªû KH√ìA --- */
#unlock-btn {
    width:160px;
    height:60px;
    display:none;
    background:linear-gradient(45deg,#f44336,#d32f2f);
}

/* --- CONTROL AREA --- */
.control-container {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:10px;
    margin-top:20px;
    transition:.3s;
    position:relative;
}

/* --- N√öT ƒêI·ªÄU H∆Ø·ªöNG --- */
.navigation-group {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:15px;
    margin:25px 0 0;
}
.control-btn {
    width:150px;
    height:60px;
    border-radius:8px;
    color:white;
    font-size:18px;
    border:none;
    cursor:pointer;
    transition:.3s;
    font-weight:bold;
    display:flex;
    justify-content:center;
    align-items:center;
}
.play-control-btn{ background:linear-gradient(45deg,#4CAF50,#43A047); }
.current-btn-color{ background:#ff9800; }

/* --- SETTINGS AREA --- */
#settingsArea{
    margin-top:30px;
    text-align:center;
}

/* --- KHI KH√ìA GIAO DI·ªÜN --- */
.control-container.locked{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    overflow:hidden;
    z-index:99;
    background:#e3f2fd;
}
.control-container.locked .navigation-group{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    margin:0;
}
.control-container.locked #unlock-btn{
    position:fixed;
    bottom:70px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    z-index:100;
}

/* --- POPUP --- */
#popup{
    position:fixed;
    background:rgba(0,0,0,.8);
    color:#fff;
    padding:15px 20px;
    border-radius:12px;
    font-size:18px;
    display:none;
    z-index:1000;
    max-width:90%;
    min-width:100px;
    text-align:center;
    transition:.5s;
}

/* --- TH√îNG TIN TTS --- */
#tts-info{
    position:fixed;
    bottom:0;
    left:50%;
    transform:translateX(-50%);
    width:100%;
    max-width:700px;
    text-align:center;
    padding:10px;
    border-top:1px solid #ccc;
    color:#616161;
    background:#e3f2fd;
    font-size:14px;
    z-index:1010;
}
#tts-info a{ color:#2196F3; text-decoration:none; }
</style>
</head>
<body>
<div class="main-wrapper">
    <h1 id="mainTitle">M√°y h·ªó tr·ª£ gi·ªçng n√≥i</h1>

    <!-- N√öT C√ÇU H·ªéI -->
    <div class="container" id="buttonContainer"></div>

    <!-- CONTROL AREA -->
    <div class="control-container" id="controlArea">
        <div id="popup"></div>

        <button class="btn add-btn" id="add-btn-move" onclick="addButton()">‚ûï Th√™m c√¢u m·ªõi</button>

        <div class="navigation-group">
            <button class="control-btn play-control-btn" onclick="moveSpeak(-1)">C√¢u tr∆∞·ªõc</button>
            <button class="control-btn current-btn-color" onclick="moveSpeak(0)">Ph√°t l·∫°i</button>
            <button class="control-btn play-control-btn" onclick="moveSpeak(1)">C√¢u sau</button>
        </div>

        <button class="btn" id="unlock-btn" onclick="toggleLock(false)">M·ªü kh√≥a giao di·ªán</button>
    </div>

    <!-- SETTINGS AREA -->
    <div id="settingsArea">
        <button class="btn settings-btn" onclick="toggleLock(true)">Kh√≥a giao di·ªán</button>
        <button class="btn install-btn" id="installButton" style="display:none;">üì≤ T·∫°o L·ªëi t·∫Øt</button>
        <button class="btn reset-btn" onclick="resetDefaults()">‚ôªÔ∏è Reset m·∫∑c ƒë·ªãnh</button>
    </div>
</div>

<!-- TH√îNG TIN TTS -->
<div id="tts-info">
    N·∫øu kh√¥ng th·∫•y √¢m thanh, t·∫£i <a href="https://play.google.com/store/apps/details?id=com.google.android.tts" target="_blank">Google Play</a>
</div>

<script>
// --- D·ªÆ LI·ªÜU M·∫∂C ƒê·ªäNH ---
let deferredPrompt, currentIndex = 0;
const defaults = ["T√¥i mu·ªën ƒÉn c∆°m", "T√¥i mu·ªën u·ªëng n∆∞·ªõc", "T√¥i mu·ªën ƒëi v·ªá sinh", "T√¥i mu·ªën ƒëi ng·ªß"];

// --- ELEMENTS ---
const controlArea = document.getElementById('controlArea');
const installButton = document.getElementById('installButton');
const addBtnMove = document.getElementById('add-btn-move');

// --- H√ÄM PH√ÅT √ÇM ---
function speak(text){
    if(!text || !('speechSynthesis' in window)) return;
    speechSynthesis.cancel();
    let utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'vi-VN';
    speechSynthesis.speak(utter);
    showPopup(text);
}

// --- H√ÄM HI·ªÇN TH·ªä POPUP ---
function showPopup(text){
    const p = document.getElementById('popup');
    p.textContent = text;
    p.style.display = 'block';
    p.style.opacity = '1';

    const isLocked = controlArea.classList.contains('locked');

    if(isLocked){
        // Khi kh√≥a: popup c·ªë ƒë·ªãnh, h·∫° xu·ªëng 200px
        p.style.position = 'fixed';
        p.style.top = '200px';
        p.style.left = '50%';
        p.style.transform = 'translateX(-50%)';
    } else {
        // Khi ch∆∞a kh√≥a: hi·ªÉn th·ªã s√°t input hi·ªán t·∫°i
        const inputs = getCards();
        if(inputs.length && currentIndex >= 0 && currentIndex < inputs.length){
            const rect = inputs[currentIndex].getBoundingClientRect();
            p.style.position = 'absolute';
            p.style.left = `${rect.left + rect.width/2 + window.scrollX}px`;
            p.style.top = `${rect.top + window.scrollY - 10}px`;
            p.style.transform = 'translateX(-50%)';
        }
    }

    setTimeout(() => {
        p.style.opacity = '0';
        setTimeout(()=>p.style.display='none',500);
    }, 2000);
}

// --- H√ÄM TH√äM BUTTON M·ªöI ---
function addButton(value=''){
    let card = document.createElement('div'); card.className='card';
    let input = document.createElement('input'); input.value = value;
    input.placeholder = "Nh·∫≠p vƒÉn b·∫£n...";
    input.onchange = saveAll;

    let play = document.createElement('button'); play.className='btn play-btn';
    play.textContent = 'üîä Ph√°t √¢m';
    play.onclick = ()=>speak(input.value.trim());

    let del = document.createElement('button'); del.className='delete-btn';
    del.textContent = '‚ùå';
    del.onclick = ()=>{
        card.remove();
        saveAll();
        currentIndex = Math.min(currentIndex,getCards().length-1);
    };

    card.append(input, play, del);
    document.getElementById('buttonContainer').appendChild(card);
    saveAll();
}

// --- L∆ØU & T·∫¢I D·ªÆ LI·ªÜU ---
function saveAll(){
    localStorage.setItem('voiceButtons', JSON.stringify([...document.querySelectorAll('.card input')].map(i=>i.value.trim())));
}
function loadButtons(){
    let saved = JSON.parse(localStorage.getItem('voiceButtons') || "[]");
    (saved.length ? saved : defaults).forEach(t => addButton(t));
    currentIndex = 0;
}
function resetDefaults(){
    if(confirm("ƒê·∫∑t l·∫°i m·∫∑c ƒë·ªãnh?")){
        localStorage.removeItem('voiceButtons');
        document.getElementById('buttonContainer').innerHTML='';
        loadButtons();
        currentIndex=0;
    }
}

// --- H·ªñ TR·ª¢ ---
function getCards(){ return document.querySelectorAll('.card input'); }
function cleanupEmptyCards(){
    let c = document.querySelectorAll('.card'), save=false;
    for(let i=c.length-1;i>=0;i--){
        let inp=c[i].querySelector('input');
        if(!inp || inp.value.trim()===''){ c[i].remove(); save=true; }
    }
    if(save){ saveAll(); currentIndex = Math.min(currentIndex,getCards().length-1); }
}

// --- DI CHUY·ªÇN PH√ÅT ---
function moveSpeak(dir){
    cleanupEmptyCards();
    const c = getCards();
    if(c.length===0) return;

    if(dir===0) speak(c[currentIndex].value.trim());
    else {
        currentIndex = (currentIndex + dir + c.length) % c.length;
        speak(c[currentIndex].value.trim());
    }
}

// --- KH√ìA / M·ªû GIAO DI·ªÜN ---
function toggleLock(lock){
    const s=document.getElementById('settingsArea');
    const c=document.getElementById('buttonContainer');
    const u=document.getElementById('unlock-btn');

    if(lock){
        s.style.display='none';
        c.style.display='none';
        addBtnMove.style.display='none';
        controlArea.classList.add('locked');
        document.getElementById('mainTitle').classList.add('locked-h1');
        u.style.display='flex';
    } else {
        s.style.display='block';
        c.style.display='grid';
        addBtnMove.style.display='block';
        controlArea.classList.remove('locked');
        document.getElementById('mainTitle').classList.remove('locked-h1');
        u.style.display='none';
    }
}

// --- INSTALL PWA ---
window.addEventListener('beforeinstallprompt', e=>{
    e.preventDefault();
    deferredPrompt=e;
    installButton.style.display='block';
    installButton.onclick=installApp;
});
function installApp(){
    if(deferredPrompt){
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(()=>{ deferredPrompt=null; installButton.style.display='none'; });
    }
}
window.addEventListener('appinstalled',()=>installButton.style.display='none');

// --- WARM UP TTS ---
function warmUpTTS(){
    if(!('speechSynthesis' in window)) return;
    let u = new SpeechSynthesisUtterance(" ");
    u.lang='vi-VN'; u.volume=0; u.rate=10;
    speechSynthesis.speak(u);
    setTimeout(()=>speechSynthesis.cancel(),500);
}

// --- LOAD ON START ---
window.onload = ()=>{
    loadButtons();
    warmUpTTS();
};
</script>
</body>
</html>
