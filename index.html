<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√°y h·ªó tr·ª£ gi·ªçng n√≥i</title>
<style>
body { font-family:'Segoe UI', sans-serif; background:#e3f2fd; margin:0; padding:20px; text-align:center;}
h1 {margin-bottom:20px;}
.container { display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:20px; margin-bottom:20px; }
.card { background:#fff; padding:18px; border-radius:12px; box-shadow:0 3px 8px rgba(0,0,0,0.15); display:flex; flex-direction:column; gap:10px; position:relative; }
input {padding:10px; font-size:16px; border-radius:8px; border:1px solid #ccc; width:100%; }
.btn {padding:12px; border:none; border-radius:8px; color:white; font-size:16px; cursor:pointer; transition:0.3s;}
.play-btn {background:linear-gradient(45deg,#4CAF50,#43A047);}
.play-btn:hover {transform:scale(1.05);}
.delete-btn {position:absolute; top:6px; right:8px; border:none; background:transparent; color:#e53935; font-size:18px; cursor:pointer;}
.add-btn, .reset-btn {background:linear-gradient(45deg,#2196F3,#1976D2); width:200px; margin:8px auto; display:block;}
.add-btn:hover, .reset-btn:hover {transform:scale(1.05);}

.control-container {display:flex; flex-direction:column; align-items:center; gap:10px; margin-top:20px; position:relative; transition:0.3s;}
.control-btn {width:80px; height:80px; border-radius:50%; background:#ff9800; color:white; font-size:28px; border:none; cursor:pointer; margin:10px 0; transition:0.3s;}
.control-btn:hover {transform:scale(1.1);}
#unlock-btn {margin-top:40px; background:#f44336; width:120px;}

/* Popup tr∆∞·ª£t, t·ª± r·ªông theo n·ªôi dung */
#popup {
  position:absolute;
  bottom:100%;
  left:50%;
  transform:translateX(-50%) translateY(20px);
  background:rgba(0,0,0,0.8);
  color:white;
  padding:15px 20px;
  border-radius:12px;
  font-size:18px;
  display:none;
  z-index:101;
  max-width:90%;
  min-width:100px;
  white-space:pre-wrap;
  word-wrap:break-word;
  text-align:center;
  transition:0.5s;
}

/* D√≤ng h∆∞·ªõng d·∫´n t·∫£i gi·ªçng n√≥i */
#tts-info {
  text-align:center;
  margin-top:30px;
  font-size:14px;
  color:#333;
}
#tts-info a {color:#1E88E5; text-decoration:underline;}
</style>
</head>
<body>
<h1>M√°y h·ªó tr·ª£ gi·ªçng n√≥i</h1>

<div class="container" id="buttonContainer"></div>

<div class="control-container" id="controlArea">
  <div id="popup"></div>
  <button class="control-btn" onclick="prevSpeak()">‚ñ≤</button>
  <button class="control-btn" onclick="currentSpeak()">‚óè</button>
  <button class="control-btn" onclick="nextSpeak()">‚ñº</button>
  <button class="btn" id="unlock-btn" onclick="toggleLock(false)" style="display:none;">M·ªü kh√≥a</button>
</div>

<div id="settingsArea">
  <button class="btn" style="background:#ff9800;margin-bottom:10px;" onclick="toggleLock(true)">Kh√≥a giao di·ªán</button>
  <button class="btn add-btn" onclick="addButton()">‚ûï Th√™m N√∫t</button>
  <button class="btn reset-btn" onclick="resetDefaults()">‚ôªÔ∏è Reset m·∫∑c ƒë·ªãnh</button>
</div>

<div id="tts-info">
  N·∫øu kh√¥ng th·∫•y √¢m thanh, vui l√≤ng t·∫£i gi·ªçng n√≥i t·∫°i 
  <a href="market://details?id=com.google.android.tts" 
     onclick="window.open('https://play.google.com/store/apps/details?id=com.google.android.tts','_blank'); return false;">
     Google Play
  </a>
</div>

<script>
const defaults=["T√¥i mu·ªën ƒÉn c∆°m","T√¥i mu·ªën u·ªëng n∆∞·ªõc","T√¥i mu·ªën ƒëi v·ªá sinh","T√¥i mu·ªën ƒëi ng·ªß"];
let currentIndex=0;
let lastSpeakTime = 0;
const SPEAK_DELAY = 1500; // 1.5 gi√¢y ch·∫∑n b·∫•m li√™n ti·∫øp

// --- N√∫t ph√°t √¢m ---
function speak(text){
  if(!text) return;
  if(!('speechSynthesis' in window)) return;
  const now = Date.now();
  if(now - lastSpeakTime < SPEAK_DELAY) return; // n·∫øu b·∫•m qu√° nhanh, b·ªè qua
  lastSpeakTime = now;
  const utter=new SpeechSynthesisUtterance(text);
  utter.lang='vi-VN';
  speechSynthesis.speak(utter);
  showPopup(text);
}

// --- Popup tr∆∞·ª£t ---
function showPopup(text){
  const popup=document.getElementById('popup');
  popup.textContent=text;
  popup.style.display='block';
  popup.style.opacity='1';
  popup.style.transform='translateX(-50%) translateY(0)';
  setTimeout(()=>{
    popup.style.opacity='0';
    popup.style.transform='translateX(-50%) translateY(-20px)';
    setTimeout(()=>popup.style.display='none',500);
  },2000);
}

// --- Qu·∫£n l√Ω n√∫t ---
function addButton(value=''){
  const card=document.createElement('div'); card.className='card';
  const input=document.createElement('input'); input.value=value; input.placeholder="Nh·∫≠p vƒÉn b·∫£n..."; input.onchange=saveAll;
  const play=document.createElement('button'); play.className='btn play-btn'; play.textContent='üîä Ph√°t √¢m'; play.onclick=()=>speak(input.value.trim());
  const del=document.createElement('button'); del.className='delete-btn'; del.textContent='‚ùå'; del.onclick=()=>{card.remove(); saveAll(); if(currentIndex>=getCards().length) currentIndex=getCards().length-1;};
  card.append(input,play,del);
  document.getElementById('buttonContainer').appendChild(card);
  saveAll();
}

function saveAll(){
  const texts=[...document.querySelectorAll('.card input')].map(i=>i.value.trim());
  localStorage.setItem('voiceButtons',JSON.stringify(texts));
}

function loadButtons(){
  const saved=JSON.parse(localStorage.getItem('voiceButtons')||"[]");
  const list=saved.length? saved:defaults;
  list.forEach(text=>addButton(text));
}

function resetDefaults(){
  if(confirm("B·∫°n c√≥ mu·ªën ƒë·∫∑t l·∫°i v·ªÅ m·∫∑c ƒë·ªãnh?")){
    localStorage.removeItem('voiceButtons');
    document.getElementById('buttonContainer').innerHTML='';
    loadButtons();
    currentIndex=0;
  }
}

function getCards(){ return document.querySelectorAll('.card input'); }

// --- 3 n√∫t ƒëi·ªÅu khi·ªÉn ---
function prevSpeak(){ const cards=getCards(); if(cards.length===0) return; currentIndex=(currentIndex-1+cards.length)%cards.length; speak(cards[currentIndex].value.trim()); }
function nextSpeak(){ const cards=getCards(); if(cards.length===0) return; currentIndex=(currentIndex+1)%cards.length; speak(cards[currentIndex].value.trim()); }
function currentSpeak(){ const cards=getCards(); if(cards.length===0) return; speak(cards[currentIndex].value.trim()); }

// --- Kh√≥a / M·ªü kh√≥a ---
function toggleLock(lock){
  const settings=document.getElementById('settingsArea');
  const container=document.getElementById('buttonContainer');
  const controlArea=document.getElementById('controlArea');
  const unlockBtn=document.getElementById('unlock-btn');
  if(lock){
    settings.style.display='none';
    container.style.display='none';
    controlArea.style.position='fixed';
    controlArea.style.top='50%';
    controlArea.style.left='50%';
    controlArea.style.transform='translate(-50%,-50%)';
    unlockBtn.style.display='block';
  } else {
    settings.style.display='block';
    container.style.display='grid';
    controlArea.style.position='relative';
    controlArea.style.top='0';
    controlArea.style.left='0';
    controlArea.style.transform='translate(0,0)';
    unlockBtn.style.display='none';
  }
}

window.onload=loadButtons;
</script>
</body>
</html>
