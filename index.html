<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√°y h·ªó tr·ª£ gi·ªçng n√≥i</title>
<link rel="manifest" href="manifest.json">
<style>
body{font-family:'Segoe UI',sans-serif;background:#e3f2fd;margin:0;padding:0 0 55px;text-align:center}
.main-wrapper{max-width:700px;margin:0 auto;padding:20px 10px}
h1{margin-bottom:20px}
.locked-h1{position:fixed;top:100px;left:50%;transform:translateX(-50%);width:100%;max-width:700px;margin:0;padding:0 10px;z-index:1000;color:#333;background:#e3f2fd}
.container{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-bottom:20px}
.card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 3px 8px rgba(0,0,0,0.15);display:flex;flex-direction:column;gap:10px;position:relative}
input{padding:10px;font-size:16px;border-radius:8px;border:1px solid #ccc;width:100%}
.btn{padding:12px;border:none;border-radius:8px;color:white;font-size:16px;cursor:pointer;transition:0.3s;display:flex;justify-content:center;align-items:center}
.play-btn{background:linear-gradient(45deg,#4CAF50,#43A047)}
.play-btn:hover,.add-btn:hover,.reset-btn:hover,.install-btn:hover,.control-btn:hover{transform:scale(1.05)}
.delete-btn{position:absolute;top:6px;right:8px;background:transparent;color:#e53935;font-size:18px;cursor:pointer}
.add-btn{background:linear-gradient(45deg,#2196F3,#1976D2);width:200px;margin:8px auto;display:block}
.reset-btn{background:linear-gradient(45deg,#2196F3,#1976D2);width:220px;height:50px;font-size:18px;margin:8px auto;display:block}
.install-btn{background:linear-gradient(45deg,#00BCD4,#0097A7);width:200px;margin:8px auto;display:block}
.control-container{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:20px;position:relative;transition:0.3s}
.navigation-group{display:flex;flex-direction:column;justify-content:center;align-items:center;gap:15px;margin:25px 0 0 0}
.control-btn{width:150px;height:60px;border-radius:8px;color:white;font-size:18px;border:none;cursor:pointer;transition:0.3s;font-weight:bold;display:flex;justify-content:center;align-items:center}
.play-control-btn{background:linear-gradient(45deg,#4CAF50,#43A047)}
.current-btn-color{background:#ff9800}
#settingsArea .btn:first-child{background:linear-gradient(45deg,#f44336,#d32f2f);width:220px;height:50px;font-size:18px;margin:0 auto 20px auto;display:block}
#settingsArea{margin-top:30px}
#unlock-btn{background:linear-gradient(45deg,#f44336,#d32f2f);width:160px;height:60px;font-size:18px;position:relative;display:none}
.control-container.locked{position:fixed;top:0;left:0;width:100%;height:100%;overflow:hidden;z-index:99;background:#e3f2fd}
.control-container.locked .navigation-group{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);margin:0}
.control-container.locked #unlock-btn{position:fixed;bottom:70px;left:50%;display:flex !important;transform:translateX(-50%);margin:0;z-index:100}
#popup{position:absolute;bottom:100%;left:50%;transform:translateX(-50%) translateY(20px);background:rgba(0,0,0,0.8);color:#fff;padding:15px 20px;border-radius:12px;font-size:18px;display:none;z-index:101;max-width:90%;min-width:100px;white-space:pre-wrap;word-wrap:break-word;text-align:center;transition:0.5s}
.control-container.locked #popup{position:fixed;top:150px;bottom:auto;left:50%;transform:translateX(-50%);z-index:1000}
/* TTS info lu√¥n hi·ªÉn th·ªã, k·ªÉ c·∫£ khi kh√≥a giao di·ªán */
#tts-info{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:700px;text-align:center;padding:10px;border-top:1px solid #ccc;color:#616161;background:#e3f2fd;z-index:101;font-size:14px}
.control-container.locked #tts-info{position:fixed;bottom:0;left:50%;transform:translateX(-50%);z-index:101}
#tts-info a{color:#2196F3;text-decoration:none}
</style>
</head>
<body>
<div class="main-wrapper">
<h1 id="mainTitle">M√°y h·ªó tr·ª£ gi·ªçng n√≥i</h1>
<div class="container" id="buttonContainer"></div>
<div class="control-container" id="controlArea">
<div id="popup"></div>
<button class="btn add-btn" id="add-btn-move" onclick="addButton()">‚ûï Th√™m c√¢u m·ªõi</button>
<div class="navigation-group">
<button class="control-btn play-control-btn" onclick="moveSpeak(-1)">C√¢u tr∆∞·ªõc</button>
<button class="control-btn current-btn-color" onclick="moveSpeak(0)">Ph√°t l·∫°i</button>
<button class="control-btn play-control-btn" onclick="moveSpeak(1)">C√¢u sau</button>
</div>
<button class="btn" id="unlock-btn" onclick="toggleLock(false)">M·ªü kh√≥a giao di·ªán</button>
</div>
<div id="settingsArea">
<button class="btn" onclick="toggleLock(true)">Kh√≥a giao di·ªán</button>
<button class="btn install-btn" id="installButton" style="display:none;">üì≤ T·∫°o L·ªëi t·∫Øt (C√†i ƒë·∫∑t App)</button>
<button class="btn reset-btn" onclick="resetDefaults()">‚ôªÔ∏è Reset m·∫∑c ƒë·ªãnh</button>
</div>
</div>
<div id="tts-info">N·∫øu kh√¥ng th·∫•y √¢m thanh, vui l√≤ng t·∫£i gi·ªçng n√≥i t·∫°i <a href="market://details?id=com.google.android.tts" onclick="window.open('https://play.google.com/store/apps/details?id=com.google.android.tts','_blank');return false;">Google Play</a></div>
<script>
let deferredPrompt,currentIndex=0,defaults=["T√¥i mu·ªën ƒÉn c∆°m","T√¥i mu·ªën u·ªëng n∆∞·ªõc","T√¥i mu·ªën ƒëi v·ªá sinh","T√¥i mu·ªën ƒëi ng·ªß"];
const controlArea=document.getElementById('controlArea'),
      installButton=document.getElementById('installButton'),
      addBtnMove=document.getElementById('add-btn-move'),
      mainTitle=document.getElementById('mainTitle');

function speak(text){if(!text||!('speechSynthesis'in window))return;window.speechSynthesis.cancel();let u=new SpeechSynthesisUtterance(text);u.lang='vi-VN';speechSynthesis.speak(u);showPopup(text)}

function showPopup(text){
  const p=document.getElementById('popup'),isLocked=controlArea.classList.contains('locked');
  p.textContent=text;
  p.style.display='block';
  p.style.opacity='1';
  p.style.transform=`translateX(-50%) translateY(${isLocked?30:20}px)`;
  setTimeout(()=>{
    p.style.opacity='0';
    p.style.transform='translateX(-50%) translateY(-20px)';
    setTimeout(()=>p.style.display='none',500)
  },2000);
}

function addButton(v=''){
  const card=document.createElement('div'); card.className='card';
  const input=document.createElement('input'); input.value=v; input.placeholder="Nh·∫≠p vƒÉn b·∫£n..."; input.onchange=saveAll;
  const play=document.createElement('button'); play.className='btn play-btn'; play.textContent='üîä Ph√°t √¢m'; play.onclick=()=>speak(input.value.trim());
  const del=document.createElement('button'); del.className='delete-btn'; del.textContent='‚ùå';
  del.onclick=()=>{card.remove();saveAll();currentIndex=Math.min(currentIndex,getCards().length-1)};
  card.append(input,play,del);
  document.getElementById('buttonContainer').appendChild(card);
  saveAll();
}

function saveAll(){localStorage.setItem('voiceButtons',JSON.stringify([...document.querySelectorAll('.card input')].map(i=>i.value.trim())))}

function loadButtons(){const saved=JSON.parse(localStorage.getItem('voiceButtons')||"[]"),list=saved.length?saved:defaults;document.getElementById('buttonContainer').innerHTML='';list.forEach(t=>addButton(t));currentIndex=0}

function resetDefaults(){if(confirm("B·∫°n c√≥ mu·ªën ƒë·∫∑t l·∫°i v·ªÅ m·∫∑c ƒë·ªãnh?")){localStorage.removeItem('voiceButtons');document.getElementById('buttonContainer').innerHTML='';loadButtons();currentIndex=0}}

function getCards(){return document.querySelectorAll('.card input')}

function cleanupEmptyCards(){
  let c=document.querySelectorAll('.card'),save=false;
  for(let i=c.length-1;i>=0;i--){let inp=c[i].querySelector('input');if(!inp||inp.value.trim()===''){c[i].remove();save=true}}
  if(save){saveAll();const n=getCards();currentIndex=Math.min(currentIndex,n.length-1)}
}

function moveSpeak(dir){
  cleanupEmptyCards();
  const c=getCards(); if(c.length===0)return;
  if(dir===0) speak(c[currentIndex].value.trim());
  else {currentIndex=(currentIndex+dir+c.length)%c.length; speak(c[currentIndex].value.trim())}
}

function toggleLock(lock){
  const s=document.getElementById('settingsArea'),
        c=document.getElementById('buttonContainer'),
        u=document.getElementById('unlock-btn'),
        p=document.getElementById('popup');
  if(lock){
    s.style.display='none'; c.style.display='none'; addBtnMove.style.display='none';
    controlArea.classList.add('locked'); mainTitle.classList.add('locked-h1'); u.style.display='flex';
  }else{
    s.style.display='block'; c.style.display='grid'; addBtnMove.style.display='block';
    controlArea.classList.remove('locked'); mainTitle.classList.remove('locked-h1');
    p.style.position='absolute'; p.style.top='auto'; p.style.bottom='100%';
    u.style.display='none';
  }
}

window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();deferredPrompt=e;installButton.style.display='block';installButton.addEventListener('click',installApp)});

function installApp(){if(deferredPrompt){deferredPrompt.prompt();deferredPrompt.userChoice.then(r=>{console.log(r.outcome==='accepted'?'Ng∆∞·ªùi d√πng ƒë√£ ch·∫•p nh·∫≠n c√†i ƒë·∫∑t.':'Ng∆∞·ªùi d√πng ƒë√£ t·ª´ ch·ªëi c√†i ƒë·∫∑t.');deferredPrompt=null;installButton.style.display='none'})}}

window.addEventListener('appinstalled',()=>{installButton.style.display='none'})

function warmUpTTS(){if(!('speechSynthesis'in window))return;const u=new SpeechSynthesisUtterance(" ");u.lang='vi-VN';u.volume=0;u.rate=10;if(speechSynthesis.getVoices().length===0||speechSynthesis.speaking===false){speechSynthesis.speak(u);setTimeout(()=>speechSynthesis.cancel(),500)}}

window.onload=()=>{loadButtons();warmUpTTS();}
</script>
</body>
</html>
