<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điều Khiển</title>
    <link rel="manifest" href="dashboard.json">
    <meta name="theme-color" content="#1976D2">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #e3f2fd;
            margin: 0;
            /* ĐIỀU CHỈNH: Tăng padding dưới lên 70px để chừa chỗ cho nút cố định */
            padding: 50px 10px 70px 10px; 
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            justify-content: space-between;
            box-sizing: border-box;
        }
        h1 {
            color: #1976D2;
            margin-bottom: 40px;
        }
        .main-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }
        .app-link {
            text-decoration: none;
            color: white;
            padding: 30px 40px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            width: 250px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .app-link:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .voice-link {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        .game-link {
            background: linear-gradient(45deg, #4CAF50, #388E3C);
        }
        .movie-link {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }
        /* CỐ ĐỊNH NÚT CÀI ĐẶT */
        .settings-area {
            width: 100%;
            text-align: center;
            position: fixed; 
            bottom: 0; 
            left: 0;
            z-index: 1000; 
            background: rgba(240, 248, 255, 0.95);
            padding: 10px 0; 
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); 
        }
        .settings-link {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
            padding: 15px 30px;
            font-size: 16px;
            width: auto;
            display: inline-block;
            border-radius: 8px;
            color: white; 
            border: none; 
            cursor: pointer;
            text-decoration: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .settings-link:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        /* CSS cho chế độ chơi game toàn màn hình */
        .game-full-screen {
            display:none; 
            width: 100vw; 
            height: 100vh; 
            position: fixed; 
            top: 0; 
            left: 0; 
            background: #000; 
            z-index: 9999;
        }
        .game-full-screen iframe {
            width: 100%; 
            height: 100%; 
            border: none;
        }
        .close-game-btn {
            position: fixed; 
            top: 10px; 
            right: 10px; 
            z-index: 10000; 
            background: rgba(255, 0, 0, 0.8);
            color: white; 
            border: none; 
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            transition: background 0.2s;
        }
        .close-game-btn:hover {
            background: red;
        }
    </style>
</head>
<body>
    
    <div id="mainContent" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <h1 id="pageTitle">Chọn Ứng Dụng</h1>
        <div class="main-container" id="mainMenu">
            
            <a href="tools/may-ho-tro-giong-noi/may-voice.html" class="app-link voice-link">
                💬 Máy Hỗ Trợ Giọng Nói
            </a>
            
                        <a href="#" id="gameLink" class="app-link game-link">
                🎮 Chơi Game             
            </a>
            
            <a href="tv/tv.html" class="app-link movie-link">
                🎬 TV Online
            </a>
            
        </div>
    </div>

<div id="gameContainer" class="game-full-screen">
    <iframe id="gameIframe" src="" allowfullscreen></iframe>
    <button id="closeGame" class="close-game-btn">❌ Thoát Game</button>
</div>


<div class="settings-area">
    <button class="btn install-btn large-control-btn settings-link" id="installButton">
    📲 Cài đặt app
</button>
</div>

<script>
    // --- Biến PWA ---
    let deferredPrompt = null;
    const installButton = document.getElementById('installButton');
    
    // --- Biến Game Mode ---
    const gameLink = document.getElementById('gameLink');
    const gameContainer = document.getElementById('gameContainer');
    const gameIframe = document.getElementById('gameIframe');
    const closeGame = document.getElementById('closeGame');
    const mainMenu = document.getElementById('mainMenu');
    const pageTitle = document.getElementById('pageTitle');
    const settingsArea = document.querySelector('.settings-area');

    // --- Chức năng Game Mode ---
    gameLink.addEventListener('click', function(e) {
        e.preventDefault(); // Ngăn chặn chuyển hướng trang mặc định
        
        // Ẩn menu chính, tiêu đề và nút cài đặt
        mainMenu.style.display = 'none';
        pageTitle.style.display = 'none';
        settingsArea.style.display = 'none';
        
        // Hiển thị container game và tải game vào iframe
        // LƯU Ý: Thay 'https://gamesnacks.com/' bằng URL game bạn muốn nếu khác.
        gameIframe.src = 'https://gamesnacks.com/'; 
        gameContainer.style.display = 'block';
    });

    closeGame.addEventListener('click', function() {
        // Ẩn container game và reset iframe
        gameContainer.style.display = 'none';
        gameIframe.src = ''; // Dừng tải/phát nội dung
        
        // Hiển thị lại menu chính, tiêu đề và nút cài đặt
        mainMenu.style.display = 'flex';
        pageTitle.style.display = 'block';
        settingsArea.style.display = 'block';
    });
    
    // --- Chức năng PWA ---

    // Hàm kiểm tra chế độ standalone (đã cài đặt)
    function isRunningStandalone() {
        return window.matchMedia('(display-mode: standalone)').matches;
    }

    // Hàm quyết định hiển thị/ẩn nút
    function updateInstallButtonVisibility() {
        if (!isRunningStandalone() && deferredPrompt) { 
            installButton.style.display = 'inline-block';
        } else {
            installButton.style.display = 'none';
        }
    }

    function installApp() {
        installButton.removeEventListener('click', installApp);

        if (deferredPrompt) {
            deferredPrompt.prompt();
            
            deferredPrompt.userChoice.then((choiceResult) => {
                deferredPrompt = null;
                updateInstallButtonVisibility(); 
            });
        }
    }
    
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        updateInstallButtonVisibility();
        
        if (installButton.style.display !== 'none') {
            installButton.addEventListener('click', installApp, { once: true });
        }
    });

    window.addEventListener('appinstalled', () => {
        deferredPrompt = null;
        updateInstallButtonVisibility();
    });
    
    updateInstallButtonVisibility(); 

        if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js')
    .then(reg => console.log('SW registered:', reg.scope))
    .catch(err => console.error('SW failed:', err));
}
    
</script>

</body>
</html>
