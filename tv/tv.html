<!DOCTYPE html>
<html lang="vi">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title data-key="title">Bแบฃng Chแบฅm Cรดng Theo Thรกng</title>
ย ย <style>
ย ย ย ย /* === CSS Styling === */
ย ย ย ยย
ย ย ย ย /* KHแบฎC PHแปคC CฤN GIแปฎA MODAL: ฤแบฃm bแบฃo HTML vร BODY chiแบฟm toรn bแป chiแปu cao mรn hรฌnh */
ย ย ย ย html, body {
ย ย ย ย ย ย height: 100%; /* Dรฒng QUAN TRแปNG ฤรฃ ฤฦฐแปฃc thรชm */
ย ย ย ย ย ย margin: 0;
ย ย ย ย }

ย ย ย ย body {
ย ย ย ย ย ย font-family: Arial, sans-serif;
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย background-color: #f4f7f6;
ย ย ย ย ย ย height: 100vh; /* Giแปฏ lแบกi 100vh ฤแป tฦฐฦกng thรญch tแปt hฦกn */
ย ย ย ย }

ย ย ย ย .container {
ย ย ย ย ย ย max-width: 900px;
ย ย ย ย ย ย margin: 0 auto;ย
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย background: #ffffff;
ย ย ย ย ย ย border-radius: 0;
ย ย ย ย ย ย box-shadow: none;
ย ย ย ย ย ย height: 100%;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย /* **QUAN TRแปNG CHO VUแปT** */
ย ย ย ย ย ย touch-action: pan-y;ย
ย ย ย ย ย ย user-select: none;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย @media (min-width: 768px) {
ย ย ย ย ย ย .container {
ย ย ย ย ย ย ย ย padding: 30px;
ย ย ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย ย ย box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
ย ย ย ย ย ย ย ย height: auto;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย /* Bแป cแปฅc chรญnh cแปงa Header */
ย ย ย ย .header-controls {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column; /* Chia thรnh cรกc dรฒng */
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย flex-shrink: 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Dรฒng 1: Nฤm vร Ngรดn ngแปฏ */
ย ย ย ย .top-row {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย justify-content: space-between;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย width: 100%;
ย ย ย ย }

ย ย ย ย /* Hiแปn thแป nฤm แป gรณc trรชn trรกi */
ย ย ย ย .year-display {
ย ย ย ย ย ย font-size: 1.4em;ย
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #27ae60; /* Mรu xanh lรก nแปi bแบญt */
ย ย ย ย ย ย padding: 5px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .controls {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย justify-content: flex-end;
ย ย ย ย }

ย ย ย ย .control-group label {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #555;
ย ย ย ย ย ย font-size: 0.9em;
ย ย ย ย }

ย ย ย ย /* Dรฒng 2: Tiรชu ฤแป thรกng (H1) */
ย ย ย ย h1 {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย font-size: 1.5em;ย
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย order: 2; /* ฤแบฃm bแบฃo nรณ lร dรฒng thแปฉ 2 */
ย ย ย ย }

ย ย ย ย h1 .nav-arrow {
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย padding: 0 5px;
ย ย ย ย ย ย user-select: none;
ย ย ย ย }

ย ย ย ย /* Lแปch */
ย ย ย ย .calendar-header {
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย font-size: 1.2em;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย color: #3498db;
ย ย ย ย }

ย ย ย ย .calendar-table {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย table-layout: fixed;ย
ย ย ย ย ย ย border-collapse: collapse;
ย ย ย ย ย ย flex-grow: 1;ย
ย ย ย ย }

ย ย ย ย .calendar-table th, .calendar-table td {
ย ย ย ย ย ย border: 1px solid #bdc3c7;
ย ย ย ย ย ย padding: 0;ย
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย font-size: 0.7em;
ย ย ย ย }

ย ย ย ย .calendar-table th {
ย ย ย ย ย ย background-color: #ecf0f1;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย ย ย padding: 5px 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Thay ฤแปi mรu cแปt Chแปง Nhแบญt (TH) */
ย ย ย ย .calendar-table th:first-child {
ย ย ย ย ย ย color: #e74c3c; /* Mรu ฤแป */
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Thay ฤแปi mรu รด Chแปง Nhแบญt (TD) */
ย ย ย ย .calendar-table tr td:first-child {
ย ย ย ย ย ย background-color: #fcebeb; /* Mรu nแปn ฤแป nhแบกt cho รด cรณ ngรy */
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Mรu nแปn tแปi cho รด khรดng cรณ ngรy */
ย ย ย ย .calendar-table td:empty {
ย ย ย ย ย ย background-color: #e0e0e0 !important; /* Mรu xรกm tแปi ฦฐu tiรชn */
ย ย ย ย ย ย cursor: default;
ย ย ย ย }

ย ย ย ย /* --- TแปI GIแบขN HรA GIAO DIแปN Cฦ BแบขN --- */
ย ย ย ย .day-cell {
ย ย ย ย ย ย vertical-align: top;
ย ย ย ย ย ย width: 14.28%;ย
ย ย ย ย ย ย height: auto;ย
ย ย ย ย ย ย min-height: 50px;
ย ย ย ย ย ย background-color: #fcfcfc; /* Mแบทc ฤแปnh trแบฏng cho รด cรณ ngรy */
ย ย ย ย ย ย position: relative;ย
ย ย ย ย ย ย cursor: pointer;ย
ย ย ย ย ย ย user-select: none;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Tฤng kรญch thฦฐแปc sแป ngรy */
ย ย ย ย .day-number {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย font-size: 1.1em;ย
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: 2px;
ย ย ย ย ย ย left: 5px;
ย ย ย ย ย ย color: #2980b9;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Work display (Vแป trรญ trung tรขm) */
ย ย ย ย .work-display {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;ย
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย align-items: center;

ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: 50%;
ย ย ย ย ย ย left: 50%;
ย ย ย ย ย ย transform: translate(-50%, -50%);
ย ย ย ย ย ย width: 95%;ย
ย ย ย ย ย ย padding: 2px 0;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .work-display span {
ย ย ย ย ย ย line-height: 1.1;
ย ย ย ย ย ย white-space: nowrap;
ย ย ย ย ย ย overflow: hidden;
ย ย ย ย ย ย text-overflow: ellipsis;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย /* Giแป Lรm */
ย ย ย ย .work-hours-in-cell {
ย ย ย ย ย ย color: #27ae60;ย
ย ย ย ย ย ย font-size: 0.9em;ย
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Sแป Tiแปn */
ย ย ย ย .work-amount-in-cell {
ย ย ย ย ย ย color: #e74c3c; /* Mรu ฤแป cho sแป tiแปn */
ย ย ย ย ย ย font-size: 1em;ย
ย ย ย ย }

ย ย ย ย /* --- Input Rate --- */
ย ย ย ย .rate-input-group {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย gap: 5px;
ย ย ย ย ย ย font-size: 0.9em;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* --- Summary --- */
ย ย ย ย .summary {
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border-top: 3px double #3498db;
ย ย ย ย ย ย background-color: #eaf6fd;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย flex-shrink: 0;ย
ย ย ย ย }

ย ย ย ย .summary p {
ย ย ย ย ย ย font-size: 1em;
ย ย ย ย ย ย margin: 8px 0;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย }

ย ย ย ย .total-amount {
ย ย ย ย ย ย font-size: 1.6em;
ย ย ย ย ย ย color: #e74c3c;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* ================================================= */
ย ย ย ย /* === MODAL/POPUP ฤร CแบฌP NHแบฌT CรCH CฤN GIแปฎA === */
ย ย ย ย /* ================================================= */
ย ย ย ย .modal {
ย ย ย ย ย ย position: fixed;
ย ย ย ย ย ย z-index: 1000;
ย ย ย ย ย ย left: 0;
ย ย ย ย ย ย top: 0;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 100%; /* Thuแปc tรญnh nรy chแป hoแบกt ฤแปng khi html vร body cรณ height: 100% */
ย ย ย ย ย ย overflow: auto;
ย ย ย ย ย ย background-color: rgba(0,0,0,0.6);
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย /* ฤร XรA: justify-content: center; */
ย ย ย ย ย ย /* ฤร XรA: align-items: center; */
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย position: relative; /* Thรชm relative ฤแป ฤแบฃm bแบฃo nแปi dung con tuyแปt ฤแปi khรดng trรn ra ngoรi */
ย ย ย ย }

ย ย ย ย .modal-content {
ย ย ย ย ย ย background-color: #fefefe;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย box-shadow: 0 5px 15px rgba(0,0,0,0.3);
ย ย ย ย ย ย width: 90%;
ย ย ย ย ย ย max-width: 400px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย align-items: stretch;
ย ย ย ย ย ย 
ย ย ย ย ย ย /* === CฤN GIแปฎA TUYแปT ฤแปI BแบฐNG POSITION/TRANSFORM === */
ย ย ย ย ย ย position: absolute; /* 1. ฤแบทt vแป trรญ tuyแปt ฤแปi */
ย ย ย ย ย ย top: 50%; /* 2. Dแปch ฤiแปm neo xuแปng 50% tแปซ trรชn */
ย ย ย ย ย ย left: 50%; /* 3. Dแปch ฤiแปm neo sang 50% tแปซ trรกi */
ย ย ย ย ย ย transform: translate(-50%, -50%); /* 4. Dแปch ngฦฐแปฃc lแบกi 50% kรญch thฦฐแปc cแปงa chรญnh nรณ */
ย ย ย ย ย ย /* ================================================== */
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .modal-content h2 {
ย ย ย ย ย ย margin: 0 0 5px 0; /* ฤรฃ chแปnh margin dฦฐแปi */
ย ย ย ย ย ย color: #3498db;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .time-input-group {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย gap: 5px;
ย ย ย ย }

ย ย ย ย .time-input-group label {
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย ย ย font-size: 1em;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .modal-content input[type="time"] {
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border: 1px solid #bdc3c7;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย font-size: 1.2em;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย box-sizing: border-box;
ย ย ย ย }

ย ย ย ย .modal-actions {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย /* Tฤng khoแบฃng cรกch giแปฏa cรกc nรบt */
ย ย ย ย ย ย justify-content: space-between;ย
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }

ย ย ย ย .modal-actions button {
ย ย ย ย ย ย padding: 10px 10px;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย border-radius: 5px;
ย ย ย ย ย ย font-size: 1em;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย flex: 1; /* Chia ฤแปu khรดng gian cho cรกc nรบt */
ย ย ย ย ย ย margin: 0 5px; /* Thรชm khoแบฃng cรกch ngang giแปฏa cรกc nรบt */
ย ย ย ย }
ย ย ย ย /* ฤแบฃm bแบฃo nรบt ฤแบงu tiรชn vร cuแปi cรนng khรดng cรณ margin bรชn ngoรi */
ย ย ย ย .modal-actions button:first-child {
ย ย ย ย ย ย margin-left: 0;
ย ย ย ย }
ย ย ย ย .modal-actions button:last-child {
ย ย ย ย ย ย margin-right: 0;
ย ย ย ย }


ย ย ย ย .modal-actions button.cancel {
ย ย ย ย ย ย background-color: #ecf0f1;
ย ย ย ย ย ย color: #2c3e50;
ย ย ย ย }

ย ย ย ย .modal-actions button.delete { /* Thรชm style cho nรบt xรณa */
ย ย ย ย ย ย background-color: #f39c12; /* Mรu cam */
ย ย ย ย ย ย color: white;
ย ย ย ย }

ย ย ย ย .modal-actions button.save {
ย ย ย ย ย ย background-color: #3498db;
ย ย ย ย ย ย color: white;
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย <div class="container" id="timesheetContainer">
ย ย ย ยย
ย ย ย ย <div class="header-controls">
ย ย ย ย ย ย <div class="top-row">
ย ย ย ย ย ย ย ย <div id="yearDisplay" class="year-display"></div>ย
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="controls">
ย ย ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย ย ย <label data-key="label_lang" for="languageSelect">Ngรดn ngแปฏ:</label>
ย ย ย ย ย ย ย ย ย ย ย ย <select id="languageSelect" onchange="setLanguage(this.value)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="vi">Tiแบฟng Viแปt</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="en">English</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="ko">ํ๊ตญ์ด</option>
ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <h1 data-key="h1_month_title">
ย ย ย ย ย ย ย ย <span class="nav-arrow" onclick="changeMonth(-1)">โ๏ธ</span>
ย ย ย ย ย ย ย ย <span id="currentMonthYear"></span>ย
ย ย ย ย ย ย ย ย <span class="nav-arrow" onclick="changeMonth(1)">โถ๏ธ</span>
ย ย ย ย ย ย </h1>
ย ย ย ย </div>
ย ย ย ยย
ย ย ย ย <div class="calendar-header">
ย ย ย ย ย ย <div class="rate-input-group">
ย ย ย ย ย ย ย ย <span data-key="label_rate">๐ฐ Lฦฐฦกng/giแป:</span>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <input type="number" id="hourlyRate" min="1000" oninput="updateSummary()" style="width:80px;" placeholder="">
ย ย ย ย ย ย ย ย <span id="currencyUnit" class="currency-unit">VND</span>
ย ย ย ย ย ย </div>
ย ย ย ย ย ย <p id="note" class="note" data-key="note_calc"></p>ย
ย ย ย ย </div>

ย ย ย ย <table class="calendar-table">
ย ย ย ย ย ย <thead>
ย ย ย ย ย ย ย ย <tr id="tableHeaders">
ย ย ย ย ย ย ย ย ย ย <th data-key="th_sun">CN</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_mon">T2</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_tue">T3</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_wed">T4</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_thu">T5</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_fri">T6</th>
ย ย ย ย ย ย ย ย ย ย <th data-key="th_sat">T7</th>
ย ย ย ย ย ย ย ย </tr>
ย ย ย ย ย ย </thead>
ย ย ย ย ย ย <tbody id="calendarBody">
ย ย ย ย ย ย ย ย </tbody>
ย ย ย ย </table>

ย ย ย ย <div class="summary">
ย ย ย ย ย ย <p><span id="summaryHoursPrefix" data-key="summary_total_hours_prefix_month">โ Tแปng giแป lรm viแปc trong thรกng:</span> <span id="totalHours" class="work-hours">0.00</span> <span data-key="summary_hours_suffix">giแป</span></p>
ย ย ย ย ย ยย
ย ย ย ย ย ย <p><span id="summaryIncomePrefix" data-key="summary_total_income_month">๐ต TแปNG THU NHแบฌP Dแปฐ KIแบพN:</span></p>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div id="totalAmount" class="total-amount">0 VND</div>
ย ย ย ย </div>
ย ย </div>
ย ยย
ย ย <div id="timeModal" class="modal" onclick="closeModal(event)" style="display: none;">
ย ย ย ย <div class="modal-content" onclick="event.stopPropagation()">
ย ย ย ย ย ย <h2 data-key="modal_title_prefix">Nhแบญp Giแป Cรดng <span id="modalDayNumber"></span></h2>ย
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="time-input-group">
ย ย ย ย ย ย ย ย <label data-key="in" for="modalTimeIn">Vรo:</label>
ย ย ย ย ย ย ย ย <input type="time" id="modalTimeIn" value="09:00">
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="time-input-group">
ย ย ย ย ย ย ย ย <label data-key="out" for="modalTimeOut">Ra:</label>
ย ย ย ย ย ย ย ย <input type="time" id="modalTimeOut" value="18:00">
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย <div class="modal-actions">
ย ย ย ย ย ย ย ย <button class="cancel" onclick="closeModal()" data-key="btn_cancel">Hแปงy</button>
ย ย ย ย ย ย ย ย <button class="delete" onclick="deleteModalData()" data-key="btn_delete">Xรณa</button>
ย ย ย ย ย ย ย ย <button class="save" onclick="saveModalData()" data-key="btn_save">Chแปn</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script>
ย ย ย ย // === JavaScript Logic (KHรNG Cร THAY ฤแปI) ===

ย ย ย ย // Biแบฟn toรn cแปฅc ฤแป quแบฃn lรฝ thรกng/nฤm hiแปn tแบกi
ย ย ย ย let currentMonth = new Date().getMonth(); // 0-11
ย ย ย ย let currentYear = new Date().getFullYear();

ย ย ย ย // Biแบฟn toรn cแปฅc cho thao tรกc vuแปt
ย ย ย ย let touchStartX = 0;
ย ย ย ย const SWIPE_THRESHOLD = 100;ย
ย ย ย ยย
ย ย ย ย // DOM Elements
ย ย ย ย const TIMESHEET_CONTAINER = document.getElementById('timesheetContainer');
ย ย ย ย const CALENDAR_BODY = document.getElementById('calendarBody');
ย ย ย ย const TOTAL_HOURS_SPAN = document.getElementById('totalHours');
ย ย ย ย const TOTAL_AMOUNT_DIV = document.getElementById('totalAmount');
ย ย ย ย const HOURLY_RATE_INPUT = document.getElementById('hourlyRate');
ย ย ย ย const LANGUAGE_SELECT = document.getElementById('languageSelect');
ย ย ย ย const CURRENCY_UNIT_SPAN = document.getElementById('currencyUnit');
ย ย ย ย const TIME_MODAL = document.getElementById('timeModal');
ย ย ย ย const MODAL_TIME_IN = document.getElementById('modalTimeIn');
ย ย ย ย const MODAL_TIME_OUT = document.getElementById('modalTimeOut');
ย ย ย ย const YEAR_DISPLAY = document.getElementById('yearDisplay');ย
ย ย ย ยย
ย ย ย ย let timeData = {};ย
ย ย ย ย let currentDayInModal = null;ย
ย ย ย ยย
ย ย ย ย // Khรณa lฦฐu trแปฏ
ย ย ย ย const STORAGE_KEY_RATE = 'hourlyRate';
ย ย ย ย const STORAGE_KEY_LANGUAGE = 'appLanguage';ย
ย ย ย ยย
ย ย ย ย // Khรณa lฦฐu trแปฏ sแบฝ thay ฤแปi theo thรกng/nฤm hiแปn tแบกi
ย ย ย ย const getStorageKeys = () => ({
ย ย ย ย ย ย data: `timeData-${currentYear}-${currentMonth + 1}`
ย ย ย ย });

ย ย ย ย // --- Dแปฏ liแปu Dแปch thuแบญt ---
ย ย ย ย const translations = {
ย ย ย ย ย ย 'vi': {
ย ย ย ย ย ย ย ย title: 'Bแบฃng Chแบฅm Cรดng Theo Thรกng',
ย ย ย ย ย ย ย ย label_lang: 'Ngรดn ngแปฏ:',
ย ย ย ย ย ย ย ย currencyCode: 'VND',ย
ย ย ย ย ย ย ย ย currencyLocale: 'vi-VN',ย
ย ย ย ย ย ย ย ย h1_month_title: '',ย
ย ย ย ย ย ย ย ย label_rate: '๐ฐ Lฦฐฦกng/giแป:',
ย ย ย ย ย ย ย ย note_calc: '',
ย ย ย ย ย ย ย ย th_sun: 'CN', th_mon: 'T2', th_tue: 'T3', th_wed: 'T4', th_thu: 'T5', th_fri: 'T6', th_sat: 'T7',
ย ย ย ย ย ย ย ย in: 'Vรo:', out: 'Ra:', hour_suffix: 'giแป',
ย ย ย ย ย ย ย ย summary_total_hours_prefix_month: 'โ Tแปng giแป lรm viแปc trong ',
ย ย ย ย ย ย ย ย summary_hours_suffix: 'giแป',
ย ย ย ย ย ย ย ย summary_total_income_month: '๐ต TแปNG THU NHแบฌP Dแปฐ KIแบพN ',
ย ย ย ย ย ย ย ย month_names: ["Thรกng 1", "Thรกng 2", "Thรกng 3", "Thรกng 4", "Thรกng 5", "Thรกng 6",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย"Thรกng 7", "Thรกng 8", "Thรกng 9", "Thรกng 10", "Thรกng 11", "Thรกng 12"],
ย ย ย ย ย ย ย ย modal_title_prefix: 'Nhแบญp Giแป Cรดng',
ย ย ย ย ย ย ย ย btn_cancel: 'Hแปงy',
ย ย ย ย ย ย ย ย btn_delete: 'Xรณa',ย
ย ย ย ย ย ย ย ย btn_save: 'Chแปn',
ย ย ย ย ย ย },
ย ย ย ย ย ย 'en': {
ย ย ย ย ย ย ย ย title: 'Monthly Timesheet',
ย ย ย ย ย ย ย ย label_lang: 'Language:',
ย ย ย ย ย ย ย ย currencyCode: 'USD',
ย ย ย ย ย ย ย ย currencyLocale: 'en-US',
ย ย ย ย ย ย ย ย h1_month_title: '',ย
ย ย ย ย ย ย ย ย label_rate: '๐ฐ Hourly Rate:',
ย ย ย ย ย ย ย ย note_calc: '',
ย ย ย ย ย ย ย ย th_sun: 'Sun', th_mon: 'Mon', th_tue: 'Tue', th_wed: 'Wed', th_thu: 'Thu', th_fri: 'Fri', th_sat: 'Sat',
ย ย ย ย ย ย ย ย in: 'In:', out: 'Out:', hour_suffix: 'hours',
ย ย ย ย ย ย ย ย summary_total_hours_prefix_month: 'โ Total work hours for ',
ย ย ย ย ย ย ย ย summary_hours_suffix: 'hours',
ย ย ย ย ย ย ย ย summary_total_income_month: '๐ต ESTIMATED TOTAL INCOME for ',
ย ย ย ย ย ย ย ย month_names: ["January", "February", "March", "April", "May", "June",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย"July", "August", "September", "October", "November", "December"],
ย ย ย ย ย ย ย ย modal_title_prefix: 'Enter Timesheet - Day',
ย ย ย ย ย ย ย ย btn_cancel: 'Cancel',
ย ย ย ย ย ย ย ย btn_delete: 'Delete',ย
ย ย ย ย ย ย ย ย btn_save: 'Save',
ย ย ย ย ย ย },
ย ย ย ย ย ย 'ko': {
ย ย ย ย ย ย ย ย title: '์๊ฐ ๊ทผ๋ฌด ์๊ฐํ',
ย ย ย ย ย ย ย ย label_lang: '์ธ์ด:',
ย ย ย ย ย ย ย ย currencyCode: 'KRW',
ย ย ย ย ย ย ย ย currencyLocale: 'ko-KR',
ย ย ย ย ย ย ย ย h1_month_title: '',ย
ย ย ย ย ย ย ย ย label_rate: '๐ฐ ์๊ฐ๋น ์๊ธ:',
ย ย ย ย ย ย ย ย note_calc: '',
ย ย ย ย ย ย ย ย th_sun: '์ผ', th_mon: '์', th_tue: 'ํ', th_wed: '์', th_thu: '๋ชฉ', th_fri: '๊ธ', th_sat: 'ํ',
ย ย ย ย ย ย ย ย in: '์ถ๊ทผ:', out: 'ํด๊ทผ:', hour_suffix: '์๊ฐ',
ย ย ย ย ย ย ย ย summary_total_hours_prefix_month: 'โ ์ด ๊ทผ๋ฌด ์๊ฐ ',
ย ย ย ย ย ย ย ย summary_hours_suffix: '์๊ฐ',
ย ย ย ย ย ย ย ย summary_total_income_month: '๐ต ์์ ์ด ์์ ',
ย ย ย ย ย ย ย ย month_names: ["1์", "2์", "3์", "4์", "5์", "6์",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย"7์", "8์", "9์", "10์", "11์", "12์"],
ย ย ย ย ย ย ย ย modal_title_prefix: '๊ทผ๋ฌด ์๊ฐ ์๋ฅ - ๋์ง',
ย ย ย ย ย ย ย ย btn_cancel: '์ทจ์',
ย ย ย ย ย ย ย ย btn_delete: '์ญ์',ย
ย ย ย ย ย ย ย ย btn_save: '์ํ',
ย ย ย ย ย ย }
ย ย ย ย };
ย ย ย ยย
ย ย ย ย function calculateWorkHours(timeIn, timeOut) {
ย ย ย ย ย ย if (!timeIn || !timeOut) return 0;
ย ย ย ย ย ย const [hIn, mIn] = timeIn.split(':').map(Number);
ย ย ย ย ย ย const [hOut, mOut] = timeOut.split(':').map(Number);
ย ย ย ย ย ย const minutesIn = hIn * 60 + mIn;
ย ย ย ย ย ย let minutesOut = hOut * 60 + mOut;
ย ย ย ย ย ย let totalMinutes = minutesOut - minutesIn;
ย ย ย ย ย ย if (totalMinutes < 0) {
ย ย ย ย ย ย ย ย totalMinutes += 24 * 60;ย
ย ย ย ย ย ย }
ย ย ย ย ย ย return totalMinutes / 60;
ย ย ย ย }

ย ย ย ย function saveDataToLocalStorage() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const keys = getStorageKeys();
ย ย ย ย ย ย ย ย localStorage.setItem(keys.data, JSON.stringify(timeData));
ย ย ย ย ย ย ย ย localStorage.setItem(STORAGE_KEY_RATE, HOURLY_RATE_INPUT.value);
ย ย ย ย ย ย ย ย localStorage.setItem(STORAGE_KEY_LANGUAGE, LANGUAGE_SELECT.value);
ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย console.error("Could not save data to localStorage", e);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function loadDataFromLocalStorage() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const keys = getStorageKeys();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const savedRate = localStorage.getItem(STORAGE_KEY_RATE);
ย ย ย ย ย ย ย ย if (savedRate) {
ย ย ย ย ย ย ย ย ย ย HOURLY_RATE_INPUT.value = savedRate;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const savedData = localStorage.getItem(keys.data);
ย ย ย ย ย ย ย ย if (savedData) {
ย ย ย ย ย ย ย ย ย ย timeData = JSON.parse(savedData);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย timeData = {};ย
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const savedLang = localStorage.getItem(STORAGE_KEY_LANGUAGE);
ย ย ย ย ย ย ย ย if (savedLang) {
ย ย ย ย ย ย ย ย ย ย LANGUAGE_SELECT.value = savedLang;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย LANGUAGE_SELECT.value = 'vi';ย
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย console.error("Could not load data from localStorage", e);
ย ย ย ย ย ย ย ย timeData = {};ย
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function updateSummary() {
ย ย ย ย ย ย let totalHours = 0;
ย ย ย ย ย ย const hourlyRate = parseFloat(HOURLY_RATE_INPUT.value) || 0;
ย ย ย ย ย ยย
ย ย ย ย ย ย const lang = LANGUAGE_SELECT.value;
ย ย ย ย ย ย const t = translations[lang];
ย ย ย ย ย ย const currency = t.currencyCode;
ย ย ย ย ย ย const locale = t.currencyLocale;
ย ย ย ย ย ย const currentMonthName = t.month_names[currentMonth];ย

ย ย ย ย ย ย CALENDAR_BODY.querySelectorAll('.day-cell').forEach(cell => {
ย ย ย ย ย ย ย ย const dayElement = cell.querySelector('.day-number');
ย ย ย ย ย ย ย ย if (!dayElement) return;

ย ย ย ย ย ย ย ย const day = dayElement.textContent;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const timeIn = timeData[day]?.in || '';
ย ย ย ย ย ย ย ย const timeOut = timeData[day]?.out || '';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย let hours = 0;
ย ย ย ย ย ย ย ย if (timeIn && timeOut) {
ย ย ย ย ย ย ย ย ย ย hours = calculateWorkHours(timeIn, timeOut);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย totalHours += hours;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Lแบฅy cรกc thแบป span ฤแป cแบญp nhแบญt giแป vร tiแปn
ย ย ย ย ย ย ย ย const workDisplay = cell.querySelector('.work-display');
ย ย ย ย ย ย ย ย const hoursSpan = cell.querySelector('.work-hours-in-cell');
ย ย ย ย ย ย ย ย const amountSpan = cell.querySelector('.work-amount-in-cell');

ย ย ย ย ย ย ย ย if (workDisplay && hoursSpan && amountSpan) {
ย ย ย ย ย ย ย ย ย ย if (hours > 0) {
ย ย ย ย ย ย ย ย ย ย ย ย const formattedHours = hours.toFixed(2) + t.hour_suffix.substring(0, 1);
ย ย ย ย ย ย ย ย ย ย ย ย hoursSpan.textContent = formattedHours;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if (hourlyRate > 0) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const totalAmount = hours * hourlyRate;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const formattedAmount = totalAmount.toLocaleString(locale, {ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย style: 'currency',ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย currency: currency,ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย minimumFractionDigits: (currency === 'VND' || currency === 'KRW') ? 0 : 2
ย ย ย ย ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย amountSpan.textContent = formattedAmount;
ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย amountSpan.textContent = ''; // Khรดng cรณ lฦฐฦกng/giแป thรฌ khรดng hiแปn tiแปn
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย // Nแบฟu khรดng cรณ giแป lรm, xรณa cแบฃ giแป vร tiแปn
ย ย ย ย ย ย ย ย ย ย ย ย hoursSpan.textContent = '';
ย ย ย ย ย ย ย ย ย ย ย ย amountSpan.textContent = '';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย // Cแบญp nhแบญt Tแปng Kแบฟt Cuแปi Thรกng
ย ย ย ย ย ย const totalAmountFinal = totalHours * hourlyRate;
ย ย ย ย ย ย TOTAL_HOURS_SPAN.textContent = totalHours.toFixed(2);
ย ย ย ย ย ยย
ย ย ย ย ย ย const summaryHoursSuffix = document.querySelector('[data-key="summary_hours_suffix"]');
ย ย ย ย ย ย if (summaryHoursSuffix) {
ย ย ย ย ย ย ย ย summaryHoursSuffix.textContent = t.summary_hours_suffix;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย // CแบฌP NHแบฌT TรN THรNG VรO PHแบฆN TแปNG KแบพT
ย ย ย ย ย ย document.getElementById('summaryHoursPrefix').textContent = `${t.summary_total_hours_prefix_month} ${currentMonthName}:`;
ย ย ย ย ย ย document.getElementById('summaryIncomePrefix').textContent = `${t.summary_total_income_month} ${currentMonthName}:`;


ย ย ย ย ย ย TOTAL_AMOUNT_DIV.textContent = totalAmountFinal.toLocaleString(locale, {ย
ย ย ย ย ย ย ย ย style: 'currency',ย
ย ย ย ย ย ย ย ย currency: currency,ย
ย ย ย ย ย ย ย ย minimumFractionDigits: (currency === 'VND' || currency === 'KRW') ? 0 : 2
ย ย ย ย ย ย });

ย ย ย ย ย ย saveDataToLocalStorage();
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function changeMonth(delta) {
ย ย ย ย ย ย currentMonth += delta;
ย ย ย ย ย ย if (currentMonth > 11) {
ย ย ย ย ย ย ย ย currentMonth = 0;
ย ย ย ย ย ย ย ย currentYear++;
ย ย ย ย ย ย } else if (currentMonth < 0) {
ย ย ย ย ย ย ย ย currentMonth = 11;
ย ย ย ย ย ย ย ย currentYear--;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย loadDataFromLocalStorage();ย
ย ย ย ย ย ย setLanguage();
ย ย ย ย }

ย ย ย ย function setLanguage(selectedLang) {
ย ย ย ย ย ย const lang = selectedLang || LANGUAGE_SELECT.value;ย
ย ย ย ย ย ย const t = translations[lang];
ย ย ย ย ย ยย
ย ย ย ย ย ย LANGUAGE_SELECT.value = lang;

ย ย ย ย ย ย let currentCurrency = t.currencyCode;
ย ย ย ย ย ย CURRENCY_UNIT_SPAN.textContent = currentCurrency;
ย ย ย ย ย ยย
ย ย ย ย ย ย YEAR_DISPLAY.textContent = currentYear;ย

ย ย ย ย ย ย document.querySelectorAll('[data-key]').forEach(element => {
ย ย ย ย ย ย ย ย const key = element.getAttribute('data-key');
ย ย ย ย ย ย ย ย if (t[key] !== undefined) {
ย ย ย ย ย ย ย ย ย ย if (key.startsWith('modal_title_prefix')) {
ย ย ย ย ย ย ย ย ย ย ย ย // Cฤn chแปnh ฤแป giแปฏ khoแบฃng trแบฏng tแปi thiแปu giแปฏa tiรชu ฤแป vร sแป ngรy
ย ย ย ย ย ย ย ย ย ย ย ย const day = currentDayInModal ? ` <span id="modalDayNumber">${currentDayInModal}</span>` : '';
ย ย ย ย ย ย ย ย ย ย ย ย element.innerHTML = `${t.modal_title_prefix}${day}`;
ย ย ย ย ย ย ย ย ย ย } else if (key !== 'h1_month_title' &&ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยkey !== 'summary_total_hours_prefix_month' &&ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยkey !== 'summary_total_income_month') {
ย ย ย ย ย ย ย ย ย ย ย ย element.textContent = t[key];
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย document.title = t.title;
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('currentMonthYear').textContent = `${t.month_names[currentMonth]}`;
ย ย ย ย ย ยย
ย ย ย ย ย ย saveDataToLocalStorage();

ย ย ย ย ย ย renderCalendar();ย
ย ย ย ย }

ย ย ย ย function renderCalendar() {
ย ย ย ย ย ย CALENDAR_BODY.innerHTML = '';ย
ย ย ย ย ย ยย
ย ย ย ย ย ย const date = new Date(currentYear, currentMonth, 1);
ย ย ย ย ย ย let firstDayOfWeek = date.getDay();ย

ย ย ย ย ย ย let row = CALENDAR_BODY.insertRow();
ย ย ย ย ย ยย
ย ย ย ย ย ย // Thรชm รด trแปng (mรu tแปi) cho nhแปฏng ngรy trฦฐแปc ngรy 1
ย ย ย ย ย ย for (let i = 0; i < firstDayOfWeek; i++) {
ย ย ย ย ย ย ย ย row.insertCell().innerHTML = '';
ย ย ย ย ย ย }

ย ย ย ย ย ย let day = 1;
ย ย ย ย ย ยย
ย ย ย ย ย ย while (date.getMonth() === currentMonth) {
ย ย ย ย ย ย ย ย if (row.cells.length === 7) {
ย ย ย ย ย ย ย ย ย ย row = CALENDAR_BODY.insertRow();
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย const cell = row.insertCell();
ย ย ย ย ย ย ย ย cell.className = 'day-cell';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const currentDay = day.toString();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // CแบฌP NHแบฌT: Chia thรnh 2 thแบป span riรชng biแปt trong work-display
ย ย ย ย ย ย ย ย const dayContent = `
ย ย ย ย ย ย ย ย ย ย <span class="day-number">${currentDay}</span>
ย ย ย ย ย ย ย ย ย ย <div class="work-display">
ย ย ย ย ย ย ย ย ย ย ย ย <span class="work-hours-in-cell"></span>
ย ย ย ย ย ย ย ย ย ย ย ย <span class="work-amount-in-cell"></span>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย cell.innerHTML = dayContent;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย cell.onclick = function() {
ย ย ย ย ย ย ย ย ย ย openModal(currentDay);
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย day++;
ย ย ย ย ย ย ย ย date.setDate(day);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย // Thรชm รด trแปng (mรu tแปi) cho nhแปฏng ngรy sau ngรy cuแปi thรกng
ย ย ย ย ย ย while (row.cells.length < 7) {
ย ย ย ย ย ย ย ย row.insertCell().innerHTML = '';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย updateSummary();ย
ย ย ย ย }

ย ย ย ย function openModal(day) {
ย ย ย ย ย ย currentDayInModal = day;
ย ย ย ย ย ย const lang = LANGUAGE_SELECT.value;
ย ย ย ย ย ย const t = translations[lang];

ย ย ย ย ย ย // Cแบญp nhแบญt tiรชu ฤแป modal mแปt cรกch rรต rรng
ย ย ย ย ย ย document.querySelector('.modal-content h2').innerHTML = `${t.modal_title_prefix} <span id="modalDayNumber">${day}</span>`;
ย ย ย ย ย ยย
ย ย ย ย ย ย // ฤแบทt giรก trแป mแบทc ฤแปnh cho รด nhแบญp
ย ย ย ย ย ย const data = timeData[day];
ย ย ย ย ย ย MODAL_TIME_IN.value = data?.in || '09:00';
ย ย ย ย ย ย MODAL_TIME_OUT.value = data?.out || '18:00';
ย ย ย ย ย ยย
ย ย ย ย ย ย TIME_MODAL.style.display = 'block'; // Thay 'flex' bแบฑng 'block' ฤแป khรดng can thiแปp vรo cรกch cฤn giแปฏa mแปi
ย ย ย ย ย ย MODAL_TIME_IN.focus();
ย ย ย ย }

ย ย ย ย function closeModal(event) {
ย ย ย ย ย ย if (!event || event.target.id === 'timeModal' || (event.target.tagName === 'BUTTON' && event.target.classList.contains('cancel'))) {
ย ย ย ย ย ย ย ย TIME_MODAL.style.display = 'none';
ย ย ย ย ย ย ย ย currentDayInModal = null;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // HรM MแปI: XรA Dแปฎ LIแปU NGรY CรNG
ย ย ย ย function deleteModalData() {
ย ย ย ย ย ย if (!currentDayInModal) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย // XรA Dแปฎ LIแปU CแปฆA NGรY HIแปN TแบI KHแปI BIแบพN timeData
ย ย ย ย ย ย delete timeData[currentDayInModal];
ย ย ย ย ย ยย
ย ย ย ย ย ย TIME_MODAL.style.display = 'none';
ย ย ย ย ย ย currentDayInModal = null;
ย ย ย ย ย ย updateSummary(); // Cแบญp nhแบญt lแบกi giao diแปn, tแปng kแบฟt vร lฦฐu LocalStorage
ย ย ย ย }


ย ย ย ย function saveModalData() {
ย ย ย ย ย ย if (!currentDayInModal) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย const timeIn = MODAL_TIME_IN.value;
ย ย ย ย ย ย const timeOut = MODAL_TIME_OUT.value;
ย ย ย ย ย ยย
ย ย ย ย ย ย timeData[currentDayInModal] = { in: timeIn, out: timeOut };
ย ย ย ย ย ยย
ย ย ย ย ย ย TIME_MODAL.style.display = 'none';
ย ย ย ย ย ย currentDayInModal = null;
ย ย ย ย ย ย updateSummary();ย
ย ย ย ย }

ย ย ย ย function handleTouchStart(event) {
ย ย ย ย ย ย touchStartX = event.touches[0].clientX;
ย ย ย ย }

ย ย ย ย function handleTouchEnd(event) {
ย ย ย ย ย ย if (touchStartX === 0) return;

ย ย ย ย ย ย const touchEndX = event.changedTouches[0].clientX;
ย ย ย ย ย ย const deltaX = touchEndX - touchStartX;
ย ย ย ย ย ยย
ย ย ย ย ย ย // ฤร CHแปNH SแปฌA: Sแปญ dแปฅng ngฦฐแปกng 75
ย ย ย ย ย ย if (deltaX > SWIPE_THRESHOLD) {ย
ย ย ย ย ย ย ย ย changeMonth(-1);
ย ย ย ย ย ย } else if (deltaX < -SWIPE_THRESHOLD) {
ย ย ย ย ย ย ย ย changeMonth(1);
ย ย ย ย ย ย }

ย ย ย ย ย ย touchStartX = 0;
ย ย ย ย }

ย ย ย ย // --- Chแบกy khi tแบฃi trang ---
ย ย ย ย window.onload = function() {
ย ย ย ย ย ย TIMESHEET_CONTAINER.addEventListener('touchstart', handleTouchStart, false);
ย ย ย ย ย ย TIMESHEET_CONTAINER.addEventListener('touchend', handleTouchEnd, false);

ย ย ย ย ย ย HOURLY_RATE_INPUT.addEventListener('change', updateSummary);
ย ย ย ย ย ย HOURLY_RATE_INPUT.addEventListener('keyup', updateSummary);

ย ย ย ย ย ย loadDataFromLocalStorage();
ย ย ย ย ย ย setLanguage();ย
ย ย ย ย };
ย ย </script>
</body>
</html>
