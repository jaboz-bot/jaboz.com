<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>TV YouTube Vô Hạn</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{margin:0;font-family:sans-serif;background:#000;color:#eee;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
  #player{width:90vw;height:60vh;background:#111;margin-bottom:10px}
  button{background:#222;color:#eee;border:0;padding:10px 18px;border-radius:8px;cursor:pointer;margin:0 5px}
  button:hover{background:#333}
  #status{font-size:14px;color:#aaa;margin-top:8px}
</style>
</head>
<body>
  <div id="player"></div>
  <div>
    <button id="nextBtn">⏭️ Kênh mới</button>
    <button id="toggleAuto">🔁 Tự động: BẬT</button>
  </div>
  <div id="status">Đang tải video đầu tiên...</div>

<script>
const API_KEY = "AIzaSyDwN50y0-_Huo2hfpQCnFIqlDrOPSvi3Eo";

// Mảng từ khóa để random tìm video
const KEYWORDS = [
  "music", "news", "movie", "funny", "animals", "sports",
  "live", "technology", "travel", "kpop", "documentary",
  "food", "vlog", "game", "space", "robot", "nature", "meme"
];

let player, autoPlay = true, viewed = 0;

function randomKeyword() {
  return KEYWORDS[Math.floor(Math.random() * KEYWORDS.length)];
}

// Gọi YouTube Data API để lấy video ngẫu nhiên
async function getRandomVideoId() {
  const q = randomKeyword();
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&videoEmbeddable=true&maxResults=10&order=viewCount&q=${encodeURIComponent(q)}&key=${API_KEY}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (!data.items || data.items.length === 0) throw new Error("Không tìm thấy video");
    const v = data.items[Math.floor(Math.random() * data.items.length)];
    return v.id.videoId;
  } catch (err) {
    console.error("Lỗi tải video:", err);
    return null;
  }
}

async function loadRandomVideo() {
  const vid = await getRandomVideoId();
  if (!vid) {
    document.getElementById("status").textContent = "Không tải được video. Thử lại...";
    setTimeout(loadRandomVideo, 2000);
    return;
  }
  viewed++;
  document.getElementById("status").textContent = `Đang xem video ${viewed} | ID: ${vid}`;
  if (player && player.loadVideoById) {
    player.loadVideoById(vid);
  } else {
    player = new YT.Player("player", {
      videoId: vid,
      playerVars: {autoplay:1,controls:1,rel:0,modestbranding:1},
      events: {
        onStateChange: (ev) => {
          if (ev.data === YT.PlayerState.ENDED && autoPlay) {
            setTimeout(loadRandomVideo, 1000);
          }
        },
        onError: () => {
          setTimeout(loadRandomVideo, 1000);
        }
      }
    });
  }
}

// Nút bấm
document.getElementById("nextBtn").onclick = loadRandomVideo;
document.getElementById("toggleAuto").onclick = () => {
  autoPlay = !autoPlay;
  document.getElementById("toggleAuto").textContent = `🔁 Tự động: ${autoPlay ? "BẬT" : "TẮT"}`;
};

// Gọi API script YouTube
(function(){
  const tag = document.createElement("script");
  tag.src = "https://www.youtube.com/iframe_api";
  const first = document.getElementsByTagName("script")[0];
  first.parentNode.insertBefore(tag, first);
})();
function onYouTubeIframeAPIReady(){
  loadRandomVideo();
}
</script>
</body>
</html>
